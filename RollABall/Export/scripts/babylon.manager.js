String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,function(){"use strict";var e=function(){function t(e){return r.appendChild(e.dom),e}function n(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";a=e}var a=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;right:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),n(++a%r.children.length)},!1);var i=(performance||Date).now(),o=i,l=0,s=t(new e.Panel("FPS","#0f0")),c=t(new e.Panel("MS","#0ff"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08"));return n(0),{REVISION:16,dom:r,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){l++;var t=(performance||Date).now();if(c.update(t-i,200),t>o+1e3){var n=1e3*l/(t-o);if(n>=30?e.FpsForeground="#0f0":n>=24?e.FpsForeground="#ff0":e.FpsForeground="#f00",s.update(n,100),o=t,l=0,u){var a=performance.memory;u.update(a.usedJSHeapSize/1048576,a.jsHeapSizeLimit/1048576)}}return t},update:function(){i=this.end()},domElement:r,setMode:n}};return e.FpsForeground="#0f0",e.AllBackground="#222",e.Panel=function(t,n){var a=1/0,r=0,i=Math.round,o=i(window.devicePixelRatio||1),l=100*o,s=50*o,c=3*o,u=2*o,p=3*o,m=18*o,d=94*o,g=28*o,h=document.createElement("canvas");h.width=l,h.height=s,h.style.cssText="width:100px;height:50px";var y=h.getContext("2d");return y.font="bold "+12*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=e.AllBackground,y.fillRect(0,0,l,s),y.fillStyle="FPS"===t?e.FpsForeground:n,y.fillText(t,c,u),y.fillRect(p,m,d,g),y.fillStyle=e.AllBackground,y.globalAlpha=.9,y.fillRect(p,m,d,g),{dom:h,update:function(s,f){a=Math.min(a,s),r=Math.max(r,s),y.fillStyle=e.AllBackground,y.globalAlpha=1,y.fillRect(0,0,l,m),y.fillStyle="FPS"===t?e.FpsForeground:n,y.fillText(i(s)+" "+t+" ("+i(a)+"-"+i(r)+")",c,u),y.drawImage(h,p+o,m,d-o,g,p,m,d-o,g),y.fillRect(p+d-o,m,o,g),y.fillStyle=e.AllBackground,y.globalAlpha=.9,y.fillRect(p+d-o,m,o,i((1-s/f)*g))}}},e});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(){function t(e,t,n,a){if(void 0===n&&(n=!0),void 0===a&&(a={}),this.register=null,this.tick=!1,this._before=null,this._after=null,this._engine=null,this._scene=null,this._properties=null,this._manager=null,this._entity=null,null==e)throw new Error("Null owner scene object specified.");if(null==t)throw new Error("Null host scene object specified.");this.tick=n,this._entity=e,this._manager=null,this._properties=a,this._engine=t.getEngine(),this._scene=t;var r=this;r.register=function(){r.registerInstance(r)},r._before=function(){r.updateInstance(r)},r._after=function(){r.afterInstance(r)}}return t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){null!=this._properties&&(this._properties[e]=t)},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e]),null==n&&(n=t),null!=n?n:null},t.prototype.getClassname=function(){var e=/function (.{1,})\(/,t=e.exec(this.constructor.toString());return t&&t.length>1?t[1]:""},t.prototype.getMetadata=function(){return this.manager.findSceneMetadata(this._entity)},t.prototype.getComponent=function(e){var t=this.manager.findSceneComponent(e,this._entity);return null!=t?t:null},t.prototype.getComponents=function(e){var t=this.manager.findSceneComponents(e,this._entity);return null!=t?t:null},t.prototype.getLensFlareSystem=function(e){return this.manager.findSceneLensFlareSystem(e,this._entity)},t.prototype.getLensFlareSystems=function(){return this.manager.findSceneLensFlareSystems(this._entity)},t.prototype.registerInstance=function(e){e.ready&&e.manager.onready(function(){e.ready()}),e.scene.registerBeforeRender(e._before),e.scene.registerAfterRender(e._after)},t.prototype.updateInstance=function(e){null!=e&&null!=e.entity&&(e._started?null!=e._before&&e._started&&e.tick&&(e.update(),e.updateIntersectionList&&e.updateIntersectionList()):(e.start(),e._started=!0))},t.prototype.afterInstance=function(e){null!=e&&null!=e.entity&&null!=e._after&&e._started&&e.tick&&e.after()},t.DestroyInstance=function(e){e.tick=!1,e.scene.unregisterBeforeRender(e._before),e.scene.unregisterAfterRender(e._after);try{e.destroy()}catch(t){}e.disposeSceneComponent&&e.disposeSceneComponent(),null!=e._prefab&&(e._prefab.dispose(),e._prefab=null),e.entity=null,e._started=!1,e._before=null,e._after=null,e._properties=null,e._engine=null,e._scene=null,e._manager=null,e.register=null,e.dispose=null},t}();e.SceneComponent=t;var n=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._camera=null,i._orthoSize=0,i._orthoUpdate=!1,i._camera=e,i}return __extends(n,t),Object.defineProperty(n.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),n.prototype.setupOrthographicCamera=function(t,n){null!=this.camera&&this._camera.mode===e.Camera.ORTHOGRAPHIC_CAMERA&&(this._orthoSize=t,this.updateOrthographicSize(),this._orthoUpdate===!1&&(this._orthoUpdate=n,this._orthoUpdate===!0&&window.addEventListener("resize",this.updateOrthographicSize)))},n.prototype.updateOrthographicSize=function(){if(null!=this.camera&&0!==this._orthoSize){var e=this.scene.getEngine().getRenderingCanvasClientRect(),t=e.width/e.height,n=this._orthoSize,a=n*t;this._camera.orthoTop=n,this._camera.orthoBottom=-n,this._camera.orthoLeft=-a,this._camera.orthoRight=a}},n.prototype.disposeSceneComponent=function(){this._orthoUpdate===!0&&(window.removeEventListener("resize",this.updateOrthographicSize),this._orthoUpdate=!1,this._orthoSize=0),this._camera=null},n}(e.SceneComponent);e.CameraComponent=n;var a=function(e){function t(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=e.call(this,t,n,a,r)||this;return i._light=null,i._light=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0}),t.prototype.disposeSceneComponent=function(){this._light=null},t}(e.SceneComponent);e.LightComponent=a;var r=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._mesh=null,i._mesh=e,i}return __extends(n,t),Object.defineProperty(n.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),n.prototype.getChildMesh=function(t,n,a,r){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===a&&(a=!0),void 0===r&&(r=null),this.manager.findSceneChildMesh(t,this._mesh,n,a,r)},n.prototype.getCollisionMesh=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=null),this.manager.findSceneCollisionMesh(this._mesh,e,t)},n.prototype.getSocketMesh=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=null),this.manager.findSceneSocketMesh(e,this._mesh,t,n)},n.prototype.getSocketMeshes=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=null),this.manager.findSceneSocketMeshes(this._mesh,e,t)},n.prototype.getParticleSystem=function(e){return this.manager.findSceneParticleSystem(e,this._mesh)},n.prototype.getParticleSystems=function(){return this.manager.findSceneParticleSystems(this._mesh)},Object.defineProperty(n.prototype,"onCollisionEvent",{get:function(){var e=null;return null!=this._mesh.metadata&&this._mesh.metadata.api&&null!=this._mesh.metadata.collisionEvent&&(e=this._mesh.metadata.collisionEvent),e},set:function(e){if(null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=e),null!=this._mesh.physicsImpostor){var t=this._mesh.physicsImpostor;t.onCollideEvent=null!=e?this.updatePhysicsCollisionEvent:null}},enumerable:!0,configurable:!0}),n.prototype.updatePhysicsCollisionEvent=function(e,t){if(null!=e.object&&null!=t.object){var n=e.object;if(null!=n&&null!=n.metadata&&null!=n.metadata.collisionEvent){var a=t.object;if(null!=a){var r="Untagged";null!=a.metadata&&null!=a.metadata.tagName&&""!==a.metadata.tagName&&(r=a.metadata.tagName),n.metadata.collisionEvent(a,r)}}}},n.prototype.disposeSceneComponent=function(){if(null!=this._mesh){if(null!=this._mesh.skeleton&&null!=this._mesh.skeleton.bones&&this._mesh.skeleton.bones.length>0&&this._mesh.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)}),null!=this._mesh.physicsImpostor){var e=this._mesh.physicsImpostor;null!=e.onCollideEvent&&(e.onCollideEvent=null)}null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=null)}this._mesh=null},n}(e.SceneComponent);e.MeshComponent=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=this;if(e.setupOrthographicCamera){var t=this.getProperty("orthoSize",5),n=this.getProperty("resizeCameras",!0);e.setupOrthographicCamera(t,n)}},t}(e.CameraComponent);e.OrthoController=i;var o=function(){function t(t){this._entity=null,this.slerpIdentity=null,this._entity=t,this.slerpIdentity=e.Quaternion.Identity()}return t.prototype.rotate=function(t,n,a,r){void 0===r&&(r=e.RotateOrder.ZXY);var i=null;return null!=this._entity&&(null==this._entity.rotationQuaternion&&(this._entity.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._entity.rotation.y,this._entity.rotation.x,this._entity.rotation.z)),i=r===e.RotateOrder.XYZ?this._entity.addRotation(t,0,0).addRotation(0,n,0).addRotation(0,0,a):r===e.RotateOrder.XZY?this._entity.addRotation(t,0,0).addRotation(0,0,a).addRotation(0,n,0):r===e.RotateOrder.ZXY?this._entity.addRotation(0,0,a).addRotation(t,0,0).addRotation(0,n,0):r===e.RotateOrder.ZYX?this._entity.addRotation(0,0,a).addRotation(0,n,0).addRotation(t,0,0):r===e.RotateOrder.YZX?this._entity.addRotation(0,n,0).addRotation(0,0,a).addRotation(t,0,0):this._entity.addRotation(t,n,a)),i},t.prototype.lookAtPosition=function(t,n,a,r,i,o){void 0===n&&(n=0);var l=null;return null!=this._entity&&(null==this._entity.rotationQuaternion&&(this._entity.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._entity.rotation.y,this._entity.rotation.x,this._entity.rotation.z)),null!=this.slerpIdentity&&n>0&&this.slerpIdentity.copyFrom(this._entity.rotationQuaternion),l=this._entity.lookAt(t,a,r,i,o),null!=this.slerpIdentity&&n>0&&e.Quaternion.SlerpToRef(this.slerpIdentity,this._entity.rotationQuaternion,n,this._entity.rotationQuaternion)),l},t.prototype.dispose=function(){this._entity=null,this.slerpIdentity=null},t}();e.MeshRotator=o;var l=function(){function e(e){this._metadata=null,this._metadata=e}return Object.defineProperty(e.prototype,"type",{get:function(){return this._metadata.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prefab",{get:function(){return this._metadata.prefab},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._metadata.state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this._metadata.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectName",{get:function(){return this._metadata.objectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this._metadata.tagName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerIndex",{get:function(){return this._metadata.layerIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerName",{get:function(){return this._metadata.layerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"areaIndex",{get:function(){return this._metadata.areaIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navAgent",{get:function(){return this._metadata.navAgent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meshLink",{get:function(){return this._metadata.meshLink},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meshObstacle",{get:function(){return this._metadata.meshObstacle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowCastingMode",{get:function(){return this._metadata.shadowCastingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"socketList",{get:function(){return this._metadata.socketList},enumerable:!0,configurable:!0}),e.prototype.setProperty=function(e,t){null!=this._metadata.properties&&(this._metadata.properties[e]=t)},e.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._metadata.properties&&(n=this._metadata.properties[e]),null==n&&(n=t),null!=n?n:null},e}();e.ObjectMetadata=l;var s=function(){function e(){}return e}();e.MachineState=s;var c=function(){function e(){}return e}();e.TransitionCheck=c;var u;!function(e){e[e.NoScale=1]="NoScale",e[e.Deg2Rad=.0174532924]="Deg2Rad",e[e.Rad2Deg=57.29578]="Rad2Deg",e[e.DiagonalSpeed=.7071]="DiagonalSpeed",e[e.MinimumTimeout=.25]="MinimumTimeout",e[e.SpeedCompensator=1.05]="SpeedCompensator"}(u=e.Constants||(e.Constants={}));var p;!function(e){e[e.YXZ=0]="YXZ",e[e.YZX=1]="YZX",e[e.XYZ=2]="XYZ",e[e.XZY=3]="XZY",e[e.ZXY=4]="ZXY",e[e.ZYX=5]="ZYX"}(p=e.RotateOrder||(e.RotateOrder={}));var m;!function(e){e[e.Clip=0]="Clip",e[e.Tree=1]="Tree"}(m=e.MotionType||(e.MotionType={}));var d;!function(e){e[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(d=e.AnimatorParameterType||(e.AnimatorParameterType={}));var g;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(g=e.SearchType||(e.SearchType={}));var h;!function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four"}(h=e.PlayerNumber||(e.PlayerNumber={}));var y;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360"}(y=e.GamepadType||(e.GamepadType={}));var f;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(f=e.JoystickButton||(e.JoystickButton={}));var S;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(S=e.Xbox360Trigger||(e.Xbox360Trigger={}));var b;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(b=e.UserInputPointer||(e.UserInputPointer={}));var M;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(M=e.UserInputAxis||(e.UserInputAxis={}));var v;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(v=e.UserInputKey||(e.UserInputKey={}));var V;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces",e[e.CheckCollision=2]="CheckCollision"}(V=e.MovementType||(e.MovementType={}));var Z;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(Z=e.CollisionContact||(e.CollisionContact={}));var C;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(C=e.IntersectionPrecision||(e.IntersectionPrecision={}));var _;!function(e){e[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual"}(_=e.ConditionMode||(e.ConditionMode={}));var k;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource"}(k=e.InterruptionSource||(e.InterruptionSource={}));var I;!function(e){e[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct",e[e.Clip=5]="Clip"}(I=e.BlendTreeType||(e.BlendTreeType={}));var N;!function(e){e[e.Lower=0]="Lower",e[e.Upper=1]="Upper"}(N=e.BlendTreePosition||(e.BlendTreePosition={}));var T=function(){function e(){}return e.JoystickRightHandleColor="yellow",e.JoystickLeftSensibility=1,e.JoystickRightSensibility=1,e.JoystickDeadStickValue=.1,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!1,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.PointerAngularSensibility=1,e.PointerWheelDeadZone=.1,e}();e.UserInputOptions=T}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var n=this;if(this._url="/",this._time=0,this._timing=!1,this._filename=null,this._input=!1,this._scene=null,this._navmesh=null,this._navigation=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localReadyState=null,this._localSceneReady=!1,this._sunlightDirection=null,this._sunlightIdentifier=null,this._environmentTextureName=null,this._playerOneCamera=null,this._playerTwoCamera=null,this._playerThreeCamera=null,this._playerFourCamera=null,this._defaultControllers=!0,this._leftControllerStick=null,this._rightControllerStick=null,this._leftControllerPrefab=null,this._rightControllerPrefab=null,this._onready=[],null==t)throw new Error("Null host scene obejct specified.");this._url="/",this._time=0,this._timing=!0,this._filename=null,this._scene=t,this._input=!1,this._onready=[],this._vrhelper=null,this._navmesh=null,this._navigation=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localSceneReady=!1,this._localReadyState={state:"localReadyState"},this._sunlightDirection=e.Vector3.Zero(),this._sunlightIdentifier=null,this._playerOneCamera=null,this._playerTwoCamera=null,this._playerThreeCamera=null,this._playerFourCamera=null,this._defaultControllers=!0,this._leftControllerStick=null,this._rightControllerStick=null,this._leftControllerPrefab=null,this._rightControllerPrefab=null,this._environmentTextureName=null,e.SceneManager.me=this,e.SceneManager.engine=this._scene.getEngine(),e.SceneManager.prefabs={},e.SceneManager.orphans=null,e.SceneManager.physicsViewer=null,e.SceneManager.enableLocking=!1,e.SceneManager.pointerLocked=!1,e.SceneManager.stereoCameras=!0,e.SceneManager.multiPlayerView=!1,e.SceneManager.multiPlayerCount=1,e.SceneManager.rightHanded=this._scene.useRightHandedSystem,e.SceneManager.showRenderStats=!1,e.SceneManager.sceneRenderStats=0,e.SceneManager.staticVertexLimit=!1,e.SceneManager.showDebugSockets=!1,e.SceneManager.showPhysicsImposter=!1,e.SceneManager.colliderVisibility=.25,e.SceneManager.socketColliderSize=.125,this.addLoadingState(this._localReadyState),e.SceneManager.engine.webGLVersion<2&&e.Tools.Warn("Babylon.js performance monitor detected webgl version 1."),document.addEventListener("pointerlockchange",this.pointerLockHandler),document.addEventListener("mspointerlockchange",this.pointerLockHandler),document.addEventListener("mozpointerlockchange",this.pointerLockHandler),document.addEventListener("webkitpointerlockchange",this.pointerLockHandler),this._scene.registerBeforeRender(this._beforeRender),this._scene.registerAfterRender(this._afterRender),this._scene.onDispose=function(){n.dispose()}}return t.GetVersion=function(){return"3.3.0"},t.GetInstance=function(){return e.SceneManager.me?e.SceneManager.me:null},t.GetStatistics=function(){return e.SceneManager.showRenderStats===!0&&null!=e.SceneManager.renderStatsInstance?e.SceneManager.renderStatsInstance:null},t.CreateScene=function(t){var n=new e.Scene(t);return e.Utilities.RegisterSceneManager(n),n},t.LoadScene=function(t,n,a,r,i,o,l){return e.SceneManager.AppendScene(t,n,e.SceneManager.CreateScene(a),r,i,o,l)},t.AppendScene=function(t,n,a,r,i,o,l){var s=a;null==s.manager&&e.Utilities.RegisterSceneManager(a),null!=s.manager&&(s.manager._url=t);var c=function(t){e.Utilities.ParseSceneMetadata(t),e.Utilities.ExecuteSceneReady(t),null!=r&&r(t)};return e.SceneLoader.Append(t,n,a,c,i,o,l)},t.ImportMeshes=function(t,n,a,r,i,o,l,s){var c=r;null==c.manager&&e.Utilities.RegisterSceneManager(r);var u=function(t,n,a,o){e.Utilities.ParseImportMetadata(t,r),null!=i&&i(t,n,a,o)};return e.SceneLoader.ImportMesh(t,n,a,r,u,o,l,s)},t.AttachComponent=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={}),e.Utilities.RegisterSceneComponent(t,n,a,r)},t.OnWindowLoad=function(e){null!=e&&(window.ontoolkitload=e)},t.OnDeviceReady=function(e){null!=e&&(window.ontoolkitdevice=e)},t.ExecuteWhenReady=function(t){null!=t&&e.SceneManager.readies.push(t)},t.IsOculusBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/OculusBrowser/i)&&(e=!0),e},t.IsSamsungBrowser=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/SamsungBrowser/i)&&(e=!0),e},t.IsWindowsPhone=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)&&(e=!0),e},t.IsBlackBerry=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/BlackBerry/i)&&(e=!0),e},t.IsOperaMini=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Opera Mini/i)&&(e=!0),e},t.IsAndroid=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Android/i)&&(e=!0),e},t.IsWebOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/webOS/i)&&(e=!0),e},t.IsIOS=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(e=!0),e},t.IsIPHONE=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPhone/i)&&(e=!0),e},t.IsIPAD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPad/i)&&(e=!0),e},t.IsIPOD=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/iPod/i)&&(e=!0),e},t.IsIE11=function(){return void 0!==navigator.msMaxTouchPoints},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone|iPad|iPod/i)||t.match(/BlackBerry/i)||t.match(/Opera Mini/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsCordova=function(){return null!=window.cordova},t.IsWindows=function(){return"undefined"!=typeof Windows&&"undefined"!=typeof Windows.UI&&"undefined"!=typeof Windows.System&&"undefined"!=typeof Windows.Foundation},t.IsPlaystation=function(){var e=!1;return null!=navigator&&null!=navigator.userAgent&&navigator.userAgent.match(/Playstation/i)&&(e=!0),e},t.IsXboxOne=function(){var t=!1;if(e.SceneManager.IsWindows()&&"undefined"!=typeof Windows.System.Profile&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){var n=Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;n.match(/Xbox/i)&&(t=!0)}return t},t.IsXboxLive=function(){return e.SceneManager.IsWindows()&&"undefined"!=typeof Microsoft&&"undefined"!=typeof Microsoft.Xbox&&"undefined"!=typeof Microsoft.Xbox.Services},t.IsWebAssembly=function(){return"undefined"!=typeof WebAssembly},t.IsStereoCameras=function(){return e.SceneManager.stereoCameras},t.IsMultiPlayerView=function(){return e.SceneManager.multiPlayerView},t.GetMultiPlayerCount=function(){return e.SceneManager.multiPlayerCount},t.IsFirelightEnabled=function(){return null!=window.FMODModule},t.GetFirelightAudioMode=function(){return null!=window.firelightAudio?window.firelightAudio:0},t.CreateGenericPromise=function(e){return window.createGenericPromise?window.createGenericPromise(e):null},t.ResolveGenericPromise=function(e){return window.resolveGenericPromise?window.resolveGenericPromise(e):null},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=n.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},t.AlertMessage=function(t,n){void 0===n&&(n="Babylon.js");var a=null;return e.SceneManager.IsWindows()?a=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),a},t.GetWebGLVersionString=function(){var t="WebGL - Unknown";if(null!=e.SceneManager.engine){var n=e.SceneManager.engine;if(null!=n){var a=n.getGlInfo();null!=a&&(t=a.version+" - "+a.renderer)}}return t},t.GetWebGLVersionNumber=function(){var t=0;if(null!=e.SceneManager.engine){var n=e.SceneManager.engine;null!=n&&(t=n.webGLVersion)}return t},t.GetWebVRLeftController=function(){return e.SceneManager.me?e.SceneManager.me._leftControllerStick:null},t.GetWebVRRightController=function(){return e.SceneManager.me?e.SceneManager.me._rightControllerStick:null},t.GetWebVRLeftControllerPrefab=function(){return e.SceneManager.me?e.SceneManager.me._leftControllerPrefab:null},t.GetWebVRRightControllerPrefab=function(){return e.SceneManager.me?e.SceneManager.me._rightControllerPrefab:null},t.ShowWebVRDefaultControllers=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null),e.SceneManager.me&&(null!=e.SceneManager.me._leftControllerStick&&(e.SceneManager.me._leftControllerStick.mesh.setEnabled(!1),e.SceneManager.me._leftControllerStick.attachToMesh(e.SceneManager.me._leftControllerStick.defaultModel),e.SceneManager.me._leftControllerStick.mesh.setEnabled(!0),e.SceneManager.me._defaultControllers=!0),null!=e.SceneManager.me._rightControllerStick&&(e.SceneManager.me._rightControllerStick.mesh.setEnabled(!1),e.SceneManager.me._rightControllerStick.attachToMesh(e.SceneManager.me._rightControllerStick.defaultModel),e.SceneManager.me._rightControllerStick.mesh.setEnabled(!0),e.SceneManager.me._defaultControllers=!0),null!=e.SceneManager.me.webvr&&(null!=t&&(e.SceneManager.me.webvr.displayGaze=t),null!=n&&(e.SceneManager.me.webvr.displayLaserPointer=n)))},t.ShowWebVRCustomControllers=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null),e.SceneManager.me&&(null!=e.SceneManager.me._leftControllerStick&&(e.SceneManager.me._leftControllerStick.mesh.setEnabled(!1),e.SceneManager.me._leftControllerStick.attachToMesh(e.SceneManager.me._leftControllerPrefab),e.SceneManager.me._leftControllerStick.mesh.setEnabled(!0),e.SceneManager.me._defaultControllers=!1),null!=e.SceneManager.me._rightControllerStick&&(e.SceneManager.me._rightControllerStick.mesh.setEnabled(!1),e.SceneManager.me._rightControllerStick.attachToMesh(e.SceneManager.me._rightControllerPrefab),e.SceneManager.me._rightControllerStick.mesh.setEnabled(!0),e.SceneManager.me._defaultControllers=!1),null!=e.SceneManager.me.webvr&&(null!=t&&(e.SceneManager.me.webvr.displayGaze=t),null!=n&&(e.SceneManager.me.webvr.displayLaserPointer=n)))},Object.defineProperty(t,"StaticIndex",{get:function(){return 30},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PrefabIndex",{get:function(){return 31},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"webvr",{get:function(){return this._vrhelper},set:function(e){this._vrhelper=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deltaTime",{get:function(){return null!=e.SceneManager.engine?e.SceneManager.engine.getDeltaTime()/1e3:0},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype._beforeRender=function(){e.SceneManager.showRenderStats===!0&&null!=e.SceneManager.renderStatsInstance&&e.SceneManager.renderStatsInstance.begin()},t.prototype._afterRender=function(){e.SceneManager.showRenderStats===!0&&null!=e.SceneManager.renderStatsInstance&&e.SceneManager.renderStatsInstance.end();var t=e.SceneManager.me;null!=t&&(t._timing&&(t._time+=t.deltaTime,t._time>=e.SceneManager.max&&(t._time=0)),t._input&&e.SceneManager.updateUserInput())},t.prototype._parseSceneMetadata=function(){if(null!=this._scene.metadata&&null!=this._scene.metadata.properties){if(this._scene.metadata.properties.sceneFilename&&null!=this._scene.metadata.properties.sceneFilename&&(this._filename=this._scene.metadata.properties.sceneFilename),this._scene.metadata.properties.sunlightIndentifier&&null!=this._scene.metadata.properties.sunlightIndentifier&&(this._sunlightIdentifier=this._scene.metadata.properties.sunlightIndentifier),this._scene.metadata.properties.sunlightDirection&&null!=this._scene.metadata.properties.sunlightDirection){var t=this._scene.metadata.properties.sunlightDirection;null!=t&&t.length>=3&&(this._sunlightDirection=new e.Vector3(t[0],t[1],t[2]))}this._scene.metadata.properties.environmentTextureName&&null!=this._scene.metadata.properties.environmentTextureName&&(this._environmentTextureName=this._scene.metadata.properties.environmentTextureName),
this._scene.metadata.properties.colliderVisibility&&null!=this._scene.metadata.properties.colliderVisibility&&(e.SceneManager.colliderVisibility=this._scene.metadata.properties.colliderVisibility),this._scene.metadata.properties.socketColliderSize&&null!=this._scene.metadata.properties.socketColliderSize&&(e.SceneManager.socketColliderSize=this._scene.metadata.properties.socketColliderSize),this._scene.metadata.properties.sceneRenderStats&&null!=this._scene.metadata.properties.sceneRenderStats&&(e.SceneManager.sceneRenderStats=this._scene.metadata.properties.sceneRenderStats),this._scene.metadata.properties.hasOwnProperty("showRenderStats")&&(e.SceneManager.showRenderStats=this._scene.metadata.properties.showRenderStats),this._scene.metadata.properties.hasOwnProperty("showDebugSockets")&&(e.SceneManager.showDebugSockets=this._scene.metadata.properties.showDebugSockets),this._scene.metadata.properties.hasOwnProperty("showPhysicsImposter")&&(e.SceneManager.showPhysicsImposter=this._scene.metadata.properties.showPhysicsImposter),this._scene.metadata.properties.hasOwnProperty("staticVertexLimit")&&(e.SceneManager.staticVertexLimit=this._scene.metadata.properties.staticVertexLimit);var n=(this._scene.metadata.properties.physicsEngine?this._scene.metadata.properties.physicsEngine:"cannon",!!this._scene.metadata.properties.enablePhysics&&this._scene.metadata.properties.enablePhysics);if(n===!0){var a=new e.CannonJSPlugin((!1),10);this._scene.enablePhysics(this._scene.gravity,a)}}var r=[];e.SceneManager.parseSceneCameras(this._scene.cameras,this._scene,r),e.SceneManager.parseSceneLights(this._scene.lights,this._scene,r),e.SceneManager.parseSceneMeshes(this._scene.meshes,this._scene,r),r.length>0&&(r.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),r.forEach(function(e){e.instance.register()})),e.SceneManager.IsIE11()||"undefined"!=typeof Stats&&e.SceneManager.showRenderStats===!0&&null==e.SceneManager.renderStatsInstance&&(e.SceneManager.renderStatsInstance=new Stats,e.SceneManager.renderStatsInstance.showPanel(e.SceneManager.sceneRenderStats),document.body.appendChild(e.SceneManager.renderStatsInstance.dom))},t.prototype.dispose=function(){this._scene.unregisterBeforeRender(this._beforeRender),this._scene.unregisterAfterRender(this._afterRender),document.removeEventListener("pointerlockchange",this.pointerLockHandler),document.removeEventListener("mspointerlockchange",this.pointerLockHandler),document.removeEventListener("mozpointerlockchange",this.pointerLockHandler),document.removeEventListener("webkitpointerlockchange",this.pointerLockHandler),e.SceneManager.me=null,e.SceneManager.engine=null,e.SceneManager.prefabs=null,e.SceneManager.orphans=null,e.SceneManager.stereoCameras=!0,e.SceneManager.rightHanded=!0,null!=e.SceneManager.orphans&&(e.SceneManager.orphans.dispose(),e.SceneManager.orphans=null),null!=e.SceneManager.physicsViewer&&(e.SceneManager.physicsViewer.dispose(),e.SceneManager.physicsViewer=null),this.disableUserInput(),this._time=0,this._navmesh=null,this._timing=!1,this._onready=null,this._navigation=null,this._defaultControllers=!0,this._leftControllerStick=null,this._rightControllerStick=null,this._playerOneCamera=null,null!=this._playerTwoCamera&&(this._playerTwoCamera.dispose(),this._playerTwoCamera=null),null!=this._playerThreeCamera&&(this._playerThreeCamera.dispose(),this._playerThreeCamera=null),null!=this._playerFourCamera&&(this._playerFourCamera.dispose(),this._playerFourCamera=null),null!=this._leftControllerPrefab&&(this._leftControllerPrefab.dispose(),this._leftControllerPrefab=null),null!=this._rightControllerPrefab&&(this._rightControllerPrefab.dispose(),this._rightControllerPrefab=null),null!=this._vrhelper&&(this._vrhelper.dispose(),this._vrhelper=null);var t=this._scene;t.manager&&(t.manager=null),t=null,this._scene=null},t.prototype.alert=function(t,n){return void 0===n&&(n="Babylon.js"),e.SceneManager.AlertMessage(t,n)},t.prototype.once=function(e){var t=this;if(null!=e){var n=!1,a=null;a=function(){t._scene.unregisterBeforeRender(a),a=null,n===!1&&(n=!0,e())},this._scene.registerBeforeRender(a)}},t.prototype.delay=function(e,t){var n=this,a=null;return a=window.requestTimeout(function(){null!=a&&n.cancelDelay(a),null!=e&&e()},t)},t.prototype.cancelDelay=function(e){window.clearRequestTimeout(e)},t.prototype.repeat=function(e,t){return window.requestInterval(e,t)},t.prototype.cancelRepeat=function(e){window.clearRequestInterval(e)},t.prototype.enableTime=function(){this._time=0,this._timing=!0},t.prototype.disableTime=function(){this._time=0,this._timing=!1},t.prototype.safeDestroy=function(t,n,a){void 0===n&&(n=5),void 0===a&&(a=!1),a===!0&&t.setEnabled(!1),n>0?this.delay(function(){e.SceneManager.DestroyComponents(t),e.SceneManager.DisposeOwner(t)},n):(e.SceneManager.DestroyComponents(t),e.SceneManager.DisposeOwner(t))},t.prototype.getMainCamera=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;switch(t){case e.PlayerNumber.One:n=this._playerOneCamera;break;case e.PlayerNumber.Two:n=this._playerTwoCamera;break;case e.PlayerNumber.Three:n=this._playerThreeCamera;break;case e.PlayerNumber.Four:n=this._playerFourCamera}return n},t.prototype.getSceneName=function(){return null!=this._filename&&""!==this._filename?this._filename:"Unknown.babylon"},t.prototype.getScenePath=function(){return this._url},t.prototype.getSunlight=function(){return null!=this._sunlightIdentifier&&""!==this._sunlightIdentifier?this._scene.getLightByID(this._sunlightIdentifier):null},t.prototype.getSunlightDirection=function(){return this._sunlightDirection},t.prototype.getEnvironmentTextureName=function(){return this._environmentTextureName},t.prototype.addLoadingState=function(e){this._scene._addPendingData(e)},t.prototype.removeLoadingState=function(e){this._scene._removePendingData(e)},t.prototype.onready=function(e){null!=e&&(this._localSceneReady===!0?e():this._onready.push(e))},t.prototype._executeWhenReady=function(){null!=this._scene.metadata&&null!=this._scene.metadata.imports?(this._loadQueueIndex=0,this._loadQueueScenes=this._scene.metadata.imports,this._loadQueueScenes.length>0?(this._loadQueueCount=this._loadQueueScenes.length,this._loadQueueImports()):this._executeLocalReady()):this._executeLocalReady()},t.prototype._executeLocalReady=function(){var t=this;if(null!=e.SceneManager.readies&&e.SceneManager.readies.length>0&&e.SceneManager.readies.forEach(function(e){e(t._scene,t)}),e.SceneManager.readies=[],null!=this._onready&&this._onready.length>0&&(this._onready.forEach(function(e){e()}),this._onready=null),this._localSceneReady=!0,null!=this._scene.metadata&&null!=this._scene.metadata.properties){if(this._scene.metadata.properties.enableUserInput===!0){var n=this._scene.metadata.properties.userInput,a=n.joystickInputValue;0!==a&&this._scene.metadata.properties.virtualJoystickAttached===!0&&(a=0,e.Tools.Warn("Virtual joystick camera attached, disabled manual joystick input.")),this.enableUserInput({preventDefault:this._scene.metadata.properties.preventDefault,useCapture:this._scene.metadata.properties.useCapture,enableVirtualJoystick:1===a||2===a&&e.SceneManager.IsMobile(),disableRightStick:n.disableRightStick});var r=n.joystickRightColorText;null!=r&&""!==r&&(e.UserInputOptions.JoystickRightHandleColor=r),e.UserInputOptions.JoystickLeftSensibility=n.joystickLeftLevel,e.UserInputOptions.JoystickRightSensibility=n.joystickRightLevel,e.UserInputOptions.JoystickDeadStickValue=n.joystickDeadStick,e.UserInputOptions.GamepadDeadStickValue=n.padDeadStick,e.UserInputOptions.GamepadLStickXInverted=n.padLStickXInvert,e.UserInputOptions.GamepadLStickYInverted=n.padLStickYInvert,e.UserInputOptions.GamepadRStickXInverted=n.padRStickXInvert,e.UserInputOptions.GamepadRStickYInverted=n.padRStickYInvert,e.UserInputOptions.GamepadLStickSensibility=n.padLStickLevel,e.UserInputOptions.GamepadRStickSensibility=n.padRStickLevel,e.UserInputOptions.PointerAngularSensibility=n.mouseAngularLevel,e.UserInputOptions.PointerWheelDeadZone=n.wheelDeadZone}this._scene.metadata.properties.pointerLock===!0&&(this.attachPointerLock(),this.enablePointerLock())}null!=this._localReadyState&&(this.removeLoadingState(this._localReadyState),this._localReadyState=null)},t.prototype._loadQueueImports=function(){var t=this,n=this._loadQueueIndex+1;if(n>this._loadQueueCount)this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._executeLocalReady();else{var a=this._loadQueueScenes[this._loadQueueIndex];e.Tools.Log("Babylon.js importing scene meshes from: "+a),this._loadQueueIndex++,navigator.project.importMeshes(a,function(){t._loadQueueImports()},null,function(n,a,r){e.Tools.Warn(a),t._loadQueueImports()})}},t.prototype.popupDebug=function(e){void 0===e&&(e=0),this._scene.debugLayer&&(this._scene.debugLayer.hide(),this._scene.debugLayer.show({enablePopup:!0,globalRoot:null}))},t.prototype.toggleDebug=function(t,n,a){if(void 0===t&&(t=!1),void 0===n&&(n=0),void 0===a&&(a=null),this._scene.debugLayer)if(e.SceneManager.debugLayerVisible===!0){if(e.SceneManager.debugLayerVisible=!1,null!=e.SceneManager.renderStatsInstance&&null!=e.SceneManager.renderStatsInstance.dom){var r=e.SceneManager.renderStatsInstance.dom;r.style.visibility="visible"}this._scene.debugLayer.hide()}else{if(e.SceneManager.debugLayerVisible=!0,null!=e.SceneManager.renderStatsInstance&&null!=e.SceneManager.renderStatsInstance.dom){var r=e.SceneManager.renderStatsInstance.dom;r.style.visibility="hidden"}this._scene.debugLayer.show({enablePopup:t,globalRoot:a})}},t.prototype.setMultiPlayerViewLayout=function(t){var n=!1,a=e.Scalar.Clamp(t,1,4);if(e.SceneManager.IsMultiPlayerView()){var r=[];null!=this._playerOneCamera&&null!=this._playerTwoCamera&&null!=this._playerThreeCamera&&null!=this._playerFourCamera?1===a?(this._playerOneCamera.viewport=new e.Viewport(0,0,1,1),this._playerTwoCamera.viewport=new e.Viewport(0,0,0,0),this._playerTwoCamera.setEnabled(!1),this._playerThreeCamera.viewport=new e.Viewport(0,0,0,0),this._playerThreeCamera.setEnabled(!1),this._playerFourCamera.viewport=new e.Viewport(0,0,0,0),this._playerFourCamera.setEnabled(!1),r.push(this._playerOneCamera)):2===a?(e.SceneManager.stereoCameras===!0?(this._playerOneCamera.viewport=new e.Viewport(0,0,.5,1),this._playerTwoCamera.viewport=new e.Viewport(.5,0,.5,1)):(this._playerOneCamera.viewport=new e.Viewport(0,.5,1,.5),this._playerTwoCamera.viewport=new e.Viewport(0,0,1,.5)),this._playerTwoCamera.setEnabled(!0),this._playerThreeCamera.viewport=new e.Viewport(0,0,0,0),this._playerThreeCamera.setEnabled(!1),this._playerFourCamera.viewport=new e.Viewport(0,0,0,0),this._playerFourCamera.setEnabled(!1),r.push(this._playerOneCamera),r.push(this._playerTwoCamera)):3===a?(this._playerOneCamera.viewport=new e.Viewport(0,0,.5,1),this._playerTwoCamera.viewport=new e.Viewport(.5,.5,.5,.5),this._playerTwoCamera.setEnabled(!0),this._playerThreeCamera.viewport=new e.Viewport(.5,0,.5,.5),this._playerThreeCamera.setEnabled(!0),this._playerFourCamera.viewport=new e.Viewport(0,0,0,0),this._playerFourCamera.setEnabled(!1),r.push(this._playerOneCamera),r.push(this._playerTwoCamera),r.push(this._playerThreeCamera)):4===a&&(this._playerOneCamera.viewport=new e.Viewport(0,.5,.5,.5),this._playerTwoCamera.viewport=new e.Viewport(0,0,.5,.5),this._playerTwoCamera.setEnabled(!0),this._playerThreeCamera.viewport=new e.Viewport(.5,.5,.5,.5),this._playerThreeCamera.setEnabled(!0),this._playerFourCamera.viewport=new e.Viewport(.5,0,.5,.5),this._playerFourCamera.setEnabled(!0),r.push(this._playerOneCamera),r.push(this._playerTwoCamera),r.push(this._playerThreeCamera),r.push(this._playerFourCamera)):e.Tools.Warn("Babylon.js camera rig failed to initialize multi player cameras"),r.length>0?(e.SceneManager.multiPlayerCount=a,this._scene.activeCameras=r,n=!0):e.Tools.Warn("Babylon.js camera rig failed to initialize multi player views")}else e.Tools.Warn("Babylon.js camera rig multi player view option not enabled");return n},t.prototype.rayCast=function(e,t,n){return this._scene.pickWithRay(e,t,n)},t.prototype.multiRayCast=function(e,t){return this._scene.multiPickWithRay(e,t)},t.prototype.getMaterialInstance=function(e,t){void 0===t&&(t=null);var n=this._scene.getMaterialByName(e);return null==n&&null!=t&&(n=t(e)),null!=n?n:null},t.prototype.hasPrefabMesh=function(t){var n="Prefab."+t;return null!=e.SceneManager.prefabs[n]},t.prototype.getPrefabMesh=function(t){var n=null,a="Prefab."+t;return this.hasPrefabMesh(t)&&(n=e.SceneManager.prefabs[a]),n},t.prototype.instantiatePrefab=function(t,n,a,r,i,o){var l=this;void 0===a&&(a=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var s=null;if(null!=this._scene){var c="Prefab."+t;if(this.hasPrefabMesh(t)){var u=this.getPrefabMesh(t);if(null!=u)if(s=u.clone(n,o,!1,!1),null!=s){s.name=e.Utilities.ReplaceAll(s.name,"Prefab.",""),s.parent!==o&&(s.parent=o),null!=a&&(s.position=a),null!=r&&(s.rotation=r),null!=i&&(s.scaling=i);var p=null,m=s.getChildMeshes(!1);null!=m&&(p=m),null==p?p=[s]:p.unshift(s);var d={};p.forEach(function(t){if(t.name=e.Utilities.ReplaceAll(t.name,"Prefab.",""),t.setEnabled(!0),null!=t.metadata&&null!=t.metadata.shadowCastingMode&&0!==t.metadata.shadowCastingMode&&l._scene.lights.forEach(function(e){var n=e.getShadowGenerator();null!=n&&n.getShadowMap().renderList.push(t)}),null!=t.source){if(null==t.skeleton&&null!=t.source.skeleton){var n=t.source.skeleton.name+".Skeleton",a=n+"."+t.source.skeleton.id;if(t.skeleton=t.source.skeleton.clone(n,a),d[t.source.id]=t.id,null!=t.skeleton&&null!=t.skeleton.bones&&null!=t.source.skeleton.bones&&t.skeleton.bones.length===t.source.skeleton.bones.length)for(var r=t.skeleton.bones.length,i=0;i<r;i++)null==t.skeleton.bones[i].metadata&&null!=t.source.skeleton.bones[i].metadata&&(t.skeleton.bones[i].metadata=t.source.skeleton.bones[i].metadata)}}else e.Tools.Warn("Babylon.js encountered a null clone source for: "+t.name)});var g=[];p.forEach(function(t){if(null!=t.metadata&&null!=t.metadata.properties&&t.metadata.properties.sharedSkeletonId&&""!==t.metadata.properties.sharedSkeletonId&&(t.metadata.properties.sharedSkeletonId=d[t.metadata.properties.sharedSkeletonId]),null!=t.metadata&&t.metadata.tagName&&null!=t.metadata.tagName&&"[INSTANCE]"===t.metadata.tagName)if(t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.prefabSource&&null!=t.metadata.properties.prefabSource&&""!==t.metadata.properties.prefabSource){var n=t.metadata.properties.prefabSource,a=t.metadata.properties.prefabOffset,r=t.metadata.properties.prefabPosition,i=l._scene.getMeshByID(n);if(null!=i){var o=t.name,s=i.createInstance(o);null!=s?(s.parent=t.parent,null!=i.metadata&&(s.metadata=e.SceneManager.CloneMetadata(i.metadata)),a===!0&&null!=r&&r.length>=3&&(s.position=new e.Vector3(r[0],r[1],r[2])),g.push(s),l.safeDestroy(t)):e.Tools.Warn("===> Failed to create instance: "+o)}else e.Tools.Warn("===> Failed to locate prefab source: "+n)}else e.Tools.Warn("===> Failed to parse prefab metadata: "+t.name);else g.push(t)}),d=null,null!=g&&g.length>0&&e.Utilities.ParseImportMetadata(g,this._scene)}else e.Tools.Warn("Failed to create prefab of: "+c);else e.Tools.Warn("Failed to lookup prefab map: "+c)}else e.Tools.Warn("Unable to locate prefab master: "+c)}return s},t.prototype.tween=function(t,n,a,r,i,o,l,s,c,u,p){void 0===o&&(o=30),void 0===l&&(l=null),void 0===s&&(s=1),void 0===c&&(c=null),void 0===u&&(u=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var m="Tween_"+this.time.toString();return e.Animation.CreateAndStartAnimation(m,t,n,o,i,a,r,u,l,c)},t.prototype.tweenKeys=function(t,n,a,r,i,o,l,s,c,u,p){void 0===i&&(i=30),void 0===o&&(o=null),void 0===l&&(l=1),void 0===s&&(s=null),void 0===c&&(c=e.Animation.ANIMATIONTYPE_VECTOR3),void 0===u&&(u=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var m=null!=i&&i>0?i:30,d="Tween_"+this.time.toString(),g=new e.Animation(d,n,m,c,u,p);return null!=o&&g.setEasingFunction(o),g.setKeys(a),this._scene.beginDirectAnimation(t,[g],0,r,u==e.Animation.ANIMATIONLOOPMODE_RELATIVE,l,s)},t.prototype.tweenFloat=function(t,n,a,r,i,o,l,s,c,u,p){void 0===o&&(o=30),void 0===l&&(l=null),void 0===s&&(s=1),void 0===c&&(c=null),void 0===u&&(u=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var m=null!=o&&o>0?o:30,d=[{frame:0,value:a},{frame:i,value:r}],g="Tween_"+this.time.toString(),h=e.Animation.ANIMATIONTYPE_FLOAT,y=new e.Animation(g,n,m,h,u,p);return null!=l&&y.setEasingFunction(l),y.setKeys(d),this._scene.beginDirectAnimation(t,[y],0,i,u==e.Animation.ANIMATIONLOOPMODE_RELATIVE,s,c)},t.prototype.playAnimationClip=function(e,t,n,a,r,i,o){void 0===n&&(n=0),void 0===a&&(a=1),void 0===r&&(r=!0),void 0===i&&(i=null),void 0===o&&(o=null);var l=null,s=-1,c=-1,u=0,p=!1,m=!1,d=null,g=this.findSceneAnimationClip(e,t);if(null!=g&&(m=!0,d=o,s===-1&&(s=g.start,c=g.stop,u=g.behavior,p=g.behavior<2)),r){var h=t.getChildMeshes(!1);if(null!=h&&h.length>0)for(var y=0;y<h.length;y++){var f=h[y],S=null,b=this.findSceneAnimationClip(e,f);if(null!=b&&(m===!1&&(m=!0,S=o),s===-1&&(s=b.start,c=b.stop,u=b.behavior,p=b.behavior<2),s>=0&&c>=0)){this.setAnimationProperties(f,u,n);var M=null;null!=i?this._scene.beginDirectAnimation(f,i,s,c,p,a,S):this._scene.beginAnimation(f,s,c,p,a,S),null!=M&&(null==l&&(l=[]),l.push(M))}}}if(s>=0&&c>=0){this.setAnimationProperties(t,u,n);var v=null;null!=i?this._scene.beginDirectAnimation(t,i,s,c,p,a,d):this._scene.beginAnimation(t,s,c,p,a,d),null!=v&&(null==l&&(l=[]),l.push(v))}return l},t.prototype.getAnimationClips=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var a=this.findSceneAnimationClips(e);if(null==a&&t===!0){var r=e.getChildMeshes(n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];if(a=this.findSceneAnimationClips(o),null!=a)break}}return a},t.prototype.getAnimationTargets=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var a=null;if(null!=e.metadata&&null!=e.metadata.animationClips&&e.metadata.animationClips.length>0&&(null==a&&(a=[]),a.push(e)),t===!0){var r=e.getChildMeshes(n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];null!=o&&null!=o.metadata&&null!=o.metadata.animationClips&&o.metadata.animationClips.length>0&&(null==a&&(a=[]),a.push(o))}}return a},t.prototype.setAnimationProperties=function(t,n,a){if(null!=t&&(null!=t.animations&&t.animations.length>0&&e.SceneManager.SetAnimationLooping(t,n),t instanceof e.AbstractMesh)){var r=t;null!=r.skeleton&&e.SceneManager.SetSkeletonProperties(r.skeleton,n,a)}},t.prototype.applyForce=function(e,t,n){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.applyForce(t,n)},t.prototype.applyImpulse=function(e,t,n){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.applyImpulse(t,n)},t.prototype.applyFriction=function(e,t){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=e.physicsImpostor.physicsBody.material&&e.physicsImpostor.physicsBody.material.friction!==t&&(e.physicsImpostor.physicsBody.material.friction=t)},t.prototype.getMass=function(e){var t=-1;return null!=e&&null!=e.physicsImpostor&&(t=e.physicsImpostor.mass),t},t.prototype.setMass=function(e,t){null!=e&&null!=e.physicsImpostor&&(e.physicsImpostor.mass=t)},t.prototype.getRestitution=function(e){var t=-1;return null!=e&&null!=e.physicsImpostor&&(t=e.physicsImpostor.restitution),t},t.prototype.setRestitution=function(e,t){null!=e&&null!=e.physicsImpostor&&(e.physicsImpostor.restitution=t)},t.prototype.getFrictionLevel=function(e){var t=0;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=e.physicsImpostor.physicsBody.material&&(t=e.physicsImpostor.physicsBody.material.friction),t},t.prototype.getLinearVelocity=function(e){var t=null;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&(t=e.physicsImpostor.getLinearVelocity()),t},t.prototype.setLinearVelocity=function(e,t){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.setLinearVelocity(t)},t.prototype.getAngularVelocity=function(e){var t=null;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&(t=e.physicsImpostor.getAngularVelocity()),t},t.prototype.setAngularVelocity=function(e,t){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.setAngularVelocity(t)},t.prototype.showDebugImposter=function(t){null!=t&&null!=t.physicsImpostor&&null!=t.physicsImpostor.physicsBody&&(null==e.SceneManager.physicsViewer&&(e.SceneManager.physicsViewer=new e.Debug.PhysicsViewer(this._scene)),null!=e.SceneManager.physicsViewer&&e.SceneManager.physicsViewer.showImpostor(t.physicsImpostor))},t.prototype.hideDebugImposter=function(t){null!=t&&null!=t.physicsImpostor&&null!=t.physicsImpostor.physicsBody&&null!=e.SceneManager.physicsViewer&&e.SceneManager.physicsViewer.hideImpostor(t.physicsImpostor)},t.prototype.checkCollisionContact=function(e,t,n,a){void 0===a&&(a=.5);var r=!1;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&(r=!0),r},t.prototype.moveWithCollisions=function(e,t){null!=e&&null!=t&&e.moveWithCollisions(t)},t.prototype.moveWithTranslation=function(e,t){null!=e&&null!=t&&e.position.addInPlace(t)},t.prototype.turnWithRotation=function(t,n){void 0===n&&(n=0),null!=t&&0!=n&&t.rotate(e.Axis.Y,n*e.Constants.Deg2Rad)},t.prototype.findSceneComponent=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.components&&a.components.length>0)for(var r=0;r<a.components.length;r++){var i=a.components[r];if(null!=i.instance&&i.klass===e){n=i.instance;break}}}return null!=n?n:null},t.prototype.findSceneComponents=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.components&&a.components.length>0)for(var r=0;r<a.components.length;r++){var i=a.components[r];null!=i.instance&&i.klass===e&&n.push(i.instance)}}return null!=n?n:null},t.prototype.findSceneMetadata=function(t){var n=null;if(null!=t.metadata&&t.metadata.api){var a=t.metadata;n=new e.ObjectMetadata(a)}return n},t.prototype.findSceneChildMesh=function(t,n,a,r,i){void 0===a&&(a=e.SearchType.StartsWith),void 0===r&&(r=!0),void 0===i&&(i=null);var o=(null!=a?a:e.SearchType.StartsWith,n.getChildMeshes(r,i));return e.SceneManager.FindMesh(t,o,a)},t.prototype.findSceneCollisionMesh=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=null);var a=null,r=e.getChildMeshes(t,n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];if("Collider"===o.name||o.name.indexOf("_Collider")>=0||o.name.indexOf(":Collider")>=0){a=o;break}}return null==a&&(a=e),a},t.prototype.findSceneSkeleton=function(e){var t=null,n=null!=this._scene.skeletons?this._scene.skeletons.length:0;if(n>0){var a=0;for(a=0;a<n;a++){var r=this._scene.skeletons[a],i=""+r.id;if(i===e){t=r;break}}}return t},t.prototype.findSceneSocketMesh=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=null);var i=e.SceneManager.LocateOwnerSocketMesh(t,n);if(null==i){var o=n.getChildMeshes(a,r);if(null!=o&&o.length>0)for(var l=0;l<o.length;l++){var s=o[l];if(i=e.SceneManager.LocateOwnerSocketMesh(t,s),null!=i)break}}return i},t.prototype.findSceneSocketMeshes=function(t,n,a){void 0===n&&(n=!0),void 0===a&&(a=null);var r=e.SceneManager.LocateOwnerSocketMeshes(t);if(null==r){var i=t.getChildMeshes(n,a);if(null!=i&&i.length>0)for(var o=0;o<i.length;o++){var l=i[o];if(r=e.SceneManager.LocateOwnerSocketMeshes(l),null!=r)break}}return r},t.prototype.findSceneAnimationClip=function(e,t){var n=null;if(null!=t&&null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.animationClips&&a.animationClips.length>0)if(null!=e&&""!==e){var r=0;for(r=0;r<a.animationClips.length;r++)if(a.animationClips[r].name===e){n=a.animationClips[r];break}}else n=a.animationClips[0]}return n},t.prototype.findSceneAnimationClips=function(e){var t=null;if(null!=e&&null!=e.metadata&&e.metadata.api){var n=e.metadata;null!=n.animationClips&&n.animationClips.length>0&&(t=n.animationClips)}return t},t.prototype.findSceneParticleSystem=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.particleSystems&&this._scene.particleSystems.length>0)for(var a=this._scene.particleSystems.length,r=0;r<a;r++){var i=this._scene.particleSystems[r];if(i.emitter===t&&i.name===e){n=i;break}}return n},t.prototype.findSceneParticleSystems=function(e){var t=[];if(null==e)throw new Error("Null owner scene obejct specified.");return null!=this._scene.particleSystems&&this._scene.particleSystems.length>0&&this._scene.particleSystems.forEach(function(n){n.emitter===e&&t.push(n)}),t},t.prototype.findSceneLensFlareSystem=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0)for(var a=this._scene.lensFlareSystems.length,r=0;r<a;r++){var i=this._scene.lensFlareSystems[r];if(i.getEmitter()===t&&i.name===e){n=i;break}}return n},t.prototype.findSceneLensFlareSystems=function(e){var t=[];if(null==e)throw new Error("Null owner scene obejct specified.");return null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0&&this._scene.lensFlareSystems.forEach(function(n){n.getEmitter()===e&&t.push(n)}),t},t.prototype.enablePointerLock=function(){e.SceneManager.enableLocking=!0},t.prototype.disablePointerLock=function(){e.SceneManager.enableLocking=!1},t.prototype.pointerLockHandler=function(){var t=document.pointerLockElement||document.msPointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||null;t?e.SceneManager.pointerLocked=!0:e.SceneManager.pointerLocked=!1},t.prototype.attachPointerLock=function(){this._scene.onPointerObservable.add(function(t){if(e.SceneManager.enableLocking===!0&&e.SceneManager.pointerLocked===!1){var n=e.SceneManager.engine.getRenderingCanvas();null!=n&&(null!=n.requestPointerLock?n.requestPointerLock():null!=n.msRequestPointerLock?n.msRequestPointerLock():null!=n.mozRequestPointerLock?n.mozRequestPointerLock():null!=n.webkitRequestPointerLock&&n.webkitRequestPointerLock())}},e.PointerEventTypes.POINTERDOWN)},t.prototype.resetUserInput=function(){e.SceneManager.keymap={},e.SceneManager.wheel=0,e.SceneManager.clientx=0,e.SceneManager.clienty=0,e.SceneManager.mousex=0,e.SceneManager.mousey=0,e.SceneManager.vertical=0,e.SceneManager.horizontal=0,e.SceneManager.mousex2=0,e.SceneManager.mousey2=0,e.SceneManager.vertical2=0,e.SceneManager.horizontal2=0,e.SceneManager.mousex3=0,e.SceneManager.mousey3=0,e.SceneManager.vertical3=0,e.SceneManager.horizontal3=0,e.SceneManager.mousex4=0,e.SceneManager.mousey4=0,e.SceneManager.vertical4=0,e.SceneManager.horizontal4=0,e.SceneManager.x_wheel=0,e.SceneManager.x_mousex=0,e.SceneManager.x_mousey=0,e.SceneManager.x_vertical=0,e.SceneManager.x_horizontal=0,e.SceneManager.k_mousex=0,e.SceneManager.k_mousey=0,e.SceneManager.k_vertical=0,e.SceneManager.k_horizontal=0,e.SceneManager.j_mousex=0,e.SceneManager.j_mousey=0,e.SceneManager.j_vertical=0,e.SceneManager.j_horizontal=0,e.SceneManager.g_mousex1=0,e.SceneManager.g_mousey1=0,e.SceneManager.g_vertical1=0,e.SceneManager.g_horizontal1=0,e.SceneManager.g_mousex2=0,e.SceneManager.g_mousey2=0,e.SceneManager.g_vertical2=0,e.SceneManager.g_horizontal2=0,e.SceneManager.g_mousex3=0,e.SceneManager.g_mousey3=0,e.SceneManager.g_vertical3=0,e.SceneManager.g_horizontal3=0,e.SceneManager.g_mousex4=0,e.SceneManager.g_mousey4=0,e.SceneManager.g_vertical4=0,e.SceneManager.g_horizontal4=0,e.SceneManager.enableLocking=!1,e.SceneManager.pointerLocked=!1,e.SceneManager.preventDefault=!1,e.SceneManager.mouseButtonUp=[],e.SceneManager.mouseButtonDown=[],e.SceneManager.mouseButtonPress=[],e.SceneManager.keyButtonUp=[],e.SceneManager.keyButtonDown=[],e.SceneManager.keyButtonPress=[],e.SceneManager.gamepad1ButtonUp=[],e.SceneManager.gamepad1ButtonDown=[],e.SceneManager.gamepad1ButtonPress=[],e.SceneManager.gamepad1DpadUp=[],e.SceneManager.gamepad1DpadDown=[],e.SceneManager.gamepad1DpadPress=[],e.SceneManager.gamepad1LeftTrigger=[],e.SceneManager.gamepad1RightTrigger=[],e.SceneManager.gamepad2ButtonUp=[],e.SceneManager.gamepad2ButtonDown=[],e.SceneManager.gamepad2ButtonPress=[],e.SceneManager.gamepad2DpadUp=[],e.SceneManager.gamepad2DpadDown=[],e.SceneManager.gamepad2DpadPress=[],e.SceneManager.gamepad2LeftTrigger=[],e.SceneManager.gamepad2RightTrigger=[],e.SceneManager.gamepad3ButtonUp=[],e.SceneManager.gamepad3ButtonDown=[],e.SceneManager.gamepad3ButtonPress=[],e.SceneManager.gamepad3DpadUp=[],e.SceneManager.gamepad3DpadDown=[],e.SceneManager.gamepad3DpadPress=[],e.SceneManager.gamepad3LeftTrigger=[],e.SceneManager.gamepad3RightTrigger=[],e.SceneManager.gamepad4ButtonUp=[],e.SceneManager.gamepad4ButtonDown=[],e.SceneManager.gamepad4ButtonPress=[],e.SceneManager.gamepad4DpadUp=[],e.SceneManager.gamepad4DpadDown=[],e.SceneManager.gamepad4DpadPress=[],e.SceneManager.gamepad4LeftTrigger=[],e.SceneManager.gamepad4RightTrigger=[]},t.prototype.enableUserInput=function(t){void 0===t&&(t=null);var n=!(null==t||!t.preventDefault)&&t.preventDefault,a=!(null==t||!t.useCapture)&&t.useCapture,r=!(null==t||!t.enableVirtualJoystick)&&t.enableVirtualJoystick,i=!(null==t||!t.disableRightStick)&&t.disableRightStick;this._input||(this.resetUserInput(),document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.SceneManager.inputKeyUpHandler,a),document.documentElement.addEventListener("keydown",e.SceneManager.inputKeyDownHandler,a),document.documentElement.addEventListener("pointerup",e.SceneManager.inputPointerUpHandler,a),document.documentElement.addEventListener("pointerdown",e.SceneManager.inputPointerDownHandler,a),document.documentElement.addEventListener("pointermove",e.SceneManager.inputPointerMoveHandler,a),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.SceneManager.inputPointerWheelHandler,a),e.SceneManager.preventDefault=n,null==e.SceneManager.GamepadManager&&(e.SceneManager.GamepadManager=new e.GamepadManager,e.SceneManager.GamepadManager.onGamepadConnectedObservable.add(e.SceneManager.inputManagerGamepadConnected),e.SceneManager.GamepadManager.onGamepadDisconnectedObservable.add(e.SceneManager.inputManagerGamepadDisconnected)),e.SceneManager.virtualJoystick===!1&&(e.SceneManager.virtualJoystick=r,e.SceneManager.virtualJoystick===!0&&(null==e.SceneManager.leftJoystick&&(e.SceneManager.leftJoystick=new e.VirtualJoystick((!0)),e.SceneManager.leftJoystick.setJoystickSensibility(5*e.UserInputOptions.JoystickLeftSensibility)),i===!1&&null==e.SceneManager.rightJoystick&&(e.SceneManager.rightJoystick=new e.VirtualJoystick((!1)),e.SceneManager.rightJoystick.reverseUpDown=!0,e.SceneManager.rightJoystick.setJoystickSensibility(5*e.UserInputOptions.JoystickRightSensibility),e.SceneManager.rightJoystick.setJoystickColor(e.UserInputOptions.JoystickRightHandleColor)))),this._input=!0,document.documentElement.focus())},t.prototype.disableUserInput=function(t){void 0===t&&(t=!1),this._input&&(document.documentElement.removeEventListener("keyup",e.SceneManager.inputKeyUpHandler,t),document.documentElement.removeEventListener("keydown",e.SceneManager.inputKeyDownHandler,t),document.documentElement.removeEventListener("pointerup",e.SceneManager.inputPointerUpHandler,t),document.documentElement.removeEventListener("pointerdown",e.SceneManager.inputPointerDownHandler,t),document.documentElement.removeEventListener("pointermove",e.SceneManager.inputPointerMoveHandler,t),document.documentElement.removeEventListener("onwheel"in document?"wheel":"mousewheel",e.SceneManager.inputPointerWheelHandler,t),e.SceneManager.preventDefault=!1,this.resetUserInput(),this._input=!1)},t.prototype.getUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);
var a=0;if(this._input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:a=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal4:e.SceneManager.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal3:e.SceneManager.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal2:e.SceneManager.vertical2:t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal:e.SceneManager.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:a=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.SceneManager.mousex4:e.SceneManager.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.SceneManager.mousex3:e.SceneManager.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.SceneManager.mousex2:e.SceneManager.mousey2:t===e.UserInputAxis.MouseX?e.SceneManager.mousex:e.SceneManager.mousey;break;case e.UserInputAxis.ClientX:case e.UserInputAxis.ClientY:n===e.PlayerNumber.One&&(a=t===e.UserInputAxis.ClientX?e.SceneManager.clientx:e.SceneManager.clienty);break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(a=e.SceneManager.wheel)}return a},t.prototype.onKeyboardUp=function(t){this._input&&e.SceneManager.keyButtonUp.push(t)},t.prototype.onKeyboardDown=function(t){this._input&&e.SceneManager.keyButtonDown.push(t)},t.prototype.onKeyboardPress=function(t,n){this._input&&e.SceneManager.keyButtonPress.push({index:t,action:n})},t.prototype.getKeyboardInput=function(t){var n=!1;if(this._input){var a="k:"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.onPointerUp=function(t){this._input&&e.SceneManager.mouseButtonUp.push(t)},t.prototype.onPointerDown=function(t){this._input&&e.SceneManager.mouseButtonDown.push(t)},t.prototype.onPointerPress=function(t,n){this._input&&e.SceneManager.mouseButtonPress.push({index:t,action:n})},t.prototype.getPointerInput=function(t){var n=!1;if(this._input){var a="p:"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.getLeftJoystick=function(){return this._input?e.SceneManager.leftJoystick:null},t.prototype.getRightJoystick=function(){return this._input?e.SceneManager.rightJoystick:null},t.prototype.getJoystickPress=function(t){var n=!1;return this._input&&(t===e.JoystickButton.Left&&null!=e.SceneManager.leftJoystick&&e.SceneManager.leftJoystick.pressed===!0?n=!0:t===e.JoystickButton.Right&&null!=e.SceneManager.rightJoystick&&e.SceneManager.rightJoystick.pressed===!0&&(n=!0)),n},t.prototype.disposeVirtualJoysticks=function(){this._input&&(null!=e.SceneManager.leftJoystick&&(e.SceneManager.leftJoystick.releaseCanvas(),e.SceneManager.leftJoystick=null),null!=e.SceneManager.rightJoystick&&(e.SceneManager.rightJoystick.releaseCanvas(),e.SceneManager.rightJoystick=null),e.SceneManager.virtualJoystick=!1)},t.prototype.onGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4ButtonUp.push(t)}},t.prototype.onGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4ButtonDown.push(t)}},t.prototype.onGamepadButtonPress=function(t,n,a){if(void 0===a&&(a=e.PlayerNumber.One),this._input)switch(a){case e.PlayerNumber.One:e.SceneManager.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.SceneManager.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.SceneManager.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.SceneManager.gamepad4ButtonPress.push({index:t,action:n})}},t.prototype.getGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=!1;if(this._input){var r=null;switch(n){case e.PlayerNumber.One:r="b1:"+t.toString();break;case e.PlayerNumber.Two:r="b2:"+t.toString();break;case e.PlayerNumber.Three:r="b3:"+t.toString();break;case e.PlayerNumber.Four:r="b4:"+t.toString()}null!=r&&null!=e.SceneManager.keymap[r]&&(a=e.SceneManager.keymap[r])}return a},t.prototype.onGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4DpadUp.push(t)}},t.prototype.onGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4DpadDown.push(t)}},t.prototype.onGamepadDirectionPress=function(t,n,a){if(void 0===a&&(a=e.PlayerNumber.One),this._input)switch(a){case e.PlayerNumber.One:e.SceneManager.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.SceneManager.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.SceneManager.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.SceneManager.gamepad4DpadPress.push({index:t,action:n})}},t.prototype.getGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=!1;if(this._input){var r=null;switch(n){case e.PlayerNumber.One:r="d1:"+t.toString();break;case e.PlayerNumber.Two:r="d2:"+t.toString();break;case e.PlayerNumber.Three:r="d3:"+t.toString();break;case e.PlayerNumber.Four:r="d4:"+t.toString()}null!=r&&null!=e.SceneManager.keymap[r]&&(a=e.SceneManager.keymap[r])}return a},t.prototype.onGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4LeftTrigger.push(t)}},t.prototype.onGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4RightTrigger.push(t)}},t.prototype.getGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=0;if(this._input){var r=null;switch(n){case e.PlayerNumber.One:r="t1:"+t.toString();break;case e.PlayerNumber.Two:r="t2:"+t.toString();break;case e.PlayerNumber.Three:r="t3:"+t.toString();break;case e.PlayerNumber.Four:r="t4:"+t.toString()}null!=r&&null!=e.SceneManager.keymap[r]&&(a=e.SceneManager.keymap[r])}return a},t.prototype.getGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(this._input)switch(t){case e.PlayerNumber.One:n=e.SceneManager.gamepad1;break;case e.PlayerNumber.Two:n=e.SceneManager.gamepad2;break;case e.PlayerNumber.Three:n=e.SceneManager.gamepad3;break;case e.PlayerNumber.Four:n=e.SceneManager.gamepad4}return n},t.prototype.getGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(this._input)switch(t){case e.PlayerNumber.One:n=e.SceneManager.gamepad1Type;break;case e.PlayerNumber.Two:n=e.SceneManager.gamepad2Type;break;case e.PlayerNumber.Three:n=e.SceneManager.gamepad3Type;break;case e.PlayerNumber.Four:n=e.SceneManager.gamepad4Type}return n},t.prototype.updateCameraInput=function(t,n,a,r){if(void 0===r&&(r=e.PlayerNumber.One),null!=t){var i=this.getUserInput(e.UserInputAxis.Horizontal,r),o=this.getUserInput(e.UserInputAxis.Vertical,r),l=this.getUserInput(e.UserInputAxis.MouseX,r),s=this.getUserInput(e.UserInputAxis.MouseY,r);this.updateCameraPosition(t,i,o,n),this.updateCameraRotation(t,l,s,a)}},t.prototype.updateCameraPosition=function(t,n,a,r){if(null!=t){var i=t._computeLocalCameraSpeed()*r;e.SceneManager.TempMatrix.reset(),e.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,e.SceneManager.TempMatrix),e.SceneManager.AuxVector3.copyFromFloats(0,0,0),e.SceneManager.TempVector3.copyFromFloats(n*i,0,a*i),e.Vector3.TransformCoordinatesToRef(e.SceneManager.TempVector3,e.SceneManager.TempMatrix,e.SceneManager.AuxVector3),t.cameraDirection.addInPlace(e.SceneManager.AuxVector3)}},t.prototype.updateCameraRotation=function(t,n,a,r){null!=t&&(e.SceneManager.TempVector2.copyFromFloats(a*r,n*r),t.cameraRotation.addInPlace(e.SceneManager.TempVector2))},t.prototype.getNavigationTool=function(){return null==this._navigation&&(this._navigation=new Navigation),this._navigation},t.prototype.getNavigationZone=function(){return"scene"},t.prototype.findNavigationPath=function(e,t){if(null==this._navigation||null==this._navmesh||null==e||null==t)return null;var n=this.getNavigationZone(),a=this._navigation.getGroup(n,e);return this._navigation.findPath(e,t,n,a)},t.prototype.hasNavigationMesh=function(){return null!=this._navmesh},t.prototype.getNavigationMesh=function(){return this._navmesh},t.prototype.buildNavigationMesh=function(t){if(null!=t){console.log("Building navigation mesh..."),this._navmesh=t;var n=this.getNavigationTool(),a=n.buildNodes(this._navmesh);null!=a?n.setZoneData(this.getNavigationZone(),a):e.Tools.Warn("Babylon.js failed to set scene navigation zone")}},t.prototype.getNavigationPoint=function(t,n,a){var r=this;if(void 0===n&&(n=2),void 0===a&&(a=Number.MAX_VALUE),null==this._navmesh||null==t)return null;var i=new e.Ray(t,new e.Vector3(0,(-1),0),a),o=this._scene.pickWithRay(i,function(e){return e===r._navmesh});return o.hit&&o.pickedPoint?o.pickedPoint:null},t.prototype.moveNavigationAgent=function(t,n,a,r,i){if(n&&n.length>0){for(var o=0,l=[{frame:0,value:t.position}],s=0;s<n.length;s++)o+=e.Vector3.Distance(l[s].value,n[s]),l.push({frame:o,value:n[s]});var c=new e.Animation("Move","position",3,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_RELATIVE);c.setKeys(l),t.animations.push(c),this._scene.beginAnimation(t,0,o,r,a,i)}},t.prototype.getNavigationAgents=function(){return this._scene.getMeshesByTags("[NAVAGENT]")},t.prototype.getNavigationAgentInfo=function(t){return new e.NavigationAgent(t)},t.prototype.getNavigationAreaTable=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table?this._navmesh.metadata.properties.table:[]},t.prototype.getNavigationAreaIndexes=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.areas?this._navmesh.metadata.properties.areas:[]},t.prototype.getNavigationAreaName=function(e){var t="";if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table){var n=this._navmesh.metadata.properties.table;if(null!=n)for(var a=0;a<n.length;a++)if(n[a].index===e){t=n[a].area;break}}return t},t.prototype.getNavigationAreaCost=function(e){var t=-1;if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties){var n=this._navmesh.metadata.properties.table;if(null!=n)for(var a=0;a<n.length;a++)if(n[a].index===e){t=n[a].cost;break}}return t},t.inputKeyDownHandler=function(t){var n="k:"+t.keyCode.toString(),a=!1;switch(null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,t.keyCode){case 39:case 68:e.SceneManager.k_horizontal=1;break;case 37:case 65:e.SceneManager.k_horizontal=-1;break;case 38:case 87:e.SceneManager.k_vertical=1;break;case 40:case 83:e.SceneManager.k_vertical=-1}return null!=e.SceneManager.keyButtonDown&&e.SceneManager.keyButtonDown.length>0&&e.SceneManager.keyButtonDown.forEach(function(e){e(t.keyCode)}),a||null!=e.SceneManager.keyButtonPress&&e.SceneManager.keyButtonPress.length>0&&e.SceneManager.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){var n="k:"+t.keyCode.toString();switch(e.SceneManager.keymap[n]=!1,t.keyCode){case 39:case 37:case 68:case 65:e.SceneManager.k_horizontal=0;break;case 38:case 40:case 87:case 83:e.SceneManager.k_vertical=0}return null!=e.SceneManager.keyButtonUp&&e.SceneManager.keyButtonUp.length>0&&e.SceneManager.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.SceneManager.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){0===t.button&&(e.SceneManager.previousPosition={x:t.clientX,y:t.clientY});var n="p:"+t.button.toString(),a=!1;return null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.mouseButtonDown&&e.SceneManager.mouseButtonDown.length>0&&e.SceneManager.mouseButtonDown.forEach(function(e){e(t.button)}),a||null!=e.SceneManager.mouseButtonPress&&e.SceneManager.mouseButtonPress.length>0&&e.SceneManager.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){0===t.button&&null!=e.SceneManager.previousPosition&&(e.SceneManager.previousPosition=null,e.SceneManager.k_mousex=0,e.SceneManager.k_mousey=0);var n="p:"+t.button.toString();return e.SceneManager.keymap[n]=!1,null!=e.SceneManager.mouseButtonUp&&e.SceneManager.mouseButtonUp.length>0&&e.SceneManager.mouseButtonUp.forEach(function(e){e(t.button)}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.virtualJoystick===!1&&null!=e.SceneManager.previousPosition){e.SceneManager.clientx=t.clientX,e.SceneManager.clienty=t.clientY;var n=t.clientX-e.SceneManager.previousPosition.x,a=t.clientY-e.SceneManager.previousPosition.y;e.SceneManager.previousPosition={x:t.clientX,y:t.clientY};var r=n*(e.UserInputOptions.PointerAngularSensibility/10),i=a*(e.UserInputOptions.PointerAngularSensibility/10);0!=r&&(e.SceneManager.k_mousex=r),0!=i&&(e.SceneManager.rightHanded?e.SceneManager.k_mousey=-i:e.SceneManager.k_mousey=i)}return e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputVirtualJoysticks=function(){if(null!=e.SceneManager.leftJoystick){var t=e.SceneManager.leftJoystick.deltaPosition;e.SceneManager.leftJoystick.pressed||(t=t.scale(.9));var n=t.x,a=t.y;t.x=Math.abs(n)>e.UserInputOptions.JoystickDeadStickValue?0+n:0,t.y=Math.abs(a)>e.UserInputOptions.JoystickDeadStickValue?0+a:0,e.SceneManager.j_horizontal=t.x,e.SceneManager.j_vertical=t.y}if(null!=e.SceneManager.rightJoystick){var r=e.SceneManager.rightJoystick.deltaPosition;e.SceneManager.rightJoystick.pressed||(r=r.scale(.9));var i=r.x,o=r.y;r.x=Math.abs(i)>e.UserInputOptions.JoystickDeadStickValue?0+i:0,r.y=Math.abs(o)>e.UserInputOptions.JoystickDeadStickValue?0+o:0,e.SceneManager.j_mousex=r.x,e.SceneManager.j_mousey=r.y}},t.inputOneButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="b1:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad1ButtonDown&&e.SceneManager.gamepad1ButtonDown.length>0&&e.SceneManager.gamepad1ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad1ButtonPress&&e.SceneManager.gamepad1ButtonPress.length>0&&e.SceneManager.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="b1:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad1ButtonUp&&e.SceneManager.gamepad1ButtonUp.length>0&&e.SceneManager.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="d1:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad1DpadDown&&e.SceneManager.gamepad1DpadDown.length>0&&e.SceneManager.gamepad1DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad1DpadPress&&e.SceneManager.gamepad1DpadPress.length>0&&e.SceneManager.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="d1:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad1DpadUp&&e.SceneManager.gamepad1DpadUp.length>0&&e.SceneManager.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad1&&(e.SceneManager.keymap["t1:0"]=t,null!=e.SceneManager.gamepad1LeftTrigger&&e.SceneManager.gamepad1LeftTrigger.length>0&&e.SceneManager.gamepad1LeftTrigger.forEach(function(e){e(t)}))},t.inputOneXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad1&&(e.SceneManager.keymap["t1:1"]=t,null!=e.SceneManager.gamepad1RightTrigger&&e.SceneManager.gamepad1RightTrigger.length>0&&e.SceneManager.gamepad1RightTrigger.forEach(function(e){e(t)}))},t.inputOneLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad1){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(null!=e.SceneManager.gamepad1){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="b2:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad2ButtonDown&&e.SceneManager.gamepad2ButtonDown.length>0&&e.SceneManager.gamepad2ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad2ButtonPress&&e.SceneManager.gamepad2ButtonPress.length>0&&e.SceneManager.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="b2:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad2ButtonUp&&e.SceneManager.gamepad2ButtonUp.length>0&&e.SceneManager.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="d2:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad2DpadDown&&e.SceneManager.gamepad2DpadDown.length>0&&e.SceneManager.gamepad2DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad2DpadPress&&e.SceneManager.gamepad2DpadPress.length>0&&e.SceneManager.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="d2:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad2DpadUp&&e.SceneManager.gamepad2DpadUp.length>0&&e.SceneManager.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad2&&(e.SceneManager.keymap["t2:0"]=t,null!=e.SceneManager.gamepad2LeftTrigger&&e.SceneManager.gamepad2LeftTrigger.length>0&&e.SceneManager.gamepad2LeftTrigger.forEach(function(e){e(t)}))},t.inputTwoXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad2&&(e.SceneManager.keymap["t2:1"]=t,null!=e.SceneManager.gamepad2RightTrigger&&e.SceneManager.gamepad2RightTrigger.length>0&&e.SceneManager.gamepad2RightTrigger.forEach(function(e){e(t)}))},t.inputTwoLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad2){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(null!=e.SceneManager.gamepad2){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="b3:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad3ButtonDown&&e.SceneManager.gamepad3ButtonDown.length>0&&e.SceneManager.gamepad3ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad3ButtonPress&&e.SceneManager.gamepad3ButtonPress.length>0&&e.SceneManager.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="b3:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad3ButtonUp&&e.SceneManager.gamepad3ButtonUp.length>0&&e.SceneManager.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="d3:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad3DpadDown&&e.SceneManager.gamepad3DpadDown.length>0&&e.SceneManager.gamepad3DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad3DpadPress&&e.SceneManager.gamepad3DpadPress.length>0&&e.SceneManager.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="d3:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad3DpadUp&&e.SceneManager.gamepad3DpadUp.length>0&&e.SceneManager.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad3&&(e.SceneManager.keymap["t3:0"]=t,null!=e.SceneManager.gamepad3LeftTrigger&&e.SceneManager.gamepad3LeftTrigger.length>0&&e.SceneManager.gamepad3LeftTrigger.forEach(function(e){e(t)}))},t.inputThreeXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad3&&(e.SceneManager.keymap["t3:1"]=t,null!=e.SceneManager.gamepad3RightTrigger&&e.SceneManager.gamepad3RightTrigger.length>0&&e.SceneManager.gamepad3RightTrigger.forEach(function(e){e(t)}))},t.inputThreeLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad3){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(null!=e.SceneManager.gamepad3){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="b4:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad4ButtonDown&&e.SceneManager.gamepad4ButtonDown.length>0&&e.SceneManager.gamepad4ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad4ButtonPress&&e.SceneManager.gamepad4ButtonPress.length>0&&e.SceneManager.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="b4:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad4ButtonUp&&e.SceneManager.gamepad4ButtonUp.length>0&&e.SceneManager.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="d4:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad4DpadDown&&e.SceneManager.gamepad4DpadDown.length>0&&e.SceneManager.gamepad4DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad4DpadPress&&e.SceneManager.gamepad4DpadPress.length>0&&e.SceneManager.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="d4:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad4DpadUp&&e.SceneManager.gamepad4DpadUp.length>0&&e.SceneManager.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad4&&(e.SceneManager.keymap["t4:0"]=t,null!=e.SceneManager.gamepad4LeftTrigger&&e.SceneManager.gamepad4LeftTrigger.length>0&&e.SceneManager.gamepad4LeftTrigger.forEach(function(e){e(t)}))},t.inputFourXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad4&&(e.SceneManager.keymap["t4:1"]=t,null!=e.SceneManager.gamepad4RightTrigger&&e.SceneManager.gamepad4RightTrigger.length>0&&e.SceneManager.gamepad4RightTrigger.forEach(function(e){e(t)}))},t.inputFourLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad4){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(null!=e.SceneManager.gamepad4){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.SceneManager.gamepad1&&0===t.index)if(e.SceneManager.gamepad1=t,e.Tools.Log("Gamepad One Connected: "+e.SceneManager.gamepad1.id),e.SceneManager.gamepad1.id.search("Xbox 360")!==-1||e.SceneManager.gamepad1.id.search("Xbox One")!==-1||e.SceneManager.gamepad1.id.search("xinput")!==-1){e.SceneManager.gamepad1Type=e.GamepadType.Xbox360;var a=e.SceneManager.gamepad1;a.onbuttonup(e.SceneManager.inputOneButtonUpHandler),a.onbuttondown(e.SceneManager.inputOneButtonDownHandler),a.onleftstickchanged(e.SceneManager.inputOneLeftStickHandler),a.onrightstickchanged(e.SceneManager.inputOneRightStickHandler),a.ondpadup(e.SceneManager.inputOneXboxDPadUpHandler),a.ondpaddown(e.SceneManager.inputOneXboxDPadDownHandler),a.onlefttriggerchanged(e.SceneManager.inputOneXboxLeftTriggerHandler),a.onrighttriggerchanged(e.SceneManager.inputOneXboxRightTriggerHandler)}else{e.SceneManager.gamepad1Type=e.GamepadType.Generic;var r=e.SceneManager.gamepad1;r.onbuttonup(e.SceneManager.inputOneButtonUpHandler),r.onbuttondown(e.SceneManager.inputOneButtonDownHandler),r.onleftstickchanged(e.SceneManager.inputOneLeftStickHandler),r.onrightstickchanged(e.SceneManager.inputOneRightStickHandler)}if(null==e.SceneManager.gamepad2&&1===t.index)if(e.SceneManager.gamepad2=t,e.Tools.Log("Gamepad Two Connected: "+e.SceneManager.gamepad2.id),e.SceneManager.gamepad2.id.search("Xbox 360")!==-1||e.SceneManager.gamepad2.id.search("Xbox One")!==-1||e.SceneManager.gamepad2.id.search("xinput")!==-1){e.SceneManager.gamepad2Type=e.GamepadType.Xbox360;var i=e.SceneManager.gamepad2;i.onbuttonup(e.SceneManager.inputTwoButtonUpHandler),i.onbuttondown(e.SceneManager.inputTwoButtonDownHandler),i.onleftstickchanged(e.SceneManager.inputTwoLeftStickHandler),i.onrightstickchanged(e.SceneManager.inputTwoRightStickHandler),i.ondpadup(e.SceneManager.inputTwoXboxDPadUpHandler),i.ondpaddown(e.SceneManager.inputTwoXboxDPadDownHandler),i.onlefttriggerchanged(e.SceneManager.inputTwoXboxLeftTriggerHandler),i.onrighttriggerchanged(e.SceneManager.inputTwoXboxRightTriggerHandler)}else{e.SceneManager.gamepad2Type=e.GamepadType.Generic;var o=e.SceneManager.gamepad2;o.onbuttonup(e.SceneManager.inputTwoButtonUpHandler),o.onbuttondown(e.SceneManager.inputTwoButtonDownHandler),o.onleftstickchanged(e.SceneManager.inputTwoLeftStickHandler),o.onrightstickchanged(e.SceneManager.inputTwoRightStickHandler)}if(null==e.SceneManager.gamepad3&&2===t.index)if(e.SceneManager.gamepad3=t,e.Tools.Log("Gamepad Three Connected: "+e.SceneManager.gamepad3.id),e.SceneManager.gamepad3.id.search("Xbox 360")!==-1||e.SceneManager.gamepad3.id.search("Xbox One")!==-1||e.SceneManager.gamepad3.id.search("xinput")!==-1){e.SceneManager.gamepad3Type=e.GamepadType.Xbox360;var l=e.SceneManager.gamepad3;l.onbuttonup(e.SceneManager.inputThreeButtonUpHandler),l.onbuttondown(e.SceneManager.inputThreeButtonDownHandler),l.onleftstickchanged(e.SceneManager.inputThreeLeftStickHandler),l.onrightstickchanged(e.SceneManager.inputThreeRightStickHandler),l.ondpadup(e.SceneManager.inputThreeXboxDPadUpHandler),l.ondpaddown(e.SceneManager.inputThreeXboxDPadDownHandler),l.onlefttriggerchanged(e.SceneManager.inputThreeXboxLeftTriggerHandler),l.onrighttriggerchanged(e.SceneManager.inputThreeXboxRightTriggerHandler)}else{e.SceneManager.gamepad3Type=e.GamepadType.Generic;var s=e.SceneManager.gamepad3;s.onbuttonup(e.SceneManager.inputThreeButtonUpHandler),s.onbuttondown(e.SceneManager.inputThreeButtonDownHandler),s.onleftstickchanged(e.SceneManager.inputThreeLeftStickHandler),s.onrightstickchanged(e.SceneManager.inputThreeRightStickHandler)}if(null==e.SceneManager.gamepad4&&3===t.index)if(e.SceneManager.gamepad4=t,e.Tools.Log("Gamepad Four Connected: "+e.SceneManager.gamepad4.id),e.SceneManager.gamepad4.id.search("Xbox 360")!==-1||e.SceneManager.gamepad4.id.search("Xbox One")!==-1||e.SceneManager.gamepad4.id.search("xinput")!==-1){e.SceneManager.gamepad4Type=e.GamepadType.Xbox360;var c=e.SceneManager.gamepad4;c.onbuttonup(e.SceneManager.inputFourButtonUpHandler),c.onbuttondown(e.SceneManager.inputFourButtonDownHandler),c.onleftstickchanged(e.SceneManager.inputFourLeftStickHandler),c.onrightstickchanged(e.SceneManager.inputFourRightStickHandler),c.ondpadup(e.SceneManager.inputFourXboxDPadUpHandler),c.ondpaddown(e.SceneManager.inputFourXboxDPadDownHandler),
c.onlefttriggerchanged(e.SceneManager.inputFourXboxLeftTriggerHandler),c.onrighttriggerchanged(e.SceneManager.inputFourXboxRightTriggerHandler)}else{e.SceneManager.gamepad4Type=e.GamepadType.Generic;var u=e.SceneManager.gamepad4;u.onbuttonup(e.SceneManager.inputFourButtonUpHandler),u.onbuttondown(e.SceneManager.inputFourButtonDownHandler),u.onleftstickchanged(e.SceneManager.inputFourLeftStickHandler),u.onrightstickchanged(e.SceneManager.inputFourRightStickHandler)}null!=e.SceneManager.GamepadConnected&&e.SceneManager.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.SceneManager.GamepadDisconnected&&e.SceneManager.GamepadDisconnected(t,n)},t.inputManagerLeftControllerMainButton=function(e,t){},t.inputManagerLeftControllerPadState=function(e,t){},t.inputManagerLeftControllerPadValues=function(e,t){},t.inputManagerLeftControllerAuxButton=function(e,t){},t.inputManagerLeftControllerTriggered=function(e,t){},t.inputManagerRightControllerMainButton=function(e,t){},t.inputManagerRightControllerPadState=function(e,t){},t.inputManagerRightControllerPadValues=function(e,t){},t.inputManagerRightControllerAuxButton=function(e,t){},t.inputManagerRightControllerTriggered=function(e,t){},t.inputManagerControllerConnected=function(e,t){},t.updateUserInput=function(){e.SceneManager.inputVirtualJoysticks(),e.SceneManager.x_horizontal=0,e.SceneManager.x_vertical=0,e.SceneManager.x_mousex=0,e.SceneManager.x_mousey=0,0!==e.SceneManager.j_horizontal?e.SceneManager.x_horizontal=e.SceneManager.j_horizontal:0!==e.SceneManager.k_horizontal?e.SceneManager.x_horizontal=e.SceneManager.k_horizontal:0!==e.SceneManager.g_horizontal1&&(e.SceneManager.x_horizontal=e.SceneManager.g_horizontal1),0!==e.SceneManager.j_vertical?e.SceneManager.x_vertical=e.SceneManager.j_vertical:0!==e.SceneManager.k_vertical?e.SceneManager.x_vertical=e.SceneManager.k_vertical:0!==e.SceneManager.g_vertical1&&(e.SceneManager.x_vertical=e.SceneManager.g_vertical1),0!==e.SceneManager.j_mousex?e.SceneManager.x_mousex=e.SceneManager.j_mousex:0!==e.SceneManager.k_mousex?e.SceneManager.x_mousex=e.SceneManager.k_mousex:0!==e.SceneManager.g_mousex1&&(e.SceneManager.x_mousex=e.SceneManager.g_mousex1),0!==e.SceneManager.j_mousey?e.SceneManager.x_mousey=e.SceneManager.j_mousey:0!==e.SceneManager.k_mousey?e.SceneManager.x_mousey=e.SceneManager.k_mousey:0!==e.SceneManager.g_mousey1&&(e.SceneManager.x_mousey=e.SceneManager.g_mousey1),e.SceneManager.horizontal=e.SceneManager.x_horizontal,e.SceneManager.vertical=e.SceneManager.x_vertical,e.SceneManager.mousex=e.SceneManager.x_mousex,e.SceneManager.mousey=e.SceneManager.x_mousey,e.SceneManager.wheel=e.SceneManager.x_wheel,e.SceneManager.horizontal2=e.SceneManager.g_horizontal2,e.SceneManager.vertical2=e.SceneManager.g_vertical2,e.SceneManager.mousex2=e.SceneManager.g_mousex2,e.SceneManager.mousey2=e.SceneManager.g_mousey2,e.SceneManager.horizontal3=e.SceneManager.g_horizontal3,e.SceneManager.vertical3=e.SceneManager.g_vertical3,e.SceneManager.mousex3=e.SceneManager.g_mousex3,e.SceneManager.mousey3=e.SceneManager.g_mousey3,e.SceneManager.horizontal4=e.SceneManager.g_horizontal4,e.SceneManager.vertical4=e.SceneManager.g_vertical4,e.SceneManager.mousex4=e.SceneManager.g_mousex4,e.SceneManager.mousey4=e.SceneManager.g_mousey4,e.SceneManager.x_mousey=0},t.parseSceneCameras=function(t,n,a){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&t.metadata.parsed===!1){t.metadata.parsed=!0,t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},e.SceneManager.setupCameraRigOptions(t,n);var r=t.metadata;null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}})}})},t.parseSceneLights=function(t,n,a){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&t.metadata.parsed===!1){t.metadata.parsed=!0,t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)};var r=t.metadata;null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}})}})},t.parseSceneMeshes=function(t,n,a){null!=t&&t.length>0&&(t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&t.metadata.parsed===!1)if(t.metadata.parsed=!0,t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},e.SceneManager.setupSharedSkeleton(t,n),t.metadata.prefab===!0)t.setEnabled(!1),e.SceneManager.prefabs[t.name]=t;else{e.SceneManager.setupLodGroups(t,n,!1),"SceneNavigationMesh"===t.name&&null!=n.metadata.properties.hasNavigationMesh&&n.metadata.properties.hasNavigationMesh===!0&&(e.SceneManager.GetInstance().hasNavigationMesh()===!1?e.SceneManager.GetInstance().buildNavigationMesh(t):e.Tools.Warn("Scene navigation mesh already exists. Ignoring navigation zone building for mesh: "+t.name));var r=t.metadata;if(null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}}),e.SceneManager.setupSocketMeshes(t,n),null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties){if(t.metadata.properties.defaultEllipsoid&&null!=t.metadata.properties.defaultEllipsoid&&t.metadata.properties.defaultEllipsoid.length>=3){var i=t.metadata.properties.defaultEllipsoid;t.ellipsoid=new e.Vector3(i[0],i[1],i[2])}if(t.metadata.properties.ellipsoidOffset&&null!=t.metadata.properties.ellipsoidOffset&&t.metadata.properties.ellipsoidOffset.length>=3){var o=t.metadata.properties.ellipsoidOffset;t.ellipsoidOffset=new e.Vector3(o[0],o[1],o[2])}t.metadata.properties.hasOwnProperty("freezeWorldMatrix")&&t.metadata.properties.freezeWorldMatrix===!0&&t.freezeWorldMatrix(),t.metadata.properties.hasOwnProperty("convertToUnIndexed")&&t.metadata.properties.convertToUnIndexed===!0&&t.convertToUnIndexedMesh(),t.metadata.properties.hasOwnProperty("convertToFlatShaded")&&t.metadata.properties.convertToFlatShaded===!0&&t.convertToFlatShadedMesh(),t.metadata.properties.hasOwnProperty("pickableWithRay")&&(t.isPickable=t.metadata.properties.pickableWithRay)}var l=e.SceneManager.setupTerrainMeshes(t,n);if(l===!1&&null!=t.metadata.properties&&null!=t.metadata.properties.physicsTag){var s=(t.metadata.properties.physicsTag,t.metadata.properties.physicsMass),c=t.metadata.properties.physicsDetach,u=t.metadata.properties.physicsFriction,p=t.metadata.properties.physicsRestitution,m=t.metadata.properties.physicsImpostor,d=t.metadata.properties.physicsRotation,g=t.metadata.properties.physicsCollisions,h=t.metadata.properties.physicsCollisionGroup,y=t.metadata.properties.physicsCollisionMask,f=t.metadata.properties.physicsEnginePlugin;c===!0&&null!=t.parent&&(e.Utilities.ResetPhysicsPosition(t.position,t.parent),t.parent=null),t.physicsImpostor=new e.PhysicsImpostor(t,m,{mass:s,friction:u,restitution:p},n),e.SceneManager.setupPhysicsImpostor(t,f,u,g,d,h,y)}}}),e.SceneManager.postParseSceneMeshes(t,n))},t.postParseSceneMeshes=function(t,n){if(null!=t&&t.length>0){var a={};if(t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&e.SceneManager.staticVertexLimit===!1&&t.metadata.layerIndex===e.SceneManager.StaticIndex&&t.name.indexOf("_StaticMesh_")>=0){t.metadata.layerIndex=-99;var n=t.material.id,r=null;a.hasOwnProperty(n)?r=a[n]:(r=[],a[n]=r),r.push(t)}}),e.SceneManager.staticVertexLimit===!1)for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(null!=i&&i.length>1){var o=i[0].parent,l=e.Mesh.MergeMeshes(i,!0,!0);null!=l&&(l.parent=o)}}}},t.setupLodGroups=function(t,n,a){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.lodGroupInfo&&null!=t.metadata.properties.lodGroupInfo){var r=0,i=t.metadata.properties.lodGroupInfo,o=i.lodDetails,l=i.startCulling,s=t.getChildMeshes(!1);if(null==s?s=[t]:s.unshift(t),null!=o&&o.length>0){var c=null;o.forEach(function(n){var a=n.lodRenderers,i=n.startRange;if(null!=a&&a.length>0){var o=a[0],l=o.name,u=e.SceneManager.FindMesh(l,s,e.SearchType.IndexOf);null!=u?(null==c&&(c=u,c.setEnabled(!1)),u!=c&&(u.parent=c,c.addLODLevel(i,u))):e.Tools.Warn("Babylon.js cannot locate lod renderer: '"+l+"' for: "+t.name+" at group index: "+r.toString())}else e.Tools.Warn("Babylon.js no level of detail renderers found for: "+t.name+" at group index: "+r.toString());r++}),null!=c&&(l>0&&c.addLODLevel(l,null),c.setEnabled(!0))}t.metadata.properties.lodGroupInfo=null}},t.setupTerrainMeshes=function(t,n){var a=!1;if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.terrain===!0){a=!0;var r=0,i=(t.metadata.properties.segments?t.metadata.properties.segments:1,t.metadata.properties.colliders?t.metadata.properties.colliders:1),o=null!=t.metadata.properties.physicsTag,l=(t.metadata.properties.physicsTag?t.metadata.properties.physicsTag:"",t.metadata.properties.physicsMass?t.metadata.properties.physicsMass:0),s=!!t.metadata.properties.physicsDetach&&t.metadata.properties.physicsDetach,c=t.metadata.properties.physicsFriction?t.metadata.properties.physicsFriction:0,u=t.metadata.properties.physicsRestitution?t.metadata.properties.physicsRestitution:0,p=t.metadata.properties.physicsImpostor?t.metadata.properties.physicsImpostor:0,m=t.metadata.properties.physicsRotation?t.metadata.properties.physicsRotation:0,d=!!t.metadata.properties.physicsCollisions&&t.metadata.properties.physicsCollisions,g=t.metadata.properties.physicsCollisionGroup?t.metadata.properties.physicsCollisionGroup:0,h=t.metadata.properties.physicsCollisionMask?t.metadata.properties.physicsCollisionMask:0,y=t.metadata.properties.physicsEnginePlugin?t.metadata.properties.physicsEnginePlugin:0,f=t.metadata.properties.terrainLodGroupInfo?t.metadata.properties.terrainLodGroupInfo:null,S=!!t.metadata.properties.terrainCollision&&t.metadata.properties.terrainCollision,b=null!=f?f.lodDetails:null,M=null;if(null!=b&&b.length>0)for(r=0,r=0;r<b.length;r++){var v=b[r],V=v.startingPercent;if(V<1){var Z=v.startRange;null==M&&(M=[]),M.push(new e.SimplificationSettings(V,Z,(!0)))}}var C=t.getChildMeshes(!0);if(null!=C&&C.length>0&&C.forEach(function(t){var a=t,r=a.name.indexOf(".Collider.")>=0;r===!1&&null!=M&&a.simplify(M,!0,e.SimplificationType.QUADRATIC),a.checkCollisions=S,i>1?r===!0&&o===!0&&(a.parent=null,s===!0&&null!=a.parent&&(e.Utilities.ResetPhysicsPosition(a.position,a.parent),a.parent=null),a.physicsImpostor=new e.PhysicsImpostor(a,p,{mass:l,friction:c,restitution:u},n),e.SceneManager.setupPhysicsImpostor(a,y,c,d,m,g,h)):o===!0&&(a.parent=null,s===!0&&null!=a.parent&&(e.Utilities.ResetPhysicsPosition(a.position,a.parent),a.parent=null),a.physicsImpostor=new e.PhysicsImpostor(a,p,{mass:l,friction:c,restitution:u},n),e.SceneManager.setupPhysicsImpostor(a,y,c,d,m,g,h))}),r=0,t.metadata.properties.treeInstances&&null!=t.metadata.properties.treeInstances&&t.metadata.properties.treeInstances.length>0){var _=t.metadata.properties.treeInstances;_.forEach(function(n){r++;var a=n.prefab,i=n.heightScale,o=n.position,l=n.rotation,s=n.widthScale,c=a+"_"+r.toString(),u=t,p=new e.Vector3(o[0],o[1],o[2]),m=new e.Vector3(0,l,0),d=new e.Vector3(s,i,s);e.SceneManager.GetInstance().onready(function(){e.SceneManager.GetInstance().instantiatePrefab(a,c,p,m,d,u)})})}if(r=0,t.metadata.properties.detailPrototypes&&null!=t.metadata.properties.detailPrototypes&&t.metadata.properties.detailPrototypes.length>0){var k=t.metadata.properties.detailPrototypes;k.forEach(function(e){})}}return a},t.setupSocketMeshes=function(t,n){if(null!=t&&null!=t.metadata.socketList&&t.metadata.socketList.length>0&&null!=t.skeleton&&null!=t.skeleton.bones&&t.skeleton.bones.length>0){var a=t.metadata.socketList;a.forEach(function(a){if(t.skeleton.bones.length>=a.boneIndex+1){var r=t.skeleton.bones[a.boneIndex],i=a.boneName+".Socket.";null!=t.parent&&(i+=t.parent.name+"."),i+=t.name+"."+e.Tools.RandomId(),e.SceneManager.showDebugSockets===!0?(a.socketMesh=e.Mesh.CreateBox(i,e.SceneManager.socketColliderSize,n),a.socketMesh.visibility=e.SceneManager.colliderVisibility):a.socketMesh=new e.Mesh(i,n),a.socketMesh.position=new e.Vector3(a.positionX,a.positionY,a.positionZ),a.socketMesh.rotation=new e.Vector3(a.rotationX,a.rotationY,a.rotationZ),a.socketMesh.checkCollisions=!1,a.socketMesh.attachToBone(r,t)}})}},t.setupSharedSkeleton=function(t,n){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.sharedSkeletonId&&""!==t.metadata.properties.sharedSkeletonId){var a=t.metadata.properties.sharedSkeletonId,r=n.getMeshByID(a);null!=r&&null!=r.skeleton?(t.metadata.animationClips=null,t.skeleton=r.skeleton):e.Tools.Warn("Failed to locate source skeleton: "+a)}},t.setupPhysicsImpostor=function(t,n,a,r,i,o,l){void 0===o&&(o=1),void 0===l&&(l=1),null!=t&&null!=t.physicsImpostor&&(t.physicsImpostor.executeNativeFunction(function(s,c){c?0===n&&(c.linearDamping=a,c.angularDamping=a,c.collisionResponse=r,c.collisionFilterGroup=o,c.collisionFilterMask=l,c.angularVelocity.x=0,c.angularVelocity.y=0,c.angularVelocity.z=0,c.velocity.x=0,c.velocity.y=0,c.velocity.z=0,1===i&&(c.fixedRotation=!0,c.updateMassProperties())):e.Tools.Warn("[Physics Native Function]: Null imposter body encountered for physcis mesh "+t.name+". Check physics mesh has no parent transform.")}),e.SceneManager.showPhysicsImposter===!0&&e.SceneManager.GetInstance().showDebugImposter(t))},t.setupCameraRigOptions=function(t,n){if(null!=t&&null!=t.metadata&&null!=t.metadata.properties){t.metadata.properties.mainCamera&&null==e.SceneManager.GetInstance()._playerOneCamera&&(t.viewport=new e.Viewport(0,0,1,1),e.SceneManager.GetInstance()._playerOneCamera=t,t.metadata.properties.hasOwnProperty("stereoscopicSideBySide")&&(e.SceneManager.stereoCameras=t.metadata.properties.stereoscopicSideBySide));var a=t.metadata.properties.followTarget,r=t.metadata.properties.followRadius,i=t.metadata.properties.followHeightOffset,o=t.metadata.properties.followRotationOffset,l=t.metadata.properties.followCameraAcceleration,s=t.metadata.properties.followMaxCameraSpeed,c=t.metadata.properties.followTarget,u=t.metadata.properties.arcRotateAlpha,p=t.metadata.properties.arcRotateBeta,m=t.metadata.properties.arcRotateRadius,d=t.metadata.properties.arcRotateTarget,g=t.metadata.properties.arcRotateLowerRadiusLimit,h=t.metadata.properties.arcRotateUpperRadiusLimit,y=t.metadata.properties.arcRotateCollisionRadius,f=t.metadata.properties.arcRotateWheelDeltaPercentage,S=t.metadata.properties.webvrUniversalCamera,b=t.metadata.properties.webvrDisplayGazeIcon,M=t.metadata.properties.webvrEnableInteractions,v=t.metadata.properties.webvrEnableTeleportation,V=t.metadata.properties.webvrDeviceOrientationCamera,Z=t.metadata.properties.webvrFallbackFreeCamera,C=t.metadata.properties.webvrControllerPrefabs,_=t.metadata.properties.webvrInitialController,k=t.metadata.properties.webvrLeftControllerPrefab,I=t.metadata.properties.webvrRightControllerPrefab,N=t.metadata.properties.webvrDisplayLaserBeam,T=t.metadata.properties.webvrUseCustomButton,w=t.metadata.properties.webvrButtonElementID,W=t.metadata.properties.webvrRayCastLength,R=t.metadata.properties.webvrDefaultHeight,x=t.metadata.properties.webvrPositionScale,P=t.metadata.properties.webvrFloorMeshesTags,B=null;if(t.metadata.properties.cameraType){var G=t.metadata.properties.cameraType;if("UniversalCamera"===G){if(t.metadata.properties.mainCamera&&t.metadata.properties.localMultiPlayerViewCamera){var D=t,U=D.name,A=U+".2",F=D.clone(A);F.name=A,F.viewport=new e.Viewport(0,0,0,0),F.setEnabled(!1),e.SceneManager.GetInstance()._playerTwoCamera=F;var Y=U+".3",X=D.clone(Y);X.name=Y,X.viewport=new e.Viewport(0,0,0,0),X.setEnabled(!1),e.SceneManager.GetInstance()._playerThreeCamera=X;var L=U+".4",E=D.clone(L);E.name=L,E.viewport=new e.Viewport(0,0,0,0),E.setEnabled(!1),e.SceneManager.GetInstance()._playerFourCamera=E,D.name=U+".1",e.SceneManager.multiPlayerView=!0}}else if("FollowCamera"===G){var Q=t;if(null!=a&&""!==a){var J=n.getMeshByID(a);null!=J&&(Q.position=J.position.clone(),Q.lockedTarget=J)}Q.radius=r,Q.heightOffset=i,Q.rotationOffset=o,Q.cameraAcceleration=l,Q.maxCameraSpeed=s}else if("ArcFollowCamera"===G){var O=t;if(null!=c&&""!==c){var H=n.getMeshByID(c);null!=H&&(O.position=H.position.clone(),O.lockedTarget=H)}O.alpha=u,O.beta=p,O.radius=m}else if("ArcRotateCamera"===G){var K=t;K.alpha=u,K.beta=p,K.radius=m,K.target=e.Vector3.FromArray(d),K.lowerRadiusLimit=g,K.upperRadiusLimit=h,K.collisionRadius=e.Vector3.FromArray(y),K.wheelDeltaPercentage=f}}if(t.mode===e.Camera.ORTHOGRAPHIC_CAMERA){var j=t.metadata.properties.orthographicSize||5,z="BABYLON.OrthoController",q=null==n.metadata||null==n.metadata.properties||!n.metadata.properties.hasOwnProperty("resizeCameras")||n.metadata.properties.resizeCameras,$=t.metadata;null==$.components&&($.components=[]);var ee=e.Tools.Instantiate(z);if(null!=ee){var te={orthoSize:j,resizeCameras:q},ne=new ee(t,n,(!1),te);if(null!=ne){var ae={order:1e3,name:"EditorScriptComponent",klass:z,update:!1,properties:te,instance:ne,tag:{}};$.components.push(ae),ne.register()}}}t.metadata.properties.mainCamera&&S===!0&&e.SceneManager.GetInstance().onready(function(){var t=!1,a=null;if(T===!0&&null!=w&&""!==w){var r=document.getElementById(w);null!=r?(t=!0,a=r):e.Tools.Warn("Babylon.js failed to locate webvr button element id: "+w)}var i=null;null!=P&&""!==P||(P="Navigation"),v===!0&&(B=n.getMeshesByTags(P)),i=v===!0&&null!=B&&B.length>0?{createDeviceOrientationCamera:V,createFallbackVRDeviceOrientationFreeCamera:Z,laserToggle:N,useCustomVRButton:t,customVRButton:a,rayLength:W,defaultHeight:R,positionScale:x,floorMeshes:B}:{createDeviceOrientationCamera:V,createFallbackVRDeviceOrientationFreeCamera:Z,laserToggle:N,useCustomVRButton:t,customVRButton:a,rayLength:W,defaultHeight:R,positionScale:x},C===!0&&(e.SceneManager.me._leftControllerPrefab=e.SceneManager.me.instantiatePrefab(k,k),null!=e.SceneManager.me._leftControllerPrefab&&e.SceneManager.me._leftControllerPrefab.setEnabled(!1),e.SceneManager.me._rightControllerPrefab=e.SceneManager.me.instantiatePrefab(I,I),null!=e.SceneManager.me._rightControllerPrefab&&e.SceneManager.me._rightControllerPrefab.setEnabled(!1),null==e.SceneManager.me._leftControllerPrefab&&null!=e.SceneManager.me._rightControllerPrefab?(e.SceneManager.me._leftControllerPrefab=e.SceneManager.me.instantiatePrefab(I,k),null!=e.SceneManager.me._leftControllerPrefab&&e.SceneManager.me._leftControllerPrefab.setEnabled(!1)):null==e.SceneManager.me._rightControllerPrefab&&null!=e.SceneManager.me._leftControllerPrefab&&(e.SceneManager.me._rightControllerPrefab=e.SceneManager.me.instantiatePrefab(k,I),null!=e.SceneManager.me._rightControllerPrefab&&e.SceneManager.me._rightControllerPrefab.setEnabled(!1))),e.SceneManager.me._defaultControllers=!0;var o=n.createDefaultVRExperience(i);null!=o&&(o.displayGaze=b,M===!0&&o.enableInteractions(),o.onControllerMeshLoadedObservable.add(function(t,n){"left"===t.hand?(e.SceneManager.me._leftControllerStick=t,e.SceneManager.me._leftControllerStick.onMainButtonStateChangedObservable.add(e.SceneManager.inputManagerLeftControllerMainButton),e.SceneManager.me._leftControllerStick.onPadStateChangedObservable.add(e.SceneManager.inputManagerLeftControllerPadState),e.SceneManager.me._leftControllerStick.onPadValuesChangedObservable.add(e.SceneManager.inputManagerLeftControllerPadValues),e.SceneManager.me._leftControllerStick.onSecondaryButtonStateChangedObservable.add(e.SceneManager.inputManagerLeftControllerAuxButton),e.SceneManager.me._leftControllerStick.onTriggerStateChangedObservable.add(e.SceneManager.inputManagerLeftControllerTriggered),C===!0&&0===_&&(null!=e.SceneManager.me._leftControllerPrefab?(e.SceneManager.me._leftControllerStick.mesh.setEnabled(!1),e.SceneManager.me._leftControllerStick.attachToMesh(e.SceneManager.me._leftControllerPrefab),e.SceneManager.me._leftControllerStick.mesh.setEnabled(!0),e.SceneManager.me._defaultControllers=!1):e.Tools.Warn("Babylon.js failed to instantiate left controller prefab. Using default controller."))):"right"===t.hand&&(e.SceneManager.me._rightControllerStick=t,e.SceneManager.me._rightControllerStick.onMainButtonStateChangedObservable.add(e.SceneManager.inputManagerRightControllerMainButton),e.SceneManager.me._rightControllerStick.onPadStateChangedObservable.add(e.SceneManager.inputManagerRightControllerPadState),e.SceneManager.me._rightControllerStick.onPadValuesChangedObservable.add(e.SceneManager.inputManagerRightControllerPadValues),e.SceneManager.me._rightControllerStick.onSecondaryButtonStateChangedObservable.add(e.SceneManager.inputManagerRightControllerAuxButton),e.SceneManager.me._rightControllerStick.onTriggerStateChangedObservable.add(e.SceneManager.inputManagerRightControllerTriggered),C===!0&&0===_&&(null!=e.SceneManager.me._rightControllerPrefab?(e.SceneManager.me._rightControllerStick.mesh.setEnabled(!1),e.SceneManager.me._rightControllerStick.attachToMesh(e.SceneManager.me._rightControllerPrefab),e.SceneManager.me._rightControllerStick.mesh.setEnabled(!0),e.SceneManager.me._defaultControllers=!1):e.Tools.Warn("Babylon.js failed to instantiate left controller prefab. Using default controller.")))})),e.SceneManager.GetInstance()._vrhelper=o})}},t.LocateOwnerSocketMesh=function(t,n,a){void 0===a&&(a=e.SearchType.StartsWith);var r=null;if(null!=n&&n.metadata&&null!=n.metadata&&n.metadata.socketList&&null!=n.metadata.socketList&&n.metadata.socketList.length>0){var i=n.metadata.socketList,o=null!=a?a:e.SearchType.StartsWith,l=0;for(l=0;l<i.length;l++){var s=i[l];if(o===e.SearchType.StartsWith){if(e.Utilities.StartsWith(s.boneName,t)){r=s.socketMesh;break}}else if(o===e.SearchType.EndsWith){if(e.Utilities.EndsWith(s.boneName,t)){r=s.socketMesh;break}}else if(o===e.SearchType.IndexOf){if(s.boneName.indexOf(t)>=0){r=s.socketMesh;break}}else if(s.boneName===t){r=s.socketMesh;break}}}return r},t.LocateOwnerSocketMeshes=function(e){var t=null;if(null!=e&&e.metadata&&null!=e.metadata&&e.metadata.socketList&&null!=e.metadata.socketList&&e.metadata.socketList.length>0){t=[];var n=e.metadata.socketList;n.forEach(function(e){t.push(e.socketMesh)})}return t},t.LocateOwnerAnimationTrack=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=null);var i=null;if(null!=n&&n instanceof e.AbstractMesh){var o=n;if(null!=o.skeleton&&null!=o.skeleton.bones&&o.skeleton.bones.length>0&&o.skeleton.bones[0]){var l=o.skeleton.bones[0];null!=l.animations&&l.animations.length>t&&null!=l.animations[t]&&(i=l.animations[t])}}if(null==i&&null!=n.animations&&n.animations.length>t&&null!=n.animations[t]&&(i=n.animations[t]),null==i&&n instanceof e.AbstractMesh){var s=n.getChildMeshes(a,r);if(null!=s&&s.length>0)for(var c=0;c<s.length;c++){var u=s[c];if(null!=u.skeleton&&null!=u.skeleton.bones&&u.skeleton.bones.length>0&&u.skeleton.bones[0]){var p=u.skeleton.bones[0];if(null!=p.animations&&p.animations.length>t&&null!=p.animations[t]){i=p.animations[t];break}}if(null==i&&null!=u.animations&&u.animations.length>0&&u.animations.length>t&&null!=u.animations[t]){i=u.animations[t];break}}}return i},t.DestroyComponents=function(t,n){if(void 0===n&&(n=!0),null!=t&&null!=t.metadata&&t.metadata.api){var a=t.metadata;null!=a.components&&a.components.length>0&&a.components.forEach(function(t){null!=t.instance&&(e.SceneComponent.DestroyInstance(t.instance),t.instance=null)}),null!=a.socketList&&a.socketList.length>0&&a.socketList.forEach(function(e){null!=e.socketMesh&&(e.socketMesh.dispose(),e.socketMesh=null)}),n&&(null!=t.metadata.components&&(t.metadata.components=null),null!=t.metadata.properties&&(t.metadata.properties=null),null!=t.metadata.socketList&&(t.metadata.socketList=null),null!=t.metadata.animationClips&&(t.metadata.animationClips=null),null!=t.metadata.animationEvents&&(t.metadata.animationEvents=null),null!=t.metadata.collisionEvent&&(t.metadata.collisionEvent=null),t.metadata=null)}},t.DisposeOwner=function(t){t.name;if(t instanceof e.AbstractMesh){var n=t;null!=n.physicsImpostor&&(n.physicsImpostor.dispose(),n.physicsImpostor=null)}t.dispose()},t.SetAnimationLooping=function(e,t){if(null!=e&&null!=e.animations&&e.animations.length>0)for(var n=e.animations,a=0;a<n.length;a++)n[a].loopMode=t},t.SetSkeletonLooping=function(t,n){null!=t&&(null==t.animationPropertiesOverride&&(t.animationPropertiesOverride=new e.AnimationPropertiesOverride),t.animationPropertiesOverride.loopMode=n)},t.SetSkeletonBlending=function(t,n){null!=t&&(null==t.animationPropertiesOverride&&(t.animationPropertiesOverride=new e.AnimationPropertiesOverride),t.animationPropertiesOverride.enableBlending=n>0,t.animationPropertiesOverride.blendingSpeed=n)},t.SetSkeletonProperties=function(t,n,a){null!=t&&(null==t.animationPropertiesOverride&&(t.animationPropertiesOverride=new e.AnimationPropertiesOverride),t.animationPropertiesOverride.loopMode=n,t.animationPropertiesOverride.enableBlending=a>0,t.animationPropertiesOverride.blendingSpeed=a)},t.FindMesh=function(t,n,a){void 0===a&&(a=e.SearchType.StartsWith);var r=null,i=null!=a?a:e.SearchType.StartsWith;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var l=n[o];if(i===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.name,t)){r=l;break}}else if(i===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.name,t)){r=l;break}}else if(i===e.SearchType.IndexOf){if(l.name.indexOf(t)>=0){r=l;break}}else if(l.name===t){r=l;break}}return r},t.CloneValue=function(t,n){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(n):t.clone?t.clone():t:null},t.CloneMetadata=function(t){var n=null;if(null!=t){var a={};e.SceneManager.DeepCopyProperties(t.properties,a);var r={};e.SceneManager.DeepCopyProperties(t.navAgent,r);var i={};e.SceneManager.DeepCopyProperties(t.meshLink,i);var o={};e.SceneManager.DeepCopyProperties(t.meshObstacle,o);var l=[];null!=t.socketList&&t.socketList.length>0&&t.socketList.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),l.push(n)});var s=[];null!=t.animationClips&&t.animationClips.length>0&&t.animationClips.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),s.push(n)});var c=[];null!=t.animationEvents&&t.animationEvents.length>0&&t.animationEvents.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),c.push(n)});var u=[];null!=t.components&&t.components.length>0&&t.components.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t.properties,n),u.push({name:t.name,klass:t.klass,order:t.order,tag:t.tag,update:t.update,properties:n,instance:null})}),n={api:!0,type:t.type,parsed:!1,prefab:!1,state:{},objectName:t.objectName,objectId:e.Tools.RandomId(),tagName:t.tagName,layerIndex:t.prefab===!1?t.layerIndex:0,layerName:t.prefab===!1?t.layerName:"Default",areaIndex:t.areaIndex,shadowCastingMode:t.shadowCastingMode,navAgent:r,meshLink:i,meshObstacle:o,socketList:l,animationClips:s,animationEvents:s,collisionEvent:null,components:u,properties:a}}return n},t.DeepCopyProperties=function(t,n,a,r){for(var i in t)if(("_"!==i[0]||r&&r.indexOf(i)!==-1)&&(!a||a.indexOf(i)===-1)){var o=t[i],l=typeof o;if("function"!==l)if("object"===l)if(o instanceof Array){if(n[i]=[],o.length>0)if("object"==typeof o[0])for(var s=0;s<o.length;s++){var c=e.SceneManager.CloneValue(o[s],n);n[i].indexOf(c)===-1&&n[i].push(c)}else n[i]=o.slice(0)}else n[i]=e.SceneManager.CloneValue(o,n);else n[i]=o}},t.SetWindowsLaunchMode=function(t){e.SceneManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=Windows.UI.ViewManagement.ApplicationViewWindowingMode.fullScreen)},t.QuitWindowsApplication=function(){e.SceneManager.IsWindows()&&window.close()},t.IsWebAssemblyPluginEnabled=function(){return!!window.isWebAssemblyPluginEnabled&&window.isWebAssemblyPluginEnabled()},t.LoadWebAssemblyModule=function(e,t){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,t)}).then(function(e){return e.instance})},t.IsXboxLivePluginEnabled=function(){return!!window.isXboxLivePluginEnabled&&window.isXboxLivePluginEnabled()},t.IsXboxLiveUserSignedIn=function(t,n){if(void 0===t&&(t=null),void 0===n&&(n=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()){var a=null!=t?e.SceneManager.GetXboxLiveSystemUser(t,n):e.SceneManager.GetXboxLiveUser(n);return null!=a&&1==a.isSignedIn}return!1},t.XboxLiveUserSignIn=function(t,n,a,r){void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()&&e.SceneManager.XboxLiveUserSilentSignIn(t,function(i){i.status===Microsoft.Xbox.Services.System.SignInStatus.userInteractionRequired?e.SceneManager.XboxLiveUserDialogSignIn(t,function(e){n&&n(e)},a,r):n&&n(i)},a,r)},t.XboxLiveUserSilentSignIn=function(t,n,a,r){return void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()?e.SceneManager.GetXboxLiveUser(t).signInSilentlyAsync(null).then(n,a,r):null},t.XboxLiveUserDialogSignIn=function(t,n,a,r){return void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()?e.SceneManager.GetXboxLiveUser(t).signInAsync(null).then(n,a,r):null},t.LoadXboxLiveUserProfile=function(t,n,a,r){return void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()?e.SceneManager.GetXboxLiveUserContext(t).profileService.getUserProfileAsync(e.SceneManager.GetXboxLiveUser(t).xboxUserId).then(n,a,r):null},t.GetXboxLiveUser=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.SceneManager.IsXboxLivePluginEnabled())switch(t){case e.PlayerNumber.One:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserOne();break;case e.PlayerNumber.Two:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserTwo();break;case e.PlayerNumber.Three:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserThree();break;case e.PlayerNumber.Four:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserFour()}return n},t.GetXboxLiveSystemUser=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=null;if(e.SceneManager.IsXboxLivePluginEnabled())switch(n){case e.PlayerNumber.One:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserOne(t);break;case e.PlayerNumber.Two:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserTwo(t);break;case e.PlayerNumber.Three:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserThree(t);break;case e.PlayerNumber.Four:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserFour(t)}return a},t.GetXboxLiveUserContext=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.SceneManager.IsXboxLivePluginEnabled())switch(t){case e.PlayerNumber.One:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextOne();break;case e.PlayerNumber.Two:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextTwo();break;case e.PlayerNumber.Three:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextThree();break;case e.PlayerNumber.Four:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextFour()}return n},t.ResetXboxLiveUserContext=function(t){if(void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()&&e.SceneManager.IsXboxLivePluginEnabled())switch(t){case e.PlayerNumber.One:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextOne();break;case e.PlayerNumber.Two:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextTwo();break;case e.PlayerNumber.Three:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextThree();break;case e.PlayerNumber.Four:
window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextFour()}},t.GetXboxLiveContextProperty=function(t){return e.SceneManager.IsXboxLivePluginEnabled()?window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextProperty(t):null},t.SetXboxLiveContextProperty=function(t,n){e.SceneManager.IsXboxLivePluginEnabled()&&window.BabylonToolkit.XboxLive.Plugin.setXboxLiveContextProperty(t,n)},t.ResetXboxLivePropertyContexts=function(){e.SceneManager.IsXboxLivePluginEnabled()&&window.BabylonToolkit.XboxLive.Plugin.resetXboxLivePropertyContexts()},t.SetXboxLiveSignOutHandler=function(t){void 0===t&&(t=null),e.SceneManager.IsXboxLivePluginEnabled()&&(window.BabylonToolkit.XboxLive.Plugin.onusersignout=t)},t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.TempMatrix=e.Matrix.Zero(),t.TempVector2=e.Vector2.Zero(),t.TempVector3=e.Vector3.Zero(),t.AuxMatrix=e.Matrix.Zero(),t.AuxVector2=e.Vector2.Zero(),t.AuxVector3=e.Vector3.Zero(),t.me=null,t.min=Number.MIN_VALUE,t.max=Number.MAX_VALUE-100,t.keymap={},t.prefabs=null,t.wheel=0,t.clientx=0,t.clienty=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.engine=null,t.orphans=null,t.multiPlayerView=!1,t.multiPlayerCount=1,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.leftJoystick=null,t.rightJoystick=null,t.virtualJoystick=!1,t.showRenderStats=!1,t.sceneRenderStats=0,t.renderStatsInstance=null,t.showPhysicsImposter=!1,t.showDebugSockets=!1,t.colliderVisibility=.25,t.socketColliderSize=.125,t.staticVertexLimit=!1,t.debugLayerVisible=!1,t.previousPosition=null,t.preventDefault=!1,t.stereoCameras=!0,t.rightHanded=!0,t.pointerLocked=!1,t.enableLocking=!1,t.physicsViewer=null,t.gamepad1=null,t.gamepad1Type=e.GamepadType.None,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=e.GamepadType.None,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=e.GamepadType.None,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=e.GamepadType.None,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t.loader=null,t.readies=[],t}();e.SceneManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){if(null==e)throw new Error("Null owner agent mesh specified.");this._mesh=e,this._info=null!=this._mesh.metadata&&null!=this._mesh.metadata.navAgent?this._mesh.metadata.navAgent:null}return Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAgentInfo",{get:function(){return null!=this.info},enumerable:!0,configurable:!0}),t.prototype.setDestination=function(t){this.hasAgentInfo||e.Tools.Warn("Null navigation agent metadata. Set agent destination ignored.")},t}();e.NavigationAgent=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._time=0,i._auto=!1,i._mode=0,i._size=4096,i._shape=0,i._shuriken=null,i._time=0,i._auto=!1,i._shuriken=null,i.initializeParticleSystem(),i}return __extends(n,t),Object.defineProperty(n.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shape",{get:function(){return this._shape},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shuriken",{get:function(){return this._shuriken},enumerable:!0,configurable:!0}),n.prototype.start=function(){this._auto===!0&&null!=this._shuriken&&this._shuriken.start()},n.prototype.destroy=function(){null!=this._shuriken&&(this._shuriken.dispose(),this._shuriken=null)},n.prototype.initializeParticleSystem=function(){this._mode=this.getProperty("systemMode",0),this._size=this.getProperty("randomSize",4096),this._auto=this.getProperty("autoStart",!1),this._shape=this.getProperty("preset",0);var t=this.getProperty("capacity",100),n=this.getProperty("particleName",null),a=this.getProperty("startSpeed",.01),r=this.getProperty("angle",1),i=this.getProperty("radius",1),o=this.getProperty("activeCount",1e5),l=this.getProperty("emitType",0),s=this.getProperty("duration",10),c=this.getProperty("randomizer",0);null!=n&&""!==n||(n=this.entity.name+".Particle."+e.Tools.RandomId());var u=this.getProperty("emitBurst",null),p=this.getProperty("textureMask"),m=this.getProperty("angularSpeed"),d=e.Utilities.ParseColor4(p,new e.Color4(1,1,1,1)),g=e.Utilities.ParseVector2(m,new e.Vector2(0,0));1===this._mode?(e.GPUParticleSystem.IsSupported&&(this._shuriken=new e.GPUShurikenParticleSystem(n,t,this.scene,this._size,s,a),this._shuriken.activeParticleCount=o),null==this._shuriken&&(this._mode=0,this._shuriken=new e.ShurikenParticleSystem(n,t,this.scene,s,l,a,u),this._shuriken.textureMask=d,this._shuriken.minAngularSpeed=g.x,this._shuriken.maxAngularSpeed=g.y,e.Tools.Warn("Babylon.js using cpu particle system fallback for owner: "+this.entity.name))):(this._shuriken=new e.ShurikenParticleSystem(n,t,this.scene,s,l,a,u),this._shuriken.textureMask=d,this._shuriken.minAngularSpeed=g.x,this._shuriken.maxAngularSpeed=g.y),this._shuriken.emitter=this.mesh,this._shuriken.blendMode=this.getProperty("blendMode",0),this._shuriken.emitRate=this.getProperty("emitRate",100),this._shuriken.loopPlay=this.getProperty("loopPlay",!1),this._shuriken.delayTime=this.getProperty("delayTime",0);var h=this.getProperty("lifeTime"),y=e.Utilities.ParseVector2(h,new e.Vector2(1,1));this._shuriken.minLifeTime=y.x,this._shuriken.maxLifeTime=y.y;var f=this.getProperty("emitPower"),S=e.Utilities.ParseVector2(f,new e.Vector2(1,1));this._shuriken.minEmitPower=S.x,this._shuriken.maxEmitPower=S.y;var b=this.getProperty("particleSize"),M=e.Utilities.ParseVector2(b,new e.Vector2(1,1));this._shuriken.minSize=M.x,this._shuriken.maxSize=M.y;var v=this.getProperty("color1");this._shuriken.color1=e.Utilities.ParseColor4(v,new e.Color4(1,1,1,1));var V=this.getProperty("color2");this._shuriken.color2=e.Utilities.ParseColor4(V,new e.Color4(1,1,1,1));var Z=this.getProperty("colorDead");this._shuriken.colorDead=e.Utilities.ParseColor4(Z,new e.Color4(0,0,0,1));var C=this.getProperty("direction1"),_=e.Utilities.ParseVector3(C,new e.Vector3(0,1,0)),k=this.getProperty("direction2"),I=e.Utilities.ParseVector3(k,new e.Vector3(0,1,0)),N=this.getProperty("minEmitBox"),T=e.Utilities.ParseVector3(N,new e.Vector3(0,0,0)),w=this.getProperty("maxEmitBox"),W=e.Utilities.ParseVector3(w,new e.Vector3(0,0,0));switch(this._shape){case 0:var R=new e.BoxParticleEmitter;R.direction1=_,R.direction2=I,R.minEmitBox=T,R.maxEmitBox=W,this._shuriken.particleEmitterType=R;break;case 1:this._shuriken.particleEmitterType=new e.ConeParticleEmitter(i,r,c);break;case 2:this._shuriken.particleEmitterType=new e.SphereParticleEmitter(i,c);break;case 3:this._shuriken.particleEmitterType=new e.SphereDirectedParticleEmitter(i,_,I)}var x=this.getProperty("gravityVector"),P=this.getProperty("gravityMode",0),B=this.getProperty("gravityMultiplier",0);1===P?this._shuriken.gravity=this.scene.gravity.scale(B):this._shuriken.gravity=e.Utilities.ParseVector3(x,new e.Vector3(0,0,0));var G=this.getProperty("textureImage",null),D=this.manager.getScenePath();null!=G&&G.name&&""!==G.name&&(this._shuriken.particleTexture=new e.Texture(D+G.name,this.scene))},n}(e.MeshComponent);e.UniversalParticleSystem=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;return o.movementType=e.MovementType.DirectVelocity,o.avatarControl=0,o.avatarHeight=2,o.avatarRadius=.25,o.fallingVelocity=.1,o.slidingVelocity=.25,o.synchronizeVelocity=!0,o.onPhysicsContact=null,o._jumping=!1,o._falling=!1,o._sliding=!1,o._grounded=!0,o._threashold=.5,o._velocity=e.Vector3.Zero(),o._angularVelocity=e.Vector3.Zero(),o._jumpingVelocity=e.Vector3.Zero(),o.movementType=o.getProperty("movementType",e.MovementType.DirectVelocity),o.avatarControl=o.getProperty("avatarControl",0),o.avatarHeight=o.getProperty("avatarHeight",2),o.avatarRadius=o.getProperty("avatarRadius",.25),o.fallingVelocity=o.getProperty("fallingVelocity",.1),o.slidingVelocity=o.getProperty("slidingVelocity",.25),o}return __extends(n,t),n.prototype.isJumping=function(){return this._jumping},n.prototype.isFalling=function(){return this._falling},n.prototype.isSliding=function(){return this._sliding},n.prototype.isGrounded=function(){return this._grounded},n.prototype.getVelocity=function(){return this._velocity},n.prototype.getFriction=function(){return this.manager.getFrictionLevel(this.mesh)},n.prototype.setFriction=function(e){this.manager.applyFriction(this.mesh,e)},n.prototype.start=function(){var t=this;this._jumping=!1,this._falling=!1,this._sliding=!1,this._grounded=!0,this.updateGroundingState(),this.onCollisionEvent=function(n,a){t.manager.checkCollisionContact(t.mesh,n,e.CollisionContact.Bottom,t._threashold)===!0&&(t._jumping=!1,t.updateGroundingState()),null!=t.onPhysicsContact&&t.onPhysicsContact(n,a)}},n.prototype.update=function(){this.updateGroundingState()},n.prototype.after=function(){this.updateGroundingState()},n.prototype.updateGroundingState=function(){this._grounded=this._jumping===!1,this._velocity=this.movementType===e.MovementType.CheckCollision?e.Vector3.Zero():this.manager.getLinearVelocity(this.mesh),this._falling=null!=this._velocity&&this._velocity.y<-this.fallingVelocity,this._sliding=this._grounded===!0&&null!=this._velocity&&this._velocity.y<-this.slidingVelocity},n.prototype.move=function(t,n,a){void 0===n&&(n=-1),void 0===a&&(a=-1),this.movementType===e.MovementType.CheckCollision||(n>=0&&this.manager.applyFriction(this.mesh,n),this.synchronizeVelocity&&(t.y=this._velocity.y),this.movementType===e.MovementType.AppliedForces?this.manager.applyForce(this.mesh,t,this.mesh.getAbsolutePosition()):this.manager.setLinearVelocity(this.mesh,t),a>0&&(this._jumping=!0,this._jumpingVelocity.copyFromFloats(0,a,0),this.manager.applyImpulse(this.mesh,this._jumpingVelocity,this.mesh.getAbsolutePosition()),this.updateGroundingState()))},n.prototype.turn=function(t,n){void 0===n&&(n=-1),this.movementType===e.MovementType.CheckCollision||(n>=0&&this.manager.applyFriction(this.mesh,n),this._angularVelocity.copyFromFloats(0,t,0),this.manager.setAngularVelocity(this.mesh,this._angularVelocity))},n}(e.MeshComponent);e.CharacterController=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){this.loadingUIText=e,this.borderPrefix="4px solid",this.panelElement=null,this.loaderElement=null,this.statusElement=null,this.projectElement=null,this._statusColor="#0000ff"}return Object.defineProperty(e.prototype,"statusColor",{get:function(){return this._statusColor},set:function(e){this._statusColor=e,null!=this.loaderElement&&(this.loaderElement.style.borderTop=this.borderPrefix+" "+this._statusColor)},enumerable:!0,configurable:!0}),e.prototype.displayLoadingUI=function(){null!=this.panelElement&&(this.panelElement.className=""),null!=this.loaderElement&&(this.loaderElement.className=""),null!=this.statusElement&&(this.statusElement.className=""),null!=this.projectElement&&(this.projectElement.className=""),this.updateLoadingUI()},e.prototype.updateLoadingUI=function(){null!=this.statusElement&&this.statusElement.innerHTML!==this.loadingUIText&&(this.statusElement.innerHTML=this.loadingUIText)},e.prototype.hideLoadingUI=function(){null!=this.panelElement&&(this.panelElement.className="hidden"),null!=this.loaderElement&&(this.loaderElement.className="hidden"),null!=this.statusElement&&(this.statusElement.className="hidden"),null!=this.projectElement&&(this.projectElement.className="hidden")},e}();e.ToolkitProgress=t}(BABYLON||(BABYLON={}));var TimerPlugin=window;TimerPlugin.requestAnimFrame=function(){return TimerPlugin.requestAnimationFrame||TimerPlugin.webkitRequestAnimationFrame||TimerPlugin.mozRequestAnimationFrame||TimerPlugin.oRequestAnimationFrame||TimerPlugin.msRequestAnimationFrame||function(e,t){TimerPlugin.setTimeout(e,1e3/60)}}(),TimerPlugin.requestInterval=function(e,t){function n(){var i=TimerPlugin.getTimeMilliseconds(),o=i-a;o>=t&&(e.call(),a=TimerPlugin.getTimeMilliseconds()),r.value=TimerPlugin.requestAnimFrame(n)}if(!(TimerPlugin.requestAnimationFrame||TimerPlugin.webkitRequestAnimationFrame||TimerPlugin.mozRequestAnimationFrame&&TimerPlugin.mozCancelRequestAnimationFrame||TimerPlugin.oRequestAnimationFrame||TimerPlugin.msRequestAnimationFrame))return TimerPlugin.setInterval(e,t);var a=TimerPlugin.getTimeMilliseconds(),r=new Object;return r.value=TimerPlugin.requestAnimFrame(n),r},TimerPlugin.clearRequestInterval=function(e){TimerPlugin.cancelAnimationFrame?TimerPlugin.cancelAnimationFrame(e.value):TimerPlugin.webkitCancelAnimationFrame?TimerPlugin.webkitCancelAnimationFrame(e.value):TimerPlugin.webkitCancelRequestAnimationFrame?TimerPlugin.webkitCancelRequestAnimationFrame(e.value):TimerPlugin.mozCancelRequestAnimationFrame?TimerPlugin.mozCancelRequestAnimationFrame(e.value):TimerPlugin.oCancelRequestAnimationFrame?TimerPlugin.oCancelRequestAnimationFrame(e.value):TimerPlugin.msCancelRequestAnimationFrame?TimerPlugin.msCancelRequestAnimationFrame(e.value):clearInterval(e),e=null},TimerPlugin.requestTimeout=function(e,t){function n(){var i=TimerPlugin.getTimeMilliseconds(),o=i-a;o>=t?e.call():r.value=TimerPlugin.requestAnimFrame(n)}if(!(TimerPlugin.requestAnimationFrame||TimerPlugin.webkitRequestAnimationFrame||TimerPlugin.mozRequestAnimationFrame&&TimerPlugin.mozCancelRequestAnimationFrame||TimerPlugin.oRequestAnimationFrame||TimerPlugin.msRequestAnimationFrame))return TimerPlugin.setTimeout(e,t);var a=TimerPlugin.getTimeMilliseconds(),r=new Object;return r.value=TimerPlugin.requestAnimFrame(n),r},TimerPlugin.clearRequestTimeout=function(e){TimerPlugin.cancelAnimationFrame?TimerPlugin.cancelAnimationFrame(e.value):TimerPlugin.webkitCancelAnimationFrame?TimerPlugin.webkitCancelAnimationFrame(e.value):TimerPlugin.webkitCancelRequestAnimationFrame?TimerPlugin.webkitCancelRequestAnimationFrame(e.value):TimerPlugin.mozCancelRequestAnimationFrame?TimerPlugin.mozCancelRequestAnimationFrame(e.value):TimerPlugin.oCancelRequestAnimationFrame?TimerPlugin.oCancelRequestAnimationFrame(e.value):TimerPlugin.msCancelRequestAnimationFrame?TimerPlugin.msCancelRequestAnimationFrame(e.value):clearTimeout(e),e=null},TimerPlugin.getTimeMilliseconds=function(){return BABYLON.Tools.Now},BABYLON.SceneManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),window.addEventListener("load",function(){window.ontoolkitload&&window.ontoolkitload(),document.addEventListener("deviceready",function(){navigator.splashscreen&&navigator.splashscreen.hide(),window.ontoolkitdevice&&window.ontoolkitdevice()},!1)},!1);var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.resetDefines=function(){return this._defines={}},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e}();e.UniversalShaderDefines=t;var n=function(t){function n(e,n,a){void 0===a&&(a=!1);var r=t.call(this,e,n)||this;return r.ticking=!1,r._manager=null,r._started=!1,r._register=null,r._before=null,r._after=null,r._destroy=null,r.ticking=a,r.ticking&&r.initializeInstance(),r}return __extends(n,t),n.prototype.start=function(){},n.prototype.update=function(){},n.prototype.after=function(){},n.prototype.destroy=function(){},n.prototype.getManager=function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},n.prototype.initializeInstance=function(){this._started=!1;var e=this;e._register=function(){e.registerInstance(e)},e._before=function(){e.updateInstance(e)},e._after=function(){e.afterInstance(e)},e._destroy=function(){e.destoryInstance(e)},e._register()},n.prototype.registerInstance=function(e){e.getScene().registerBeforeRender(e._before),e.getScene().registerAfterRender(e._after)},n.prototype.updateInstance=function(e){e._started?e.update():(e.start(),e._started=!0)},n.prototype.afterInstance=function(e){e._started&&e.after()},n.prototype.destoryInstance=function(e){e.getScene().unregisterBeforeRender(e._before),e.getScene().unregisterAfterRender(e._after),e.destroy(),e._started=!1,e._register=null,e._before=null,e._after=null,e._destroy=null},n.prototype.dispose=function(e,n){this._destroy(),t.prototype.dispose.call(this,e,n)},n}(e.PushMaterial);e.UniversalPushMaterial=n;var a=function(t){function n(n,a,r){void 0===r&&(r=!1);var i=t.call(this,n,a)||this;return i.tick=!0,i.ticking=!1,i.program="default",i._locals=null,i._uniforms=[],i._samplers=[],i._textures={},i._textureArrays={},i._floats={},i._floatsArrays={},i._colors3={},i._colors4={},i._vectors2={},i._vectors3={},i._vectors4={},i._matrices={},i._matrices3x3={},i._matrices2x2={},i._vectors3Arrays={},i._manager=null,i._started=!1,i._register=null,i._before=null,i._after=null,i._destroy=null,i._locals=new e.UniversalShaderDefines,i.customShaderNameResolve=i._buildCustomShader,i.ticking=r,i.ticking&&i.initializeInstance(),i}return __extends(n,t),n.prototype.start=function(){},n.prototype.update=function(){},n.prototype.define=function(e){},n.prototype.after=function(){},n.prototype.destroy=function(){},Object.defineProperty(n.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),n.prototype.setTexture=function(e,t){return this._checkSampler(e),this._textures[e]=t,this},n.prototype.setTextureArray=function(e,t){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},n.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},n.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},n.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},n.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},n.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},n.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},n.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},n.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},n.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},n.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},n.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},n.prototype.isReadyForSubMesh=function(e,n,a){this._locals.resetDefines(),this.define(this._locals);var r=!1,i=this.getScene();if(i.texturesEnabled){var o,l=!0;for(o in this._textures){var s=this._textures[o];s&&s.isReadyOrNotBlocking()?(r=!0,this._locals.defineBoolean(o+"Def"),this._checkUniform(o+"Infos"),this._checkUniform(o+"Scale"),this._checkUniform(o+"Matrix")):l=!1}if(!l)return!1;l=!0;for(o in this._textureArrays){this._locals.defineBoolean(o+"Def");for(var c=this._textureArrays[o],u=0;u<c.length;u++){var p=c[u];p&&p.isReadyOrNotBlocking()?r=!0:l=!1}}if(!l)return!1}return t.prototype.isReadyForSubMesh.call(this,e,n,a)},n.prototype.getAnimatables=function(){var e,n=t.prototype.getAnimatables.call(this);for(e in this._textures){var a=this._textures[e];a&&n.push(a)}for(e in this._textureArrays)for(var r=this._textureArrays[e],i=0;i<r.length;i++){var a=r[i];a&&n.push(a)}return n},n.prototype.getActiveTextures=function(){var e,n=t.prototype.getActiveTextures.call(this);for(e in this._textures){var a=this._textures[e];a&&n.push(a)}for(e in this._textureArrays)for(var r=this._textureArrays[e],i=0;i<r.length;i++){var a=r[i];a&&n.push(a)}return n},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n,a=!1;for(n in this._textures){var r=this._textures[n];if(r&&r===e){a=!0;break}}if(a===!1)for(n in this._textureArrays){for(var i=this._textureArrays[n],o=0;o<i.length;o++){var l=i[o];if(l&&l===e){a=!0;break}}if(a===!0)break}return a},n.prototype.clone=function(t){var n=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalShaderMaterial(t,n.getScene())},this);return e.UniversalShaderMaterial.CloneCustomProperties(this,a),a},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalShaderMaterial",e.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},n.Parse=function(t,n,a){var r=e.SerializationHelper.Parse(function(){return new e.UniversalShaderMaterial(t.name,n)},t,n,a);return e.UniversalShaderMaterial.ParseCustomProperties(r,t,n,a),r},n.CloneCustomProperties=function(e,t){if(null!=e&&null!=t){var n;t._textures={};for(n in e._textures){var a=e._textures[n];a&&t.setTexture(n,a.clone())}t._textureArrays={};for(n in e._textureArrays){t._textureArrays[n]=[];for(var r=e._textureArrays[n],i=new Array,o=0;o<r.length;o++)i.push(r[o].clone());t.setTextureArray(n,i)}t._floats={};for(n in e._floats)t.setFloat(n,e._floats[n]);t._floatsArrays={};for(n in e._floatsArrays)t.setFloats(n,e._floatsArrays[n]);t._colors3={};for(n in e._colors3)t.setColor3(n,e._colors3[n].clone());t._colors4={};for(n in e._colors4)t.setColor4(n,e._colors4[n].clone());t._vectors2={};for(n in e._vectors2)t.setVector2(n,e._vectors2[n].clone());t._vectors3={};for(n in e._vectors3)t.setVector3(n,e._vectors3[n].clone());t._vectors4={};for(n in e._vectors4)t.setVector4(n,e._vectors4[n].clone());t._matrices={};for(n in e._matrices)t.setMatrix(n,e._matrices[n].clone());t._matrices3x3={};for(n in e._matrices3x3)t.setMatrix3x3(n,e._matrices3x3[n]);t._matrices2x2={};for(n in e._matrices2x2)t.setMatrix2x2(n,e._matrices2x2[n]);t._vectors3Arrays={};for(n in e._vectors3Arrays)t.setArray3(n,e._vectors3Arrays[n])}},n.SerializeCustomProperties=function(e,t){if(null!=t&&null!=e){var n;t.textures={};for(n in e._textures){var a=e._textures[n];a&&(t.textures[n]=a.serialize())}t.textureArrays={};for(n in e._textureArrays){t.textureArrays[n]=[];for(var r=e._textureArrays[n],i=0;i<r.length;i++)t.textureArrays[n].push(r[i].serialize())}t.floats={};for(n in e._floats)t.floats[n]=e._floats[n];t.floatsArrays={};for(n in e._floatsArrays)t.floatsArrays[n]=e._floatsArrays[n];t.colors3={};for(n in e._colors3)t.colors3[n]=e._colors3[n].asArray();t.colors4={};for(n in e._colors4)t.colors4[n]=e._colors4[n].asArray();t.vectors2={};for(n in e._vectors2)t.vectors2[n]=e._vectors2[n].asArray();t.vectors3={};for(n in e._vectors3)t.vectors3[n]=e._vectors3[n].asArray();t.vectors4={};for(n in e._vectors4)t.vectors4[n]=e._vectors4[n].asArray();t.matrices={};for(n in e._matrices)t.matrices[n]=e._matrices[n].asArray();t.matrices3x3={};for(n in e._matrices3x3)t.matrices3x3[n]=e._matrices3x3[n];t.matrices2x2={};for(n in e._matrices2x2)t.matrices2x2[n]=e._matrices2x2[n];t.vectors3Arrays={};for(n in e._vectors3Arrays)t.vectors3Arrays[n]=e._vectors3Arrays[n]}},n.ParseCustomProperties=function(t,n,a,r){if(null!=n&&null!=t){var i;for(i in n.textures){var o=n.textures[i];o&&t.setTexture(i,e.Texture.Parse(o,a,r))}for(i in n.textureArrays){for(var l=n.textureArrays[i],s=new Array,c=0;c<l.length;c++)s.push(e.Texture.Parse(l[c],a,r));t.setTextureArray(i,s)}for(i in n.floats)t.setFloat(i,n.floats[i]);for(i in n.floatsArrays)t.setFloats(i,n.floatsArrays[i]);for(i in n.colors3)t.setColor3(i,e.Color3.FromArray(n.colors3[i]));for(i in n.colors4)t.setColor4(i,e.Color4.FromArray(n.colors4[i]));for(i in n.vectors2)t.setVector2(i,e.Vector2.FromArray(n.vectors2[i]));for(i in n.vectors3)t.setVector3(i,e.Vector3.FromArray(n.vectors3[i]));for(i in n.vectors4)t.setVector4(i,e.Vector4.FromArray(n.vectors4[i]));for(i in n.matrices)t.setMatrix(i,e.Matrix.FromArray(n.matrices[i]));for(i in n.matrices3x3)t.setMatrix3x3(i,n.matrices3x3[i]);for(i in n.matrices2x2)t.setMatrix2x2(i,n.matrices2x2[i]);for(i in n.vectors3Arrays)t.setArray3(i,n.vectors3Arrays[i])}},n.prototype.getManager=function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},n.prototype._checkUniform=function(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)},n.prototype._checkSampler=function(e){this._samplers.indexOf(e)===-1&&this._samplers.push(e)},n.prototype._buildCustomShader=function(e,t,n,a,r){var i=this;null!=this.program&&""!==this.program||(this.program="default");var o=this._locals.getDefines();if(null!=o){var l=Object.keys(o);if(null!=l&&l.length>0){for(var s=r,c=0,u=l;c<u.length;c++){var p=u[c];s[p]=o[p]}r.rebuild()}}var m=0;if(null!=this._uniforms&&this._uniforms.length>0)for(m=0;m<this._uniforms.length;m++)t.push(this._uniforms[m]);if(m=0,null!=this._samplers&&this._samplers.length>0)for(m=0;m<this._samplers.length;m++)a.push(this._samplers[m]);var d=this._afterBind;return this._afterBind=function(e,t){if(i._attachAfterBind(e,t),d)try{d(e,t)}catch(n){}},this.program},n.prototype._attachAfterBind=function(e,t){var n,a=this.getScene();if(a.texturesEnabled)for(n in this._textures){var r=this._textures[n];r&&(t.setTexture(n,r),t.setFloat2(n+"Infos",r.coordinatesIndex,r.level),t.setFloat2(n+"Scale",r.uScale,r.vScale),t.setMatrix(n+"Matrix",r.getTextureMatrix()))}if(a.texturesEnabled)for(n in this._textureArrays)t.setTextureArray(n,this._textureArrays[n]);for(n in this._floats)t.setFloat(n,this._floats[n]);for(n in this._floatsArrays)t.setArray(n,this._floatsArrays[n]);for(n in this._colors3)t.setColor3(n,this._colors3[n]);for(n in this._colors4){var i=this._colors4[n];t.setFloat4(n,i.r,i.g,i.b,i.a)}for(n in this._vectors2)t.setVector2(n,this._vectors2[n]);for(n in this._vectors3)t.setVector3(n,this._vectors3[n]);for(n in this._vectors4)t.setVector4(n,this._vectors4[n]);for(n in this._matrices)t.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)t.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)t.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors3Arrays)t.setArray3(n,this._vectors3Arrays[n])},n.prototype.initializeInstance=function(){this._started=!1;var e=this;e._register=function(){e.registerInstance(e)},e._before=function(){e.updateInstance(e)},e._after=function(){e.afterInstance(e)},e._destroy=function(){e.destoryInstance(e)},e._register()},n.prototype.registerInstance=function(e){e.getScene().registerBeforeRender(e._before),e.getScene().registerAfterRender(e._after)},n.prototype.updateInstance=function(e){e._started?e.update():(e.start(),e._started=!0)},n.prototype.afterInstance=function(e){e._started&&e.after()},n.prototype.destoryInstance=function(e){e.getScene().unregisterBeforeRender(e._before),e.getScene().unregisterAfterRender(e._after),e.destroy(),e._started=!1,e._register=null,e._before=null,e._after=null,e._destroy=null},n.prototype.dispose=function(e,n){if(n){var a;for(a in this._textures){var r=this._textures[a];r&&r.dispose(),this._textures[a]=null}for(a in this._textureArrays)for(var i=this._textureArrays[a],o=0;o<i.length;o++)i[o].dispose()}this._textures={},this._destroy(),t.prototype.dispose.call(this,e,n)},n}(e.StandardMaterial);e.UniversalShaderMaterial=a;var r=function(t){function n(e,n,a){void 0===a&&(a=!0);var r=t.call(this,e,n,a)||this;r._totalTexturesLoaded=0,r._maxTexturesImageUnits=0,r.program="splatmap";var i=n.getEngine(),o=i.getCaps();return r._totalTexturesLoaded=0,r._maxTexturesImageUnits=o.maxTexturesImageUnits,r}return __extends(n,t),Object.defineProperty(n.prototype,"totalTexturesLoaded",{get:function(){return this._totalTexturesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxTexturesImageUnits",{get:function(){return this._maxTexturesImageUnits},enumerable:!0,configurable:!0}),n.prototype.start=function(){var t=this;this._totalTexturesLoaded=0,this.diffuseTexture&&this._totalTexturesLoaded++,this.bumpTexture&&this._totalTexturesLoaded++,
this.lightmapTexture&&this._totalTexturesLoaded++,this.reflectionTexture&&this._totalTexturesLoaded++,this.emissiveTexture&&this._totalTexturesLoaded++,this.specularTexture&&this._totalTexturesLoaded++,this.ambientTexture&&this._totalTexturesLoaded++,this.opacityTexture&&this._totalTexturesLoaded++,this.refractionTexture&&this._totalTexturesLoaded++,this.cameraColorGradingTexture&&this._totalTexturesLoaded++;var n;for(n in this.textures){var a=this.textures[n];a&&this._totalTexturesLoaded++}for(n in this.textureArray){var r=this.textureArray[n];r&&r.forEach(function(e){e&&t._totalTexturesLoaded++})}this.totalTexturesLoaded>this.maxTexturesImageUnits&&e.Tools.Warn("Babylon.js max terrain texture units exceeded ("+this.totalTexturesLoaded.toString()+" of "+this.maxTexturesImageUnits.toString()+")")},n.prototype.define=function(e){e.defineNumeric("TOTAL_TEXTURES_LOADED",this.totalTexturesLoaded),e.defineNumeric("MAX_TEXTURE_IMAGE_UNITS",this.maxTexturesImageUnits),this.totalTexturesLoaded<=this.maxTexturesImageUnits&&e.defineBoolean("SPLATMAPS_ENABLED")},n.prototype.clone=function(t){var n=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalTerrainMaterial(t,n.getScene())},this);return e.UniversalShaderMaterial.CloneCustomProperties(this,a),a},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalTerrainMaterial",e.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},n.Parse=function(t,n,a){var r=e.SerializationHelper.Parse(function(){return new e.UniversalTerrainMaterial(t.name,n)},t,n,a);return e.UniversalShaderMaterial.ParseCustomProperties(r,t,n,a),r},n}(e.UniversalShaderMaterial);e.UniversalTerrainMaterial=r}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(e,a,r,i,o,l,s){void 0===i&&(i=0),void 0===o&&(o=n.EMISSION_RATE),void 0===l&&(l=.01),void 0===s&&(s=null);var c=t.call(this,e,a,r)||this;return c.emitType=n.EMISSION_RATE,c.loopPlay=!1,c.delayTime=0,c._self=null,c._duration=0,c._startSpeed=-1,c._emissionBurst=null,c._self=c,c._duration=i,c._startSpeed=l,c._emissionBurst=s,c.delayTime=0,c.loopPlay=!1,c.emitType=o,c.updateSpeed=l,c.targetStopDuration=0,c.updateFunction=c.defaultUpdateFunctionHandler,c.manualEmitCount=c.emitType===n.EMISSION_BURST?0:-1,c}return __extends(n,t),Object.defineProperty(n,"EMISSION_RATE",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EMISSION_BURST",{get:function(){return 1},enumerable:!0,configurable:!0}),n.prototype.getDuration=function(){return this._duration},n.prototype.start=function(){var t=this;if(this.internalStop(!1),this.updateSpeed=this._startSpeed,this.targetStopDuration=0,this.emitType===n.EMISSION_BURST?null!=this._emissionBurst&&this._emissionBurst.length>0&&this._emissionBurst.forEach(function(e){t.internalPlay(t.delayTime+e.time,e.minCount,e.maxCount)}):this.internalPlay(this.delayTime),this._duration>0){var a=this.delayTime+this._duration;e.SceneManager.GetInstance().delay(function(){t.internalCycle()},1e3*a)}},n.prototype.stop=function(){this.internalStop(!0)},n.prototype.dispose=function(){this.internalStop(!0),this._emissionBurst=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"internalScene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),n.prototype.internalPlay=function(t,n,a){var r=this;void 0===t&&(t=0),void 0===n&&(n=-1),void 0===a&&(a=-1),t>0?e.SceneManager.GetInstance().delay(function(){r.internalStart(n,a)},1e3*t):this.internalStart(n,a)},n.prototype.internalCycle=function(){this.stop(),this.loopPlay===!0&&this.start()},n.prototype.internalStart=function(a,r){var i=this.emitType===n.EMISSION_BURST?0:-1;this.emitType===n.EMISSION_BURST&&a>=1&&r>=1&&(i=e.Scalar.RandomRange(a,r)),this.manualEmitCount=i,t.prototype.start.call(this)},n.prototype.internalStop=function(e){if(void 0===e&&(e=!1),e===!1){var n=this;null!=n&&n._started&&!n._stopped&&t.prototype.stop.call(this)}else t.prototype.stop.call(this)},n.prototype.getParticles=function(){return this.particles},n.prototype.defaultUpdateFunctionHandler=function(e){if(null!=this._self)for(var t=0;t<e.length;t++){var n=e[t];n.age+=this._self._scaledUpdateSpeed,n.age>=n.lifeTime?(this._self._emitFromParticle(n),this._self.recycleParticle(n),t--):(n.colorStep.scaleToRef(this._self._scaledUpdateSpeed,this._self._scaledColorStep),n.color.addInPlace(this._self._scaledColorStep),n.color.a<0&&(n.color.a=0),n.angle+=n.angularSpeed*this._self._scaledUpdateSpeed,n.direction.scaleToRef(this._self._scaledUpdateSpeed,this._self._scaledDirection),n.position.addInPlace(this._self._scaledDirection),this._self.gravity.scaleToRef(this._self._scaledUpdateSpeed,this._self._scaledGravity),n.direction.addInPlace(this._self._scaledGravity),this._self._isAnimationSheetEnabled&&n.updateCellIndex())}},n}(e.ParticleSystem);e.ShurikenParticleSystem=t;var n=function(t){function n(e,n,a,r,i,o){void 0===r&&(r=4096),void 0===i&&(i=0),void 0===o&&(o=.01);var l=t.call(this,e,{capacity:n,randomTextureSize:r},a)||this;return l.loopPlay=!1,l.delayTime=0,l._self=null,l._duration=0,l._startSpeed=-1,l._self=l,l._duration=i,l._startSpeed=o,l.delayTime=0,l.loopPlay=!1,l.updateSpeed=o,l.targetStopDuration=0,l}return __extends(n,t),n.prototype.getDuration=function(){return this._duration},n.prototype.start=function(){var t=this;if(this.internalStop(!1),this.updateSpeed=this._startSpeed,this.targetStopDuration=0,this.internalPlay(this.delayTime),this._duration>0){var n=this.delayTime+this._duration;e.SceneManager.GetInstance().delay(function(){t.internalCycle()},1e3*n)}},n.prototype.stop=function(){this.internalStop(!0)},n.prototype.dispose=function(){this.internalStop(!0),t.prototype.dispose.call(this)},n.prototype.internalPlay=function(t,n,a){var r=this;void 0===t&&(t=0),void 0===n&&(n=-1),void 0===a&&(a=-1),t>0?e.SceneManager.GetInstance().delay(function(){r.internalStart(n,a)},1e3*t):this.internalStart(n,a)},n.prototype.internalCycle=function(){this.stop(),this.loopPlay===!0&&this.start()},n.prototype.internalStart=function(e,n){t.prototype.start.call(this)},n.prototype.internalStop=function(e){if(void 0===e&&(e=!1),e===!1){var n=this;null!=n&&n._started&&!n._stopped&&t.prototype.stop.call(this)}else t.prototype.stop.call(this)},n}(e.GPUParticleSystem);e.GPUShurikenParticleSystem=n}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;if(o._fps=30,o._legacy=!1,o._targets=null,o._machine=null,o._skeletal=!1,o._executed=!1,o._autoplay=!0,o._checkers=new e.TransitionCheck,o._boneAnim=null,o._boneWeight=0,o._boneMatrix=e.Matrix.Zero(),o._sampleMatrix=e.Matrix.Zero(),o._inputPosition=e.Vector2.Zero(),o._childPosition=e.Vector2.Zero(),o._onAnimationFrameHandler=null,o._onAnimationEventHandlers=null,o._onAnimationBehaveHandlers=null,o.enabled=!1,o.speedRatio=1,o.autoTicking=!0,o.enableTransitions=!0,o.directBlendSpeed=1,o._targets=null,o._machine=null,o._legacy=!1,o._executed=!1,o._autoplay=!0,o._onAnimationFrameHandler=null,o._onAnimationEventHandlers={},o._onAnimationBehaveHandlers={},o.directBlendSpeed=1,o.speedRatio=1,o._fps=o.getProperty("timelineStep",30),o._skeletal=2===o.getProperty("controlType",0),o.enabled=o.getProperty("enableStateMachine",!1),o.enableTransitions=o.getProperty("enableTransitions",!0),null!=o.entity.metadata)if(o.entity.metadata.state={},o.entity.metadata.state.data={},o.entity.metadata.state.clips={},o.entity.metadata.state.floats={},o.entity.metadata.state.booleans={},o.entity.metadata.state.triggers={},o.entity.metadata.state.parameters={},null!=o.entity.metadata.properties&&null!=o.entity.metadata.properties.stateMachineInfo){if(o._machine=o.entity.metadata.properties.stateMachineInfo,o._legacy=o._machine.legacy,o._legacy===!0&&(o._autoplay=o._machine.auto),null!=o._machine.speed&&(o.speedRatio=o._machine.speed),null!=o._machine.parameters&&o._machine.parameters.length>0){var l=o._machine.parameters;l.forEach(function(t){var n=t.name,a=t.type,r=(t.curve,t.defaultFloat),i=t.defaultBool,l=t.defaultInt;o.entity.metadata.state.parameters[n]=a,a===e.AnimatorParameterType.Bool?o.setBool(n,i):a===e.AnimatorParameterType.Float?o.setFloat(n,r):a===e.AnimatorParameterType.Int?o.setInteger(n,l):a===e.AnimatorParameterType.Trigger&&o.resetTrigger(n)})}}else e.Tools.Warn("Babylon.js cannot locate owner animation state machine info metadata for: "+o.entity.name);null!=o._machine.layers&&o._machine.layers.length>0&&(o._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),o._machine.layers.forEach(function(t){t.animationNormalize=e.AnimationState.TIMER,t.animationReference=e.AnimationState.TIMER*o._fps,t.animationBlendMatrix=e.Matrix.Zero()}));if(o._targets=o.manager.getAnimationTargets(o.entity),o._skeletal===!0){var s=o.getTargetSkeletons();null!=s&&s.length>0&&s.forEach(function(e){var t=e;if(null==t.metadata&&(t.metadata={}),t.metadata.resetBlending=!1,null!=e.bones&&e.bones.length>0){var n=0;e.bones.forEach(function(e){null==e.metadata&&(e.metadata={}),e.metadata.index=n,e.metadata.blendingFactor=0,e.metadata.originalBlendValue=null,null!=e.metadata.transformPath&&""!==e.metadata.transformPath&&null!=o._machine.layers&&o._machine.layers.length>0&&o._machine.layers.forEach(function(t){null!=t.avatarMask&&null!=t.avatarMask.transformPaths&&t.avatarMask.transformPaths.length>0&&o.checkBoneTransformPath(t,e.metadata.transformPath)&&(null==t.avatarMask.transformIndexs&&(t.avatarMask.transformIndexs=[]),t.avatarMask.transformIndexs.push(n))}),n++})}})}return o}return __extends(n,t),Object.defineProperty(n.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"legacy",{get:function(){return this._legacy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"skeletal",{get:function(){return this._skeletal},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"executing",{get:function(){return this._executed},enumerable:!0,configurable:!0}),n.prototype.start=function(){this.startStateMachine()},n.prototype.update=function(){this.autoTicking===!0&&this.updateStateMachine()},n.prototype.destroy=function(){this._targets=null,this._machine=null,this._checkers=null,this._boneAnim=null,this._boneWeight=0,this._boneMatrix=null,this._inputPosition=null,this._childPosition=null,this._onAnimationFrameHandler=null,this._onAnimationEventHandlers=null,this._onAnimationBehaveHandlers=null,null!=this.entity.metadata&&null!=this.entity.metadata.state&&(this.entity.metadata.state=null)},n.prototype.play=function(t,n,a){void 0===n&&(n=0),void 0===a&&(a=0),this.enabled===!0&&null!=this._machine.layers&&this._machine.layers.length>a&&this.setCurrentAnimationState(this._machine.layers[a],t,e.Utilities.ComputeBlendingSpeed(this._fps,n))},n.prototype.getBool=function(e){var t=!1;return null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.booleans&&null!=this.entity.metadata.state.booleans[e]&&(t=this.entity.metadata.state.booleans[e]),t},n.prototype.setBool=function(e,t){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.booleans&&(this.entity.metadata.state.booleans[e]=t)},n.prototype.getFloat=function(e){var t=0;return null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.floats&&null!=this.entity.metadata.state.floats[e]&&(t=this.entity.metadata.state.floats[e]),t},n.prototype.setFloat=function(e,t){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.floats&&(this.entity.metadata.state.floats[e]=t)},n.prototype.getInteger=function(e){var t=0;return null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.floats&&null!=this.entity.metadata.state.floats[e]&&(t=this.entity.metadata.state.floats[e]),t},n.prototype.setInteger=function(e,t){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.floats&&(this.entity.metadata.state.floats[e]=t)},n.prototype.getTrigger=function(e){var t=!1;return null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.triggers&&null!=this.entity.metadata.state.triggers[e]&&(t=this.entity.metadata.state.triggers[e]),t},n.prototype.setTrigger=function(e){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.triggers&&(this.entity.metadata.state.triggers[e]=!0)},n.prototype.resetTrigger=function(e){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.triggers&&(this.entity.metadata.state.triggers[e]=!1)},n.prototype.tickStateMachine=function(){this.autoTicking===!1?this.updateStateMachine():e.Tools.Warn("Manual tick request ignored. Auto ticking is enabled for animator: "+this.entity.name)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getTargetSkeletons=function(){var t=null;return this._skeletal===!0&&null!=this._targets&&this._targets.length>0&&this._targets.forEach(function(n){if(n instanceof e.AbstractMesh){var a=n;null!=a.skeleton&&(null==t&&(t=[]),t.push(a.skeleton))}}),t},n.prototype.onAnimationBehaviour=function(e,t){null!=e&&""!==e&&(this._onAnimationBehaveHandlers[e.toLowerCase()]=t)},n.prototype.onAnimationTrackEvent=function(e,t){null!=e&&""!==e&&(this._onAnimationEventHandlers[e.toLowerCase()]=t)},n.prototype.onAnimationFrameUpdate=function(e){this._onAnimationFrameHandler=e},n.prototype.getMachineState=function(e){var t=null;return null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.data&&null!=this.entity.metadata.state.data[e]&&(t=this.entity.metadata.state.data[e]),t},n.prototype.setMachineState=function(e,t){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.data&&(this.entity.metadata.state.data[e]=t)},n.prototype.getAnimationClip=function(e){var t=null;return null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.clips&&null!=this.entity.metadata.state.clips[e]&&(t=this.entity.metadata.state.clips[e]),t},n.prototype.setAnimationClip=function(e,t){null!=this.entity.metadata&&null!=this.entity.metadata.state&&null!=this.entity.metadata.state.clips&&(this.entity.metadata.state.clips[e]=t)},n.prototype.getDenormalizedFrame=function(e,t){return null==e?0:e.start+(e.stop-e.start)*t},n.prototype.getAnimationFrames=function(e){return null==e?0:e.stop-e.start+1},n.prototype.setTreeBranches=function(t){var n=this;null!=t&&null!=t.children&&t.children.length>0&&t.children.forEach(function(t){t.type===e.MotionType.Tree?n.setTreeBranches(t.subtree):t.type===e.MotionType.Clip&&null!=t.motion&&""!==t.motion&&(t.track=n.getAnimationClip(t.motion))})},n.prototype.blendBoneMatrix=function(t,n){if(void 0===n&&(n=1),null!=t&&n>0&&null!=this._boneMatrix){var a=e.Scalar.Clamp(n,0,1);0===this._boneWeight?this._boneMatrix.copyFrom(t):e.Utilities.FastMatrixSlerp(this._boneMatrix,t,a,this._boneMatrix),this._boneWeight+=a}},n.prototype.updateBoneMatrix=function(t,n,a){void 0===n&&(n=!1),void 0===a&&(a=0),null!=this._boneMatrix&&null!=t&&(n===!0&&a>0&&null!=t.metadata&&(t.metadata.blendingFactor<=1&&null==t.metadata.originalBlendValue&&(t.metadata.originalBlendValue=t._matrix.clone()),t.metadata.blendingFactor<=1&&null!=t.metadata.originalBlendValue&&(e.Utilities.FastMatrixSlerp(t.metadata.originalBlendValue,this._boneMatrix,t.metadata.blendingFactor,this._boneMatrix),t.metadata.blendingFactor+=a)),t._matrix.copyFrom(this._boneMatrix),t.markAsDirty())},n.prototype.startStateMachine=function(){var e=this,t=this.manager.getAnimationClips(this.entity);null!=t&&t.length>0&&t.forEach(function(t){null!=t&&null!=t.name&&e.setAnimationClip(t.name,t)}),null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0&&this._machine.states.forEach(function(t){null!=t&&null!=t.name&&(e.setTreeBranches(t.blendtree),e.setMachineState(t.name,t))}),this._executed===!1&&(this._executed=!0,this.enabled===!0&&this._autoplay===!0&&(this._legacy===!0?this.manager.playAnimationClip(null,this.entity):null!=this._machine.layers&&this._machine.layers.length>0&&(1==this._skeletal?this._machine.layers.forEach(function(t){e.setCurrentAnimationState(t,t.entry,0)}):this.setCurrentAnimationState(this._machine.layers[0],this._machine.layers[0].entry,0))))},n.prototype.updateStateMachine=function(){var e=this;if(this.enabled===!0){this.updateAnimationCurves();var t=this.manager.deltaTime;null!=this._machine.layers&&this._machine.layers.length>0&&(1==this._skeletal?this._machine.layers.forEach(function(n){null!=n&&e.processStateMachine(n,t)}):null!=this._machine.layers[0]&&this.processStateMachine(this._machine.layers[0],t)),this.updateAnimationTargets(),null!=this._onAnimationFrameHandler&&this._onAnimationFrameHandler()}},n.prototype.updateAnimationCurves=function(){},n.prototype.updateAnimationTargets=function(){var t=this;this._skeletal===!0&&null!=this._targets&&this._targets.length>0&&this._targets.forEach(function(n){if(null!=n&&n instanceof e.AbstractMesh){var a=n;if(null!=a&&null!=a.skeleton&&null!=a.skeleton.bones&&a.skeleton.bones.length>0){var r=a.skeleton,i=null!=r.metadata&&r.metadata.resetBlending;a.skeleton.bones.forEach(function(n){if(t._boneAnim=null,t._boneWeight=0,t._boneMatrix.reset(),i===!0&&(null==n.metadata&&(n.metadata={}),n.metadata.blendingFactor=0,n.metadata.originalBlendValue=null),null!=n.animations&&n.animations.length>0){for(var r=0;r<n.animations.length;r++){var o=n.animations[r];if("skeleton:"===o.name.substr(0,9)&&o.dataType===e.Animation.ANIMATIONTYPE_MATRIX){t._boneAnim=o;break}}if(null!=t._boneAnim){var l=a.skeleton.animationPropertiesOverride?a.skeleton.animationPropertiesOverride.blendingSpeed:t._boneAnim.blendingSpeed;null!=t._machine.layers&&t._machine.layers.length>0&&t._machine.layers.forEach(function(a){null!=a.animationStateMachine&&(a.animationBlendWeight=0,a.animationBlendMatrix.reset(),(0===a.index||a.defaultWeight>0)&&(0===a.index||null==a.avatarMask||null==a.avatarMask.transformIndexs||t.filterBoneTransformIndex(a,n))&&(a.animationStateMachine.type===e.MotionType.Tree||a.animationStateMachine.type===e.MotionType.Clip&&a.animationBlendFrame>=0&&(a.animationBlendFirst||a.animationBlendLoop<2))&&null!=a.animationBlendBuffer&&a.animationBlendBuffer.length>0&&a.animationBlendBuffer.forEach(function(n){null!=n.track&&(t._sampleMatrix.reset(),e.Utilities.SampleAnimationMatrix(t._boneAnim,n.frame,e.Scalar.Clamp(n.track.behavior,0,1),t._sampleMatrix),n.mirror===!0,t.blendAnimationMatrix(a,t._sampleMatrix,n.weight))}),a.animationBlendWeight>0&&(a.animationBlendSpeed>l&&(l=a.animationBlendSpeed),t.blendBoneMatrix(a.animationBlendMatrix,0===a.index?1:a.defaultWeight)))}),t._boneWeight>0&&t.updateBoneMatrix(n,l>0,l)}}}),null==r.metadata&&(r.metadata={}),r.metadata.resetBlending=!1}}})},n.prototype.processStateMachine=function(t,n){var a=this;t.animationTime+=n*(t.animationRatio*this.speedRatio*e.Constants.SpeedCompensator),t.animationTime>t.animationNormalize&&(t.animationTime=0),t.animationFrame=e.Scalar.Normalize(t.animationTime,0,t.animationNormalize),t.animationBlendLoop=-1,t.animationBlendFrame=-1,t.animationBlendFirst=!1,t.animationBlendBuffer=null,this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=t.animationStateMachine&&(this.checkStateTransitions(t,t.animationStateMachine.transitions,t.animationStateMachine.time,t.animationStateMachine.length,t.animationStateMachine.rate),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(t,this._machine.transitions,t.animationStateMachine.time,t.animationStateMachine.length,t.animationStateMachine.rate)),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){a.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this._checkers.offest>0?this.manager.delay(function(){a.setCurrentAnimationState(t,a._checkers.result,a._checkers.blending)},1e3*this._checkers.offest):this.setCurrentAnimationState(t,this._checkers.result,this._checkers.blending)),this.parseSkeletalAnimationTrackLayer(t),this.parseAnimationStateMachineEvents(t)},n.prototype.parseAnimationStateMachineEvents=function(e){},n.prototype.setCurrentAnimationState=function(t,n,a){if(null!=n&&""!==n&&n!==e.AnimationState.EXIT&&(null==t.animationStateMachine||t.animationStateMachine.name!==n)){var r=this.getMachineState(n);null!=r&&r.layerIndex===t.index&&(r.time=0,r.played=0,r.interrupted=!1,t.animationTime=0,t.animationFrame=0,t.animationRatio=1,t.animationAnimatables=null,t.animationBlendLoop=-1,t.animationBlendFrame=-1,t.animationBlendFirst=!1,t.animationBlendSpeed=a,t.animationBlendWeight=0,t.animationBlendBuffer=null,t.animationStateMachine=r,t.animationStateMachine.time=this.manager.time,t.animationAnimatables=this.setupBaseAnimationState(t,a,t.animationStateMachine.speed))}},n.prototype.setupBaseAnimationState=function(e,t,n){var a=this;void 0===t&&(t=0),void 0===n&&(n=1);var r=null;return 0===e.index&&null!=this._targets&&this._targets.length>0&&this._targets.forEach(function(i){if(null!=i)if(a._skeletal===!0)null!=i.skeleton&&(null==i.skeleton.metadata&&(i.skeleton.metadata={}),i.skeleton.metadata.resetBlending=!0),a.scene.stopAnimation(i),a.manager.setAnimationProperties(i,1,t);else{a.scene.stopAnimation(i);var o=e.animationStateMachine&&null!=e.animationStateMachine.blendtree&&null!=e.animationStateMachine.blendtree.children&&e.animationStateMachine.blendtree.children.length>0?e.animationStateMachine.blendtree.children[0].track:null;if(null!=o){a.manager.setAnimationProperties(i,o.behavior,t);var l=a.scene.beginAnimation(i,o.start,o.stop,o.behavior<2,n);null!=l&&(null==r&&(r=[]),r.push(l))}}}),r},n.prototype.checkStateTransitions=function(t,n,a,r,i){var o=this;if(this.enableTransitions===!0&&null!=n&&n.length>0){var l=0,s=-1;for(l=0;l<n.length;l++)if(n[l].solo===!0&&n[l].mute===!1){s=l;break}var c=function(){var c=n[l];if(c.layerIndex!==t.index)return"continue";if(c.mute===!0)return"continue";if(s>=0&&s!==l)return"continue";var p=!1,m=e.Scalar.Denormalize(c.exitTime,0,r),d=u.manager.time-a>=m;if(c.hasExitTime===!0&&c.intSource==e.InterruptionSource.None&&d===!1)return"continue";if(null!=c.conditions&&c.conditions.length>0){var g=0,h=c.conditions.length;c.conditions.forEach(function(t){if(null!=o.entity.metadata.state.parameters[t.parameter]){var n=o.entity.metadata.state.parameters[t.parameter];if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var a=parseFloat(o.getFloat(t.parameter).toFixed(2));t.mode===e.ConditionMode.Greater&&a>t.threshold?g++:t.mode===e.ConditionMode.Less&&a<t.threshold?g++:t.mode===e.ConditionMode.Equals&&a===t.threshold?g++:t.mode===e.ConditionMode.NotEqual&&a!==t.threshold&&g++}else if(n==e.AnimatorParameterType.Bool){var r=o.getBool(t.parameter);t.mode===e.ConditionMode.If&&r===!0?g++:t.mode===e.ConditionMode.IfNot&&r===!1&&g++}else if(n==e.AnimatorParameterType.Trigger){var i=o.getTrigger(t.parameter);i===!0&&(g++,o._checkers.triggered.indexOf(t.parameter)<0&&o._checkers.triggered.push(t.parameter))}}}),p=c.hasExitTime===!0?d===!0&&g===h:g===h}else p=c.hasExitTime===!0&&d===!0;if(p===!0){var y=c.isExit===!1?c.destination:e.AnimationState.EXIT,f=e.Scalar.Denormalize(c.offset,0,r),S=e.Scalar.Denormalize(c.duration,0,r),b=e.Utilities.ComputeBlendingSpeed(i,S);return u._checkers.result=y,u._checkers.offest=f,u._checkers.blending=b,"break"}},u=this;for(l=0;l<n.length;l++){var p=c();if("break"===p)break}}},n.prototype.computeSpeedRatio=function(t,n,a,r,i){void 0===a&&(a=null),void 0===r&&(r=1),void 0===i&&(i=1);var o=1;if(null!=n&&null!=a){var l=t.animationReference/this.getAnimationFrames(n),s=t.animationReference/this.getAnimationFrames(a);o=e.Scalar.Lerp(l,s,r)}else null!=n&&null==a?o=t.animationReference/this.getAnimationFrames(n):null!=a&&null==n&&(o=t.animationReference/this.getAnimationFrames(a));return o*i},n.prototype.blendAnimationMatrix=function(t,n,a){if(void 0===a&&(a=1),null!=n&&a>0&&null!=t.animationBlendMatrix){var r=e.Scalar.Clamp(a,0,1);0===t.animationBlendWeight?t.animationBlendMatrix.copyFrom(n):e.Utilities.FastMatrixSlerp(t.animationBlendMatrix,n,r,t.animationBlendMatrix),t.animationBlendWeight+=r}},n.prototype.checkBoneTransformPath=function(e,t){var n=!1;return null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&e.avatarMask.transformPaths.length>0&&e.avatarMask.transformPaths.indexOf(t)>=0&&(n=!0),n},n.prototype.filterBoneTransformIndex=function(e,t){var n=!1;return null!=e.avatarMask&&null!=e.avatarMask.transformIndexs&&e.avatarMask.transformIndexs.length>0&&null!=t.metadata&&null!=t.metadata.index&&e.avatarMask.transformIndexs.indexOf(t.metadata.index)>=0&&(n=!0),n},n.prototype.sortBlendingBuffer=function(e){null!=e.animationBlendBuffer&&e.animationBlendBuffer.length>0&&e.animationBlendBuffer.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.resetTreeBranches=function(t,n){var a=this;n.directBlendMaster=null,n.simpleThresholdEqual=null,n.simpleThresholdLower=null,n.simpleThresholdUpper=null,n.simpleThresholdDelta=1,n.valueParameterX=parseFloat(this.getFloat(n.blendParameterX).toFixed(2)),n.valueParameterY=parseFloat(this.getFloat(n.blendParameterY).toFixed(2)),null!=n.children&&n.children.length>0&&(n.children.forEach(function(r){r.input=-1,r.frame=-1,r.weight=-1,r.indexs=null!=t.avatarMask&&null!=t.avatarMask.transformIndexs&&t.avatarMask.transformIndexs.length>0?t.avatarMask.transformIndexs:null,a.resetInputDistanceWeight(n,r),r.type===e.MotionType.Tree&&a.resetTreeBranches(t,r.subtree)}),this.resetInputDistanceThreasholds(n))},n.prototype.resetInputDistanceWeight=function(t,n){switch(this._childPosition.x=n.positionX,this._childPosition.y=n.positionY,this._inputPosition.x=t.valueParameterX,this._inputPosition.y=t.valueParameterY,t.blendType){case e.BlendTreeType.Simple1D:null==t.simpleThresholdEqual&&(t.valueParameterX===n.threshold?(t.simpleThresholdEqual=n,t.simpleThresholdLower=null,t.simpleThresholdUpper=null):t.valueParameterX>n.threshold?null==t.simpleThresholdLower?t.simpleThresholdLower=n:n.threshold>t.simpleThresholdLower.threshold&&(t.simpleThresholdLower=n):t.valueParameterX<n.threshold&&(null==t.simpleThresholdUpper?t.simpleThresholdUpper=n:n.threshold<t.simpleThresholdUpper.threshold&&(t.simpleThresholdUpper=n)));break;case e.BlendTreeType.SimpleDirectional2D:n.input=this.computeSimpleDirectionalWeight(t,this._inputPosition,this._childPosition);break;case e.BlendTreeType.FreeformDirectional2D:n.input=this.computeFreeformDirectionalWeight(t,this._inputPosition,this._childPosition);break;case e.BlendTreeType.FreeformCartesian2D:n.input=this.computeFreeformCartesianWeight(t,this._inputPosition,this._childPosition)}},n.prototype.resetInputDistanceThreasholds=function(t){t.blendType===e.BlendTreeType.Simple1D&&(null==t.simpleThresholdEqual&&(null!=t.simpleThresholdLower&&null==t.simpleThresholdUpper?(t.simpleThresholdEqual=t.simpleThresholdLower,t.simpleThresholdLower=null,t.simpleThresholdUpper=null):null!=t.simpleThresholdUpper&&null==t.simpleThresholdLower&&(t.simpleThresholdEqual=t.simpleThresholdUpper,t.simpleThresholdLower=null,t.simpleThresholdUpper=null)),null!=t.simpleThresholdLower&&null!=t.simpleThresholdUpper?t.simpleThresholdDelta=parseFloat(e.Scalar.Normalize(t.valueParameterX,t.simpleThresholdLower.threshold,t.simpleThresholdUpper.threshold).toFixed(2)):t.simpleThresholdDelta=1)},n.prototype.parseTreeBranches=function(t,n,a){var r=this;null!=n&&null!=n.children&&n.children.length>0&&n.children.forEach(function(i){switch(n.blendType){case e.BlendTreeType.Clip:r.parseClipTreeItem(t,n,i,a);break;case e.BlendTreeType.Direct:r.parseDirectTreeItem(t,n,i,a);break;case e.BlendTreeType.Simple1D:r.parseSimpleTreeItem(t,n,i,a);break;case e.BlendTreeType.SimpleDirectional2D:r.parseSimpleDirectionalTreeItem(t,n,i,a);break;case e.BlendTreeType.FreeformDirectional2D:r.parseFreeformDirectionalTreeItem(t,n,i,a);break;case e.BlendTreeType.FreeformCartesian2D:r.parseFreeformCartesianTreeItem(t,n,i,a)}i.weight>0&&(null==t.animationBlendBuffer&&(t.animationBlendBuffer=[]),t.animationBlendBuffer.push(i))})},n.prototype.parseClipTreeItem=function(e,t,n,a){null!=n&&null!=t&&null!=n.track&&null!=e.animationStateMachine&&(e.animationBlendLoop=n.track.behavior,e.animationBlendFirst=e.animationStateMachine.played!==-1&&e.animationStateMachine.played<=n.track.frames,e.animationBlendFirst===!1&&e.animationStateMachine.played!==-1&&(e.animationStateMachine.played=-1),e.animationBlendFrame=this.getDenormalizedFrame(n.track,e.animationFrame),n.frame=e.animationBlendFrame,n.weight=1)},n.prototype.parseDirectTreeItem=function(t,n,a,r){null!=a&&null!=n&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=this.getFloat(a.directBlendParameter),(null==n.directBlendMaster||a.weight>n.directBlendMaster.weight)&&(n.directBlendMaster=a)))},n.prototype.parseSimpleTreeItem=function(t,n,a,r){null!=a&&null!=n&&(null!=n.simpleThresholdEqual&&a.threshold===n.simpleThresholdEqual.threshold?a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=1):null!=n.simpleThresholdLower&&null!=n.simpleThresholdUpper&&a.threshold>=n.simpleThresholdLower.threshold&&a.threshold<=n.simpleThresholdUpper.threshold&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=1)))},n.prototype.parseSimpleDirectionalTreeItem=function(t,n,a,r){null!=a&&null!=n&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=0))},n.prototype.parseFreeformDirectionalTreeItem=function(t,n,a,r){null!=a&&null!=n&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=0))},n.prototype.parseFreeformCartesianTreeItem=function(t,n,a,r){null!=a&&null!=n&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=0))},n.prototype.parseSkeletalAnimationTrackLayer=function(t){if(this._skeletal===!0&&null!=t.animationStateMachine&&null!=t.animationStateMachine.blendtree&&(t.animationStateMachine.type===e.MotionType.Clip&&t.animationStateMachine.played!==-1&&(t.animationStateMachine.played+=this.manager.deltaTime*this._fps),this.resetTreeBranches(t,t.animationStateMachine.blendtree),
this.parseTreeBranches(t,t.animationStateMachine.blendtree,t.animationFrame),null!=t.animationBlendBuffer&&t.animationBlendBuffer.length>0))if(t.animationStateMachine.type===e.MotionType.Clip)t.animationRatio=this.computeSpeedRatio(t,t.animationBlendBuffer[0].track,null,1,t.animationStateMachine.speed);else if(t.animationStateMachine.type===e.MotionType.Tree)switch(t.animationStateMachine.blendtree.blendType){case e.BlendTreeType.Direct:this.sortBlendingBuffer(t),null!=t.animationStateMachine.blendtree.directBlendMaster&&(t.animationRatio=this.computeSpeedRatio(t,t.animationStateMachine.blendtree.directBlendMaster.track,null,1,t.animationStateMachine.blendtree.directBlendMaster.timescale)*this.directBlendSpeed);break;case e.BlendTreeType.Simple1D:1===t.animationBlendBuffer.length?t.animationRatio=this.computeSpeedRatio(t,t.animationBlendBuffer[0].track,null,1,t.animationBlendBuffer[0].timescale):(t.animationBlendBuffer[0].weight=1,t.animationBlendBuffer[1].weight=t.animationStateMachine.blendtree.simpleThresholdDelta,t.animationRatio=this.computeSpeedRatio(t,t.animationBlendBuffer[0].track,t.animationBlendBuffer[1].track,t.animationStateMachine.blendtree.simpleThresholdDelta,t.animationBlendBuffer[1].timescale));break;case e.BlendTreeType.SimpleDirectional2D:this.sortBlendingBuffer(t);break;case e.BlendTreeType.FreeformDirectional2D:this.sortBlendingBuffer(t);break;case e.BlendTreeType.FreeformCartesian2D:this.sortBlendingBuffer(t)}},n.prototype.computeSimpleDirectionalWeight=function(e,t,n){var a=0;t.subtract(n).lengthSquared();return a},n.prototype.computeFreeformDirectionalWeight=function(e,t,n){var a=0;t.subtract(n).lengthSquared();return a},n.prototype.computeFreeformCartesianWeight=function(e,t,n){var a=0;t.subtract(n).lengthSquared();return a},n.EXIT="[EXIT]",n.TIMER=3,n}(e.SceneComponent);e.AnimationState=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.Angle=function(t,n){return 57.29578*Math.acos(e.Scalar.Clamp(e.Vector3.Dot(t.normalize(),n.normalize()),-1,1))},t.ClampAngle=function(t,n,a){var r=t;do r<-360&&(r+=360),r>360&&(r-=360);while(r<-360||r>360);return e.Scalar.Clamp(r,n,a)},t.Deg2Rad=function(t){return t*e.Constants.Deg2Rad},t.Rad2Deg=function(t){return t*e.Constants.Rad2Deg},t.Euler=function(t,n,a){return e.Quaternion.RotationYawPitchRoll(n,t,a)},t.EulerToRef=function(t,n,a,r){e.Quaternion.RotationYawPitchRollToRef(n,t,a,r)},t.Matrix=function(t,n,a){return e.Matrix.RotationYawPitchRoll(n,t,a)},t.MatrixToRef=function(t,n,a,r){e.Matrix.RotationYawPitchRollToRef(n,t,a,r)},t.RotateVector=function(t,n){var a=2*(n.y*t.z-n.z*t.y),r=2*(n.z*t.x-n.x*t.z),i=2*(n.x*t.y-n.y*t.x);return new e.Vector3(t.x+n.w*a+(n.y*i-n.z*r),t.y+n.w*r+(n.z*a-n.x*i),t.z+n.w*i+(n.x*r-n.y*a))},t.RotateVectorToRef=function(e,t,n){var a=2*(t.y*e.z-t.z*e.y),r=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*a+(t.y*i-t.z*r),n.y=e.y+t.w*r+(t.z*a-t.x*i),n.z=e.z+t.w*i+(t.x*r-t.y*a)},t.LookRotation=function(t){var n=e.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(t,n){e.Utilities.TempMatrix.reset(),e.Matrix.LookAtLHToRef(e.Utilities.ZeroVector,t,e.Utilities.UpVector,e.Utilities.TempMatrix),e.Utilities.TempMatrix.invert(),e.Quaternion.FromRotationMatrixToRef(e.Utilities.TempMatrix,n)},t.ResetPhysicsPosition=function(t,n){var a=n;a.position&&t.addInPlace(a.position),null!=a.parent&&e.Utilities.ResetPhysicsPosition(t,a.parent)},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.Utilities.PrintElement=document.getElementById("print"),null==e.Utilities.PrintElement){var a=document.createElement("div");a.id="print",a.style.position="absolute",a.style.left="6px",a.style.bottom="3px",a.style.fontSize="12px",a.style.zIndex="10000",a.style.color="#0c0",document.body.appendChild(a),e.Utilities.PrintElement=a}null!=e.Utilities.PrintElement&&e.Utilities.PrintElement.innerHTML!==t&&(e.Utilities.PrintElement.style.color!==n&&(e.Utilities.PrintElement.style.color=n),e.Utilities.PrintElement.innerHTML=t)},t.TransformPosition=function(t,n){return e.Vector3.TransformCoordinates(n,t.getWorldMatrix())},t.TransformPositionToRef=function(t,n,a){return e.Vector3.TransformCoordinatesToRef(n,t.getWorldMatrix(),a)},t.TransformDirection=function(t,n){return e.Vector3.TransformNormal(n,t.getWorldMatrix())},t.TransformDirectionToRef=function(t,n,a){return e.Vector3.TransformNormalToRef(n,t.getWorldMatrix(),a)},t.RecomputePivotPoint=function(t){var n=t.getBoundingInfo().boundingSphere.center;t.setPivotMatrix(e.Matrix.Translation(-n.x,-n.y,-n.z))},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(t){return t.getDirection(e.Vector3.Forward())},t.GetForwardVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Forward(),n)},t.GetRightVector=function(t){return t.getDirection(e.Vector3.Right())},t.GetRightVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Right(),n)},t.GetUpVector=function(t){return t.getDirection(e.Vector3.Up())},t.GetUpVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Up(),n)},t.ParseColor3=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b?new e.Color3(t.r,t.g,t.b):n},t.ParseColor4=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?new e.Color4(t.r,t.g,t.b,t.a):n},t.ParseVector2=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y?new e.Vector2(t.x,t.y):n},t.ParseVector3=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new e.Vector3(t.x,t.y,t.z):n},t.ParseVector4=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new e.Vector4(t.x,t.y,t.z,t.w):n},t.ParseTransform=function(e,t){return void 0===t&&(t=null),null},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.SampleAnimationMatrix=function(t,n,a,r){if(null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_MATRIX){var i=t.getKeys();n<i[0].frame?n=i[0].frame:n>i[i.length-1].frame&&(n=i[i.length-1].frame),e.Utilities.FastMatrixInterpolate(t,n,a,r)}},t.SampleAnimationFloat=function(t,n,a,r,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var l=0;if(null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_FLOAT){var s=t.getKeys();n<s[0].frame?n=s[0].frame:n>s[s.length-1].frame&&(n=s[s.length-1].frame),l=e.Utilities.FastFloatInterpolate(t,n,a,r,i,o)}return l},t.FastMatrixLerp=function(t,n,a,r){e.Matrix.LerpToRef(t,n,a,r)},t.FastMatrixSlerp=function(t,n,a,r){e.Matrix.DecomposeLerpToRef(t,n,a,r)},t.FastMatrixInterpolate=function(t,n,a,r){var i=t.getKeys(),o=Math.max(0,Math.min(i.length-1,Math.floor(i.length*(n-i[0].frame)/(i[i.length-1].frame-i[0].frame))-1));if(i[o].frame>=n)for(;o-1>=0&&i[o].frame>=n;)o--;for(var l=o;l<i.length;l++){var s=i[l+1];if(s.frame>=n){var c=i[l],u=c.value;if(c.interpolation===e.AnimationKeyInterpolation.STEP)return void r.copyFrom(u);var p=s.value,m=(void 0!==c.outTangent&&void 0!==s.inTangent,s.frame-c.frame),d=(n-c.frame)/m,g=t.getEasingFunction();switch(null!=g&&(d=g.ease(d)),a){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return void e.Utilities.FastMatrixSlerp(u,p,d,r);case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return void r.copyFrom(u)}break}}r.copyFrom(i[i.length-1].value)},t.FastFloatInterpolate=function(t,n,a,r,i,o){if(void 0===i&&(i=null),void 0===o&&(o=null),r===e.Animation.ANIMATIONLOOPMODE_CONSTANT&&a>0)return o.clone?o.clone():o;var l=t.getKeys(),s=Math.max(0,Math.min(l.length-1,Math.floor(l.length*(n-l[0].frame)/(l[l.length-1].frame-l[0].frame))-1));if(l[s].frame>=n)for(;s-1>=0&&l[s].frame>=n;)s--;for(var c=s;c<l.length;c++){var u=l[c+1];if(u.frame>=n){var p=l[c],m=p.value;if(p.interpolation===e.AnimationKeyInterpolation.STEP)return m;var d=u.value,g=void 0!==p.outTangent&&void 0!==u.inTangent,h=u.frame-p.frame,y=(n-p.frame)/h,f=t.getEasingFunction();null!=f&&(y=f.ease(y));var S=g?t.floatInterpolateFunctionWithTangents(m,p.outTangent*h,d,u.inTangent*h,y):t.floatInterpolateFunction(m,d,y);switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return S;case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return i*a+S}break}}return l[l.length-1].value},t.ComputeBlendingSpeed=function(e,t){return 1/(e*t)},t.RegisterSceneComponent=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.entity;if(null==i)throw new Error("Null owner scene object attached");if(null==i.metadata||!i.metadata.api){var o={api:!0,type:"Babylon",parsed:!1,prefab:!1,state:{},objectName:"Scene Component",objectId:"0",tagName:"Untagged",layerIndex:0,layerName:"Default",areaIndex:-1,navAgent:null,meshLink:null,meshObstacle:null,shadowCastingMode:0,socketList:[],animationClips:[],animationEvents:[],collisionEvent:null,components:[],properties:{}};i.metadata=o}if(null!=i.metadata&&i.metadata.api){var o=i.metadata;if(null==o.components&&(o.components=[]),null!=o.components){var l={order:1e3,name:"EditorScriptComponent",klass:n,update:a,properties:r,instance:t,tag:{}};o.components.push(l),t.register(),null!=t.ready?t.ready():e.Tools.Error("No component ready function detected.")}else e.Tools.Error("Failed to parse metadata components")}else e.Tools.Error("Null owner object metadata")},t.RegisterSceneManager=function(t){var n=t;return null!=n.manager&&(n.manager.dispose(),n.manager=null),n.manager=new e.SceneManager(t),n.manager},t.ParseSceneMetadata=function(t){var n=t;null!=n.manager?n.manager._parseSceneMetadata():e.Tools.Warn("Babylon.js no scene manager instance detected. Failed to parse scene metadata.")},t.ParseImportMetadata=function(t,n){var a=n;if(null!=a.manager){var r=(a.manager,[]);e.SceneManager.parseSceneMeshes(t,n,r),r.length>0&&(r.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),r.forEach(function(e){e.instance.register()}))}else e.Tools.Warn("Babylon.js no scene manager instance detected. Failed to parse scene metadata.")},t.ExecuteSceneReady=function(t){var n=t;null!=n.manager?n.manager._executeWhenReady():e.Tools.Warn("Babylon.js no scene manager instance detected. Failed to execute scene ready.")},t.UpVector=e.Vector3.Up(),t.ZeroVector=e.Vector3.Zero(),t.TempMatrix=e.Matrix.Zero(),t.TempVector2=e.Vector2.Zero(),t.TempVector3=e.Vector3.Zero(),t.PrintElement=null,t}();e.Utilities=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i.autoInput=!0,i.cameraInput=0,i.cameraSpeed=1,i.cameraMoveSpeed=1,i.cameraRotateSpeed=.005,i.movementKeys=!0,i.multiPlayerView=!1,i.multiPlayerStart=1,i.preventDefaultEvents=!0,i.playerOneCamera=null,i.playerTwoCamera=null,i.playerThreeCamera=null,i.playerFourCamera=null,i}return __extends(n,t),n.prototype.ready=function(){if(this.cameraInput=this.getProperty("cameraInput",0),this.cameraSpeed=this.getProperty("cameraSpeed",1),this.movementKeys=this.getProperty("movementKeys",!0),this.cameraMoveSpeed=this.getProperty("inputMoveSpeed",1),this.cameraRotateSpeed=this.getProperty("inputRotateSpeed",.005),this.preventDefaultEvents=this.getProperty("preventDefaultEvents",!0),this.multiPlayerStart=this.getProperty("multiPlayerStartup",1),this.multiPlayerView=e.SceneManager.IsMultiPlayerView(),this.cameraInput===e.UniversalCameraRig.AUTO_INPUT)this.playerOneCamera=this.manager.getMainCamera(e.PlayerNumber.One),this.multiPlayerView===!0&&(this.playerTwoCamera=this.manager.getMainCamera(e.PlayerNumber.Two),this.playerThreeCamera=this.manager.getMainCamera(e.PlayerNumber.Three),this.playerFourCamera=this.manager.getMainCamera(e.PlayerNumber.Four),this.multiPlayerStart>1&&this.manager.setMultiPlayerViewLayout(this.multiPlayerStart));else if(this.cameraInput===e.UniversalCameraRig.RENDER_CANVAS){var t=this.manager.getMainCamera(e.PlayerNumber.One);if(t.attachControl(this.engine.getRenderingCanvas(),this.preventDefaultEvents),t instanceof e.FreeCamera){var n=t;this.movementKeys===!0&&(n.keysUp.push("w".charCodeAt(0)),n.keysUp.push("W".charCodeAt(0)),n.keysDown.push("s".charCodeAt(0)),n.keysDown.push("S".charCodeAt(0)),n.keysRight.push("d".charCodeAt(0)),n.keysRight.push("D".charCodeAt(0)),n.keysLeft.push("a".charCodeAt(0)),n.keysLeft.push("A".charCodeAt(0)))}}},n.prototype.update=function(){if(this.autoInput===!0&&this.cameraInput===e.UniversalCameraRig.AUTO_INPUT&&(null!=this.playerOneCamera&&this.manager.updateCameraInput(this.playerOneCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.One),this.multiPlayerView===!0)){var t=e.SceneManager.GetMultiPlayerCount();t>=2&&null!=this.playerTwoCamera&&this.manager.updateCameraInput(this.playerTwoCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.Two),t>=3&&null!=this.playerThreeCamera&&this.manager.updateCameraInput(this.playerThreeCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.Three),t>=4&&null!=this.playerFourCamera&&this.manager.updateCameraInput(this.playerFourCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.Four)}},n.prototype.destroy=function(){this.playerOneCamera=null,this.playerTwoCamera=null,this.playerThreeCamera=null,this.playerFourCamera=null},n.AUTO_INPUT=1,n.RENDER_CANVAS=2,n}(e.CameraComponent);e.UniversalCameraRig=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(e){function t(t,n,a,r){return void 0===a&&(a=!0),void 0===r&&(r={}),e.call(this,t,n,a,r)||this}return __extends(t,e),t.prototype.ready=function(){},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(e.MeshComponent);e.ActionManagerComponent=t}(BABYLON||(BABYLON={})),window.terrain=!0,BABYLON.Effect.ShadersStore.splatmapVertexShader=window.atob("I2luY2x1ZGU8X19kZWNsX19kZWZhdWx0VmVydGV4Pg0KLy8gQXR0cmlidXRlcw0KYXR0cmlidXRlIHZlYzMgcG9zaXRpb247DQojaWZkZWYgTk9STUFMDQphdHRyaWJ1dGUgdmVjMyBub3JtYWw7DQojZW5kaWYNCiNpZmRlZiBUQU5HRU5UDQphdHRyaWJ1dGUgdmVjNCB0YW5nZW50Ow0KI2VuZGlmDQojaWZkZWYgVVYxDQphdHRyaWJ1dGUgdmVjMiB1djsNCiNlbmRpZg0KI2lmZGVmIFVWMg0KYXR0cmlidXRlIHZlYzIgdXYyOw0KI2VuZGlmDQojaWZkZWYgVkVSVEVYQ09MT1INCmF0dHJpYnV0ZSB2ZWM0IGNvbG9yOw0KI2VuZGlmDQoNCiNpbmNsdWRlPGJvbmVzRGVjbGFyYXRpb24+DQoNCi8vIFNwbGF0bWFwcw0KI2lmZGVmIHNwbGF0bWFwRGVmDQp2YXJ5aW5nIHZlYzIgc3BsYXRtYXBVVjsNCnVuaWZvcm0gdmVjMiBzcGxhdG1hcEluZm9zOw0KdW5pZm9ybSBtYXQ0IHNwbGF0bWFwTWF0cml4Ow0KI2VuZGlmDQojaWZkZWYgYXRsYXNUZXh0dXJlMURlZg0KdmFyeWluZyB2ZWMyIGF0bGFzVGV4dHVyZTFVVjsNCnVuaWZvcm0gdmVjMiBhdGxhc1RleHR1cmUxSW5mb3M7DQp1bmlmb3JtIG1hdDQgYXRsYXNUZXh0dXJlMU1hdHJpeDsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTJEZWYNCnZhcnlpbmcgdmVjMiBhdGxhc1RleHR1cmUyVVY7DQp1bmlmb3JtIHZlYzIgYXRsYXNUZXh0dXJlMkluZm9zOw0KdW5pZm9ybSBtYXQ0IGF0bGFzVGV4dHVyZTJNYXRyaXg7DQojZW5kaWYNCiNpZmRlZiBhdGxhc1RleHR1cmUzRGVmDQp2YXJ5aW5nIHZlYzIgYXRsYXNUZXh0dXJlM1VWOw0KdW5pZm9ybSB2ZWMyIGF0bGFzVGV4dHVyZTNJbmZvczsNCnVuaWZvcm0gbWF0NCBhdGxhc1RleHR1cmUzTWF0cml4Ow0KI2VuZGlmDQojaWZkZWYgYXRsYXNUZXh0dXJlNERlZg0KdmFyeWluZyB2ZWMyIGF0bGFzVGV4dHVyZTRVVjsNCnVuaWZvcm0gdmVjMiBhdGxhc1RleHR1cmU0SW5mb3M7DQp1bmlmb3JtIG1hdDQgYXRsYXNUZXh0dXJlNE1hdHJpeDsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTVEZWYNCnZhcnlpbmcgdmVjMiBhdGxhc1RleHR1cmU1VVY7DQp1bmlmb3JtIHZlYzIgYXRsYXNUZXh0dXJlNUluZm9zOw0KdW5pZm9ybSBtYXQ0IGF0bGFzVGV4dHVyZTVNYXRyaXg7DQojZW5kaWYNCiNpZmRlZiBidW1wVGV4dHVyZTFEZWYNCnZhcnlpbmcgdmVjMiBidW1wVGV4dHVyZTFVVjsNCnVuaWZvcm0gdmVjMiBidW1wVGV4dHVyZTFJbmZvczsNCnVuaWZvcm0gbWF0NCBidW1wVGV4dHVyZTFNYXRyaXg7DQojZW5kaWYNCiNpZmRlZiBidW1wVGV4dHVyZTJEZWYNCnZhcnlpbmcgdmVjMiBidW1wVGV4dHVyZTJVVjsNCnVuaWZvcm0gdmVjMiBidW1wVGV4dHVyZTJJbmZvczsNCnVuaWZvcm0gbWF0NCBidW1wVGV4dHVyZTJNYXRyaXg7DQojZW5kaWYNCiNpZmRlZiBidW1wVGV4dHVyZTNEZWYNCnZhcnlpbmcgdmVjMiBidW1wVGV4dHVyZTNVVjsNCnVuaWZvcm0gdmVjMiBidW1wVGV4dHVyZTNJbmZvczsNCnVuaWZvcm0gbWF0NCBidW1wVGV4dHVyZTNNYXRyaXg7DQojZW5kaWYNCiNpZmRlZiBidW1wVGV4dHVyZTREZWYNCnZhcnlpbmcgdmVjMiBidW1wVGV4dHVyZTRVVjsNCnVuaWZvcm0gdmVjMiBidW1wVGV4dHVyZTRJbmZvczsNCnVuaWZvcm0gbWF0NCBidW1wVGV4dHVyZTRNYXRyaXg7DQojZW5kaWYNCiNpZmRlZiBidW1wVGV4dHVyZTVEZWYNCnZhcnlpbmcgdmVjMiBidW1wVGV4dHVyZTVVVjsNCnVuaWZvcm0gdmVjMiBidW1wVGV4dHVyZTVJbmZvczsNCnVuaWZvcm0gbWF0NCBidW1wVGV4dHVyZTVNYXRyaXg7DQojZW5kaWYNCg0KLy8gVW5pZm9ybXMNCiNpbmNsdWRlPGluc3RhbmNlc0RlY2xhcmF0aW9uPg0KDQojaWZkZWYgTUFJTlVWMQ0KCXZhcnlpbmcgdmVjMiB2TWFpblVWMTsNCiNlbmRpZg0KDQojaWZkZWYgTUFJTlVWMg0KCXZhcnlpbmcgdmVjMiB2TWFpblVWMjsNCiNlbmRpZg0KDQojaWYgZGVmaW5lZChESUZGVVNFKSAmJiBESUZGVVNFRElSRUNUVVYgPT0gMA0KdmFyeWluZyB2ZWMyIHZEaWZmdXNlVVY7DQojZW5kaWYNCg0KI2lmIGRlZmluZWQoQU1CSUVOVCkgJiYgQU1CSUVOVERJUkVDVFVWID09IDANCnZhcnlpbmcgdmVjMiB2QW1iaWVudFVWOw0KI2VuZGlmDQoNCiNpZiBkZWZpbmVkKE9QQUNJVFkpICYmIE9QQUNJVFlESVJFQ1RVViA9PSAwDQp2YXJ5aW5nIHZlYzIgdk9wYWNpdHlVVjsNCiNlbmRpZg0KDQojaWYgZGVmaW5lZChFTUlTU0lWRSkgJiYgRU1JU1NJVkVESVJFQ1RVViA9PSAwDQp2YXJ5aW5nIHZlYzIgdkVtaXNzaXZlVVY7DQojZW5kaWYNCg0KI2lmIGRlZmluZWQoTElHSFRNQVApICYmIExJR0hUTUFQRElSRUNUVVYgPT0gMA0KdmFyeWluZyB2ZWMyIHZMaWdodG1hcFVWOw0KI2VuZGlmDQoNCiNpZiBkZWZpbmVkKFNQRUNVTEFSKSAmJiBkZWZpbmVkKFNQRUNVTEFSVEVSTSkgJiYgU1BFQ1VMQVJESVJFQ1RVViA9PSAwDQp2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyVVY7DQojZW5kaWYNCg0KI2lmIGRlZmluZWQoQlVNUCkgJiYgQlVNUERJUkVDVFVWID09IDANCnZhcnlpbmcgdmVjMiB2QnVtcFVWOw0KI2VuZGlmDQoNCi8vIE91dHB1dA0KdmFyeWluZyB2ZWMzIHZQb3NpdGlvblc7DQojaWZkZWYgTk9STUFMDQp2YXJ5aW5nIHZlYzMgdk5vcm1hbFc7DQojZW5kaWYNCg0KI2lmZGVmIFZFUlRFWENPTE9SDQp2YXJ5aW5nIHZlYzQgdkNvbG9yOw0KI2VuZGlmDQoNCiNpbmNsdWRlPGJ1bXBWZXJ0ZXhEZWNsYXJhdGlvbj4NCg0KI2luY2x1ZGU8Y2xpcFBsYW5lVmVydGV4RGVjbGFyYXRpb24+DQoNCiNpbmNsdWRlPGZvZ1ZlcnRleERlY2xhcmF0aW9uPg0KI2luY2x1ZGU8X19kZWNsX19saWdodEZyYWdtZW50PlswLi5tYXhTaW11bHRhbmVvdXNMaWdodHNdDQoNCiNpbmNsdWRlPG1vcnBoVGFyZ2V0c1ZlcnRleEdsb2JhbERlY2xhcmF0aW9uPg0KI2luY2x1ZGU8bW9ycGhUYXJnZXRzVmVydGV4RGVjbGFyYXRpb24+WzAuLm1heFNpbXVsdGFuZW91c01vcnBoVGFyZ2V0c10NCg0KI2lmZGVmIFJFRkxFQ1RJT05NQVBfU0tZQk9YDQp2YXJ5aW5nIHZlYzMgdlBvc2l0aW9uVVZXOw0KI2VuZGlmDQoNCiNpZiBkZWZpbmVkKFJFRkxFQ1RJT05NQVBfRVFVSVJFQ1RBTkdVTEFSX0ZJWEVEKSB8fCBkZWZpbmVkKFJFRkxFQ1RJT05NQVBfTUlSUk9SRURFUVVJUkVDVEFOR1VMQVJfRklYRUQpDQp2YXJ5aW5nIHZlYzMgdkRpcmVjdGlvblc7DQojZW5kaWYNCg0KI2luY2x1ZGU8bG9nRGVwdGhEZWNsYXJhdGlvbj4NCg0Kdm9pZCBtYWluKHZvaWQpIHsNCgl2ZWMzIHBvc2l0aW9uVXBkYXRlZCA9IHBvc2l0aW9uOw0KI2lmZGVmIE5PUk1BTAkNCgl2ZWMzIG5vcm1hbFVwZGF0ZWQgPSBub3JtYWw7DQojZW5kaWYNCiNpZmRlZiBUQU5HRU5UDQoJdmVjNCB0YW5nZW50VXBkYXRlZCA9IHRhbmdlbnQ7DQojZW5kaWYNCg0KI2luY2x1ZGU8bW9ycGhUYXJnZXRzVmVydGV4PlswLi5tYXhTaW11bHRhbmVvdXNNb3JwaFRhcmdldHNdDQoNCiNpZmRlZiBSRUZMRUNUSU9OTUFQX1NLWUJPWA0KCXZQb3NpdGlvblVWVyA9IHBvc2l0aW9uVXBkYXRlZDsNCiNlbmRpZiANCg0KI2luY2x1ZGU8aW5zdGFuY2VzVmVydGV4Pg0KI2luY2x1ZGU8Ym9uZXNWZXJ0ZXg+DQoNCglnbF9Qb3NpdGlvbiA9IHZpZXdQcm9qZWN0aW9uICogZmluYWxXb3JsZCAqIHZlYzQocG9zaXRpb25VcGRhdGVkLCAxLjApOw0KDQoJdmVjNCB3b3JsZFBvcyA9IGZpbmFsV29ybGQgKiB2ZWM0KHBvc2l0aW9uVXBkYXRlZCwgMS4wKTsNCgl2UG9zaXRpb25XID0gdmVjMyh3b3JsZFBvcyk7DQoNCiNpZmRlZiBOT1JNQUwNCgl2Tm9ybWFsVyA9IG5vcm1hbGl6ZSh2ZWMzKGZpbmFsV29ybGQgKiB2ZWM0KG5vcm1hbFVwZGF0ZWQsIDAuMCkpKTsNCiNlbmRpZg0KDQojaWYgZGVmaW5lZChSRUZMRUNUSU9OTUFQX0VRVUlSRUNUQU5HVUxBUl9GSVhFRCkgfHwgZGVmaW5lZChSRUZMRUNUSU9OTUFQX01JUlJPUkVERVFVSVJFQ1RBTkdVTEFSX0ZJWEVEKQ0KCXZEaXJlY3Rpb25XID0gbm9ybWFsaXplKHZlYzMoZmluYWxXb3JsZCAqIHZlYzQocG9zaXRpb25VcGRhdGVkLCAwLjApKSk7DQojZW5kaWYNCg0KCS8vIFVWIGNvb3JkaW5hdGVzDQojaWZuZGVmIFVWMQ0KCXZlYzIgdXYgPSB2ZWMyKDAuLCAwLik7DQojZW5kaWYNCiNpZm5kZWYgVVYyDQoJdmVjMiB1djIgPSB2ZWMyKDAuLCAwLik7DQojZW5kaWYNCg0KCS8vIE1haW4gY29vcmRpbmF0ZXMNCiNpZmRlZiBNQUlOVVYxDQoJdk1haW5VVjEgPSB1djsNCiNlbmRpZg0KDQojaWZkZWYgTUFJTlVWMg0KCXZNYWluVVYyID0gdXYyOw0KI2VuZGlmDQoNCgkvLyBTcGxhdG1hcCBjb29yZGluYXRlcw0KI2lmZGVmIHNwbGF0bWFwRGVmDQoJaWYgKHNwbGF0bWFwSW5mb3MueCA9PSAwLikNCgl7DQoJCXNwbGF0bWFwVVYgPSB2ZWMyKHNwbGF0bWFwTWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJc3BsYXRtYXBVViA9IHZlYzIoc3BsYXRtYXBNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KI2lmZGVmIGF0bGFzVGV4dHVyZTFEZWYNCglpZiAoYXRsYXNUZXh0dXJlMUluZm9zLnggPT0gMC4pDQoJew0KCQlhdGxhc1RleHR1cmUxVVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTFNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQlhdGxhc1RleHR1cmUxVVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTFNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KI2lmZGVmIGF0bGFzVGV4dHVyZTJEZWYNCglpZiAoYXRsYXNUZXh0dXJlMkluZm9zLnggPT0gMC4pDQoJew0KCQlhdGxhc1RleHR1cmUyVVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTJNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQlhdGxhc1RleHR1cmUyVVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTJNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KI2lmZGVmIGF0bGFzVGV4dHVyZTNEZWYNCglpZiAoYXRsYXNUZXh0dXJlM0luZm9zLnggPT0gMC4pDQoJew0KCQlhdGxhc1RleHR1cmUzVVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTNNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQlhdGxhc1RleHR1cmUzVVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTNNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KI2lmZGVmIGF0bGFzVGV4dHVyZTREZWYNCglpZiAoYXRsYXNUZXh0dXJlNEluZm9zLnggPT0gMC4pDQoJew0KCQlhdGxhc1RleHR1cmU0VVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTRNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQlhdGxhc1RleHR1cmU0VVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTRNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KI2lmZGVmIGF0bGFzVGV4dHVyZTVEZWYNCglpZiAoYXRsYXNUZXh0dXJlNUluZm9zLnggPT0gMC4pDQoJew0KCQlhdGxhc1RleHR1cmU1VVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTVNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQlhdGxhc1RleHR1cmU1VVYgPSB2ZWMyKGF0bGFzVGV4dHVyZTVNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KCS8vIFRleHR1cmUgY29vcmRpbmF0ZXMNCiNpZiBkZWZpbmVkKERJRkZVU0UpICYmIERJRkZVU0VESVJFQ1RVViA9PSAwDQoJaWYgKHZEaWZmdXNlSW5mb3MueCA9PSAwLikNCgl7DQoJCXZEaWZmdXNlVVYgPSB2ZWMyKGRpZmZ1c2VNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQl2RGlmZnVzZVVWID0gdmVjMihkaWZmdXNlTWF0cml4ICogdmVjNCh1djIsIDEuMCwgMC4wKSk7DQoJfQ0KI2VuZGlmDQoNCiNpZiBkZWZpbmVkKEFNQklFTlQpICYmIEFNQklFTlRESVJFQ1RVViA9PSAwDQoJaWYgKHZBbWJpZW50SW5mb3MueCA9PSAwLikNCgl7DQoJCXZBbWJpZW50VVYgPSB2ZWMyKGFtYmllbnRNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQl2QW1iaWVudFVWID0gdmVjMihhbWJpZW50TWF0cml4ICogdmVjNCh1djIsIDEuMCwgMC4wKSk7DQoJfQ0KI2VuZGlmDQoNCiNpZiBkZWZpbmVkKE9QQUNJVFkpICYmIE9QQUNJVFlESVJFQ1RVViA9PSAwDQoJaWYgKHZPcGFjaXR5SW5mb3MueCA9PSAwLikNCgl7DQoJCXZPcGFjaXR5VVYgPSB2ZWMyKG9wYWNpdHlNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQl2T3BhY2l0eVVWID0gdmVjMihvcGFjaXR5TWF0cml4ICogdmVjNCh1djIsIDEuMCwgMC4wKSk7DQoJfQ0KI2VuZGlmDQoNCiNpZiBkZWZpbmVkKEVNSVNTSVZFKSAmJiBFTUlTU0lWRURJUkVDVFVWID09IDANCglpZiAodkVtaXNzaXZlSW5mb3MueCA9PSAwLikNCgl7DQoJCXZFbWlzc2l2ZVVWID0gdmVjMihlbWlzc2l2ZU1hdHJpeCAqIHZlYzQodXYsIDEuMCwgMC4wKSk7DQoJfQ0KCWVsc2UNCgl7DQoJCXZFbWlzc2l2ZVVWID0gdmVjMihlbWlzc2l2ZU1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWYgZGVmaW5lZChMSUdIVE1BUCkgJiYgTElHSFRNQVBESVJFQ1RVViA9PSAwDQoJaWYgKHZMaWdodG1hcEluZm9zLnggPT0gMC4pDQoJew0KCQl2TGlnaHRtYXBVViA9IHZlYzIobGlnaHRtYXBNYXRyaXggKiB2ZWM0KHV2LCAxLjAsIDAuMCkpOw0KCX0NCgllbHNlDQoJew0KCQl2TGlnaHRtYXBVViA9IHZlYzIobGlnaHRtYXBNYXRyaXggKiB2ZWM0KHV2MiwgMS4wLCAwLjApKTsNCgl9DQojZW5kaWYNCg0KI2lmIGRlZmluZWQoU1BFQ1VMQVIpICYmIGRlZmluZWQoU1BFQ1VMQVJURVJNKSAmJiBTUEVDVUxBUkRJUkVDVFVWID09IDANCglpZiAodlNwZWN1bGFySW5mb3MueCA9PSAwLikNCgl7DQoJCXZTcGVjdWxhclVWID0gdmVjMihzcGVjdWxhck1hdHJpeCAqIHZlYzQodXYsIDEuMCwgMC4wKSk7DQoJfQ0KCWVsc2UNCgl7DQoJCXZTcGVjdWxhclVWID0gdmVjMihzcGVjdWxhck1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWYgZGVmaW5lZChCVU1QKSAmJiBCVU1QRElSRUNUVVYgPT0gMA0KCWlmICh2QnVtcEluZm9zLnggPT0gMC4pDQoJew0KCQl2QnVtcFVWID0gdmVjMihidW1wTWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJdkJ1bXBVViA9IHZlYzIoYnVtcE1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWZkZWYgYnVtcFRleHR1cmUxRGVmDQoJaWYgKGJ1bXBUZXh0dXJlMUluZm9zLnggPT0gMC4pDQoJew0KCQlidW1wVGV4dHVyZTFVViA9IHZlYzIoYnVtcFRleHR1cmUxTWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJYnVtcFRleHR1cmUxVVYgPSB2ZWMyKGJ1bXBUZXh0dXJlMU1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWZkZWYgYnVtcFRleHR1cmUyRGVmDQoJaWYgKGJ1bXBUZXh0dXJlMkluZm9zLnggPT0gMC4pDQoJew0KCQlidW1wVGV4dHVyZTJVViA9IHZlYzIoYnVtcFRleHR1cmUyTWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJYnVtcFRleHR1cmUyVVYgPSB2ZWMyKGJ1bXBUZXh0dXJlMk1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWZkZWYgYnVtcFRleHR1cmUzRGVmDQoJaWYgKGJ1bXBUZXh0dXJlM0luZm9zLnggPT0gMC4pDQoJew0KCQlidW1wVGV4dHVyZTNVViA9IHZlYzIoYnVtcFRleHR1cmUzTWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJYnVtcFRleHR1cmUzVVYgPSB2ZWMyKGJ1bXBUZXh0dXJlM01hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWZkZWYgYnVtcFRleHR1cmU0RGVmDQoJaWYgKGJ1bXBUZXh0dXJlNEluZm9zLnggPT0gMC4pDQoJew0KCQlidW1wVGV4dHVyZTRVViA9IHZlYzIoYnVtcFRleHR1cmU0TWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJYnVtcFRleHR1cmU0VVYgPSB2ZWMyKGJ1bXBUZXh0dXJlNE1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaWZkZWYgYnVtcFRleHR1cmU1RGVmDQoJaWYgKGJ1bXBUZXh0dXJlNUluZm9zLnggPT0gMC4pDQoJew0KCQlidW1wVGV4dHVyZTVVViA9IHZlYzIoYnVtcFRleHR1cmU1TWF0cml4ICogdmVjNCh1diwgMS4wLCAwLjApKTsNCgl9DQoJZWxzZQ0KCXsNCgkJYnVtcFRleHR1cmU1VVYgPSB2ZWMyKGJ1bXBUZXh0dXJlNU1hdHJpeCAqIHZlYzQodXYyLCAxLjAsIDAuMCkpOw0KCX0NCiNlbmRpZg0KDQojaW5jbHVkZTxidW1wVmVydGV4Pg0KI2luY2x1ZGU8Y2xpcFBsYW5lVmVydGV4Pg0KI2luY2x1ZGU8Zm9nVmVydGV4Pg0KI2luY2x1ZGU8c2hhZG93c1ZlcnRleD5bMC4ubWF4U2ltdWx0YW5lb3VzTGlnaHRzXQ0KDQojaWZkZWYgVkVSVEVYQ09MT1INCgkvLyBWZXJ0ZXggY29sb3INCgl2Q29sb3IgPSBjb2xvcjsNCiNlbmRpZg0KDQojaW5jbHVkZTxwb2ludENsb3VkVmVydGV4Pg0KI2luY2x1ZGU8bG9nRGVwdGhWZXJ0ZXg+DQoNCn0="),BABYLON.Effect.ShadersStore.splatmapPixelShader=window.atob("I2luY2x1ZGU8X19kZWNsX19kZWZhdWx0RnJhZ21lbnQ+DQoNCiNpZiBkZWZpbmVkKEJVTVApIHx8ICFkZWZpbmVkKE5PUk1BTCkNCiNleHRlbnNpb24gR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzIDogZW5hYmxlDQojZW5kaWYNCg0KI2lmZGVmIExPR0FSSVRITUlDREVQVEgNCiNleHRlbnNpb24gR0xfRVhUX2ZyYWdfZGVwdGggOiBlbmFibGUNCiNlbmRpZg0KDQovLyBDb25zdGFudHMNCiNkZWZpbmUgUkVDSVBST0NBTF9QSTIgMC4xNTkxNTQ5NA0KDQp1bmlmb3JtIHZlYzMgdkV5ZVBvc2l0aW9uOw0KdW5pZm9ybSB2ZWMzIHZBbWJpZW50Q29sb3I7DQoNCi8vIElucHV0DQp2YXJ5aW5nIHZlYzMgdlBvc2l0aW9uVzsNCg0KI2lmZGVmIE5PUk1BTA0KdmFyeWluZyB2ZWMzIHZOb3JtYWxXOw0KI2VuZGlmDQoNCiNpZmRlZiBWRVJURVhDT0xPUg0KdmFyeWluZyB2ZWM0IHZDb2xvcjsNCiNlbmRpZg0KDQojaWZkZWYgTUFJTlVWMQ0KCXZhcnlpbmcgdmVjMiB2TWFpblVWMTsNCiNlbmRpZg0KDQojaWZkZWYgTUFJTlVWMg0KCXZhcnlpbmcgdmVjMiB2TWFpblVWMjsNCiNlbmRpZg0KDQovLyBIZWxwZXIgZnVuY3Rpb25zDQojaW5jbHVkZTxoZWxwZXJGdW5jdGlvbnM+DQoNCi8vIExpZ2h0cw0KI2luY2x1ZGU8X19kZWNsX19saWdodEZyYWdtZW50PlswLi5tYXhTaW11bHRhbmVvdXNMaWdodHNdDQoNCiNpbmNsdWRlPGxpZ2h0c0ZyYWdtZW50RnVuY3Rpb25zPg0KI2luY2x1ZGU8c2hhZG93c0ZyYWdtZW50RnVuY3Rpb25zPg0KDQovLyBTcGxhdG1hcHMNCiNpZmRlZiBzcGxhdG1hcERlZg0KdW5pZm9ybSBzYW1wbGVyMkQgc3BsYXRtYXA7DQp2YXJ5aW5nIHZlYzIgc3BsYXRtYXBVVjsNCnVuaWZvcm0gdmVjMiBzcGxhdG1hcEluZm9zOw0KdW5pZm9ybSBmbG9hdCBzcGxhdG1hcFJlY3RzOw0KdW5pZm9ybSB2ZWM0IHNwbGF0bWFwUmVjdDE7DQp1bmlmb3JtIHZlYzQgc3BsYXRtYXBSZWN0MjsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTFEZWYNCnVuaWZvcm0gc2FtcGxlcjJEIGF0bGFzVGV4dHVyZTE7DQp2YXJ5aW5nIHZlYzIgYXRsYXNUZXh0dXJlMVVWOw0KdW5pZm9ybSB2ZWMyIGF0bGFzVGV4dHVyZTFJbmZvczsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTJEZWYNCnVuaWZvcm0gc2FtcGxlcjJEIGF0bGFzVGV4dHVyZTI7DQp2YXJ5aW5nIHZlYzIgYXRsYXNUZXh0dXJlMlVWOw0KdW5pZm9ybSB2ZWMyIGF0bGFzVGV4dHVyZTJJbmZvczsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTNEZWYNCnVuaWZvcm0gc2FtcGxlcjJEIGF0bGFzVGV4dHVyZTM7DQp2YXJ5aW5nIHZlYzIgYXRsYXNUZXh0dXJlM1VWOw0KdW5pZm9ybSB2ZWMyIGF0bGFzVGV4dHVyZTNJbmZvczsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTREZWYNCnVuaWZvcm0gc2FtcGxlcjJEIGF0bGFzVGV4dHVyZTQ7DQp2YXJ5aW5nIHZlYzIgYXRsYXNUZXh0dXJlNFVWOw0KdW5pZm9ybSB2ZWMyIGF0bGFzVGV4dHVyZTRJbmZvczsNCiNlbmRpZg0KI2lmZGVmIGF0bGFzVGV4dHVyZTVEZWYNCnVuaWZvcm0gc2FtcGxlcjJEIGF0bGFzVGV4dHVyZTU7DQp2YXJ5aW5nIHZlYzIgYXRsYXNUZXh0dXJlNVVWOw0KdW5pZm9ybSB2ZWMyIGF0bGFzVGV4dHVyZTVJbmZvczsNCiNlbmRpZg0KI2lmZGVmIGJ1bXBUZXh0dXJlMURlZg0KdW5pZm9ybSBzYW1wbGVyMkQgYnVtcFRleHR1cmUxOw0KdmFyeWluZyB2ZWMyIGJ1bXBUZXh0dXJlMVVWOw0KdW5pZm9ybSB2ZWMyIGJ1bXBUZXh0dXJlMUluZm9zOw0KI2VuZGlmDQojaWZkZWYgYnVtcFRleHR1cmUyRGVmDQp1bmlmb3JtIHNhbXBsZXIyRCBidW1wVGV4dHVyZTI7DQp2YXJ5aW5nIHZlYzIgYnVtcFRleHR1cmUyVVY7DQp1bmlmb3JtIHZlYzIgYnVtcFRleHR1cmUySW5mb3M7DQojZW5kaWYNCiNpZmRlZiBidW1wVGV4dHVyZTNEZWYNCnVuaWZvcm0gc2FtcGxlcjJEIGJ1bXBUZXh0dXJlMzsNCnZhcnlpbmcgdmVjMiBidW1wVGV4dHVyZTNVVjsNCnVuaWZvcm0gdmVjMiBidW1wVGV4dHVyZTNJbmZvczsNCiNlbmRpZg0KI2lmZGVmIGJ1bXBUZXh0dXJlNERlZg0KdW5pZm9ybSBzYW1wbGVyMkQgYnVtcFRleHR1cmU0Ow0KdmFyeWluZyB2ZWMyIGJ1bXBUZXh0dXJlNFVWOw0KdW5pZm9ybSB2ZWMyIGJ1bXBUZXh0dXJlNEluZm9zOw0KI2VuZGlmDQojaWZkZWYgYnVtcFRleHR1cmU1RGVmDQp1bmlmb3JtIHNhbXBsZXIyRCBidW1wVGV4dHVyZTU7DQp2YXJ5aW5nIHZlYzIgYnVtcFRleHR1cmU1VVY7DQp1bmlmb3JtIHZlYzIgYnVtcFRleHR1cmU1SW5mb3M7DQojZW5kaWYNCg0KLy8gU2FtcGxlcnMNCiNpZmRlZiBESUZGVVNFDQoJI2lmIERJRkZVU0VESVJFQ1RVViA9PSAxDQoJCSNkZWZpbmUgdkRpZmZ1c2VVViB2TWFpblVWMQ0KCSNlbGlmIERJRkZVU0VESVJFQ1RVViA9PSAyDQoJCSNkZWZpbmUgdkRpZmZ1c2VVViB2TWFpblVWMg0KCSNlbHNlDQoJCXZhcnlpbmcgdmVjMiB2RGlmZnVzZVVWOw0KCSNlbmRpZg0KCXVuaWZvcm0gc2FtcGxlcjJEIGRpZmZ1c2VTYW1wbGVyOw0KI2VuZGlmDQoNCiNpZmRlZiBBTUJJRU5UDQoJI2lmIEFNQklFTlRESVJFQ1RVViA9PSAxDQoJCSNkZWZpbmUgdkFtYmllbnRVViB2TWFpblVWMQ0KCSNlbGlmIEFNQklFTlRESVJFQ1RVViA9PSAyDQoJCSNkZWZpbmUgdkFtYmllbnRVViB2TWFpblVWMg0KCSNlbHNlDQoJCXZhcnlpbmcgdmVjMiB2QW1iaWVudFVWOw0KCSNlbmRpZg0KCXVuaWZvcm0gc2FtcGxlcjJEIGFtYmllbnRTYW1wbGVyOw0KI2VuZGlmDQoNCiNpZmRlZiBPUEFDSVRZCQ0KCSNpZiBPUEFDSVRZRElSRUNUVVYgPT0gMQ0KCQkjZGVmaW5lIHZPcGFjaXR5VVYgdk1haW5VVjENCgkjZWxpZiBPUEFDSVRZRElSRUNUVVYgPT0gMg0KCQkjZGVmaW5lIHZPcGFjaXR5VVYgdk1haW5VVjINCgkjZWxzZQ0KCQl2YXJ5aW5nIHZlYzIgdk9wYWNpdHlVVjsNCgkjZW5kaWYNCgl1bmlmb3JtIHNhbXBsZXIyRCBvcGFjaXR5U2FtcGxlcjsNCiNlbmRpZg0KDQojaWZkZWYgRU1JU1NJVkUNCgkjaWYgRU1JU1NJVkVESVJFQ1RVViA9PSAxDQoJCSNkZWZpbmUgdkVtaXNzaXZlVVYgdk1haW5VVjENCgkjZWxpZiBFTUlTU0lWRURJUkVDVFVWID09IDINCgkJI2RlZmluZSB2RW1pc3NpdmVVViB2TWFpblVWMg0KCSNlbHNlDQoJCXZhcnlpbmcgdmVjMiB2RW1pc3NpdmVVVjsNCgkjZW5kaWYNCgl1bmlmb3JtIHNhbXBsZXIyRCBlbWlzc2l2ZVNhbXBsZXI7DQojZW5kaWYNCg0KI2lmZGVmIExJR0hUTUFQDQoJI2lmIExJR0hUTUFQRElSRUNUVVYgPT0gMQ0KCQkjZGVmaW5lIHZMaWdodG1hcFVWIHZNYWluVVYxDQoJI2VsaWYgTElHSFRNQVBESVJFQ1RVViA9PSAyDQoJCSNkZWZpbmUgdkxpZ2h0bWFwVVYgdk1haW5VVjINCgkjZWxzZQ0KCQl2YXJ5aW5nIHZlYzIgdkxpZ2h0bWFwVVY7DQoJI2VuZGlmDQoJdW5pZm9ybSBzYW1wbGVyMkQgbGlnaHRtYXBTYW1wbGVyOw0KI2VuZGlmDQoNCiNpZmRlZiBSRUZSQUNUSU9ODQoNCiNpZmRlZiBSRUZSQUNUSU9OTUFQXzNEDQp1bmlmb3JtIHNhbXBsZXJDdWJlIHJlZnJhY3Rpb25DdWJlU2FtcGxlcjsNCiNlbHNlDQp1bmlmb3JtIHNhbXBsZXIyRCByZWZyYWN0aW9uMkRTYW1wbGVyOw0KI2VuZGlmDQoNCiNlbmRpZg0KDQojaWYgZGVmaW5lZChTUEVDVUxBUikgJiYgZGVmaW5lZChTUEVDVUxBUlRFUk0pDQoJI2lmIFNQRUNVTEFSRElSRUNUVVYgPT0gMQ0KCQkjZGVmaW5lIHZTcGVjdWxhclVWIHZNYWluVVYxDQoJI2VsaWYgU1BFQ1VMQVJESVJFQ1RVViA9PSAyDQoJCSNkZWZpbmUgdlNwZWN1bGFyVVYgdk1haW5VVjINCgkjZWxzZQ0KCQl2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyVVY7DQoJI2VuZGlmDQoJdW5pZm9ybSBzYW1wbGVyMkQgc3BlY3VsYXJTYW1wbGVyOw0KI2VuZGlmDQoNCi8vIEZyZXNuZWwNCiNpbmNsdWRlPGZyZXNuZWxGdW5jdGlvbj4NCg0KLy8gUmVmbGVjdGlvbg0KI2lmZGVmIFJFRkxFQ1RJT04NCiNpZmRlZiBSRUZMRUNUSU9OTUFQXzNEDQp1bmlmb3JtIHNhbXBsZXJDdWJlIHJlZmxlY3Rpb25DdWJlU2FtcGxlcjsNCiNlbHNlDQp1bmlmb3JtIHNhbXBsZXIyRCByZWZsZWN0aW9uMkRTYW1wbGVyOw0KI2VuZGlmDQoNCiNpZmRlZiBSRUZMRUNUSU9OTUFQX1NLWUJPWA0KdmFyeWluZyB2ZWMzIHZQb3NpdGlvblVWVzsNCiNlbHNlDQojaWYgZGVmaW5lZChSRUZMRUNUSU9OTUFQX0VRVUlSRUNUQU5HVUxBUl9GSVhFRCkgfHwgZGVmaW5lZChSRUZMRUNUSU9OTUFQX01JUlJPUkVERVFVSVJFQ1RBTkdVTEFSX0ZJWEVEKQ0KdmFyeWluZyB2ZWMzIHZEaXJlY3Rpb25XOw0KI2VuZGlmDQoNCiNlbmRpZg0KDQojaW5jbHVkZTxyZWZsZWN0aW9uRnVuY3Rpb24+DQoNCiNlbmRpZg0KDQojaW5jbHVkZTxpbWFnZVByb2Nlc3NpbmdEZWNsYXJhdGlvbj4NCg0KI2luY2x1ZGU8aW1hZ2VQcm9jZXNzaW5nRnVuY3Rpb25zPg0KDQojaW5jbHVkZTxidW1wRnJhZ21lbnRGdW5jdGlvbnM+DQojaW5jbHVkZTxjbGlwUGxhbmVGcmFnbWVudERlY2xhcmF0aW9uPg0KI2luY2x1ZGU8bG9nRGVwdGhEZWNsYXJhdGlvbj4NCiNpbmNsdWRlPGZvZ0ZyYWdtZW50RGVjbGFyYXRpb24+DQoNCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQovLyBUZXh0dXJlIEF0bGFzIFN1cHBvcnQNCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQp2ZWM0IHRleHR1cmVGcmFjdDJEKHNhbXBsZXIyRCBhdGxhcywgdmVjNCByZWN0LCB2ZWMyIHNpemUsIHZlYzIgc2NhbGUsIHZlYzIgdXYsIHZlYzIgb2Zmc2V0KSB7DQoJdmVjMiBmcmFjdFVWID0gZnJhY3QodXYgKiBzY2FsZSk7DQoJdmVjMiBhdGxhc1VWID0gdmVjMigoZnJhY3RVVi54ICogcmVjdC53KSArIHJlY3QueCwgKGZyYWN0VVYueSAqIHJlY3QueikgKyByZWN0LnkpOw0KCXZlYzIgdGlsZWRVViA9IGF0bGFzVVYgKyBvZmZzZXQ7DQoJcmV0dXJuIHRleHR1cmUyRChhdGxhcywgdGlsZWRVVik7DQp9DQp2ZWM0IHRleHR1cmVBdGxhczJEKHNhbXBsZXIyRCBhdGxhcywgdmVjNCByZWN0LCB2ZWMyIHV2LCB2ZWMyIG9mZnNldCkgew0KCXZlYzIgYXRsYXNVViA9IHZlYzIoKHV2LnggKiByZWN0LncpICsgcmVjdC54LCAodXYueSAqIHJlY3QueikgKyByZWN0LnkpOw0KCXZlYzIgdGlsZWRVViA9IGF0bGFzVVYgKyBvZmZzZXQ7DQoJcmV0dXJuIHRleHR1cmUyRChhdGxhcywgdGlsZWRVVik7DQp9DQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQp2b2lkIG1haW4odm9pZCkgew0KI2luY2x1ZGU8Y2xpcFBsYW5lRnJhZ21lbnQ+DQoJdmVjMyB2aWV3RGlyZWN0aW9uVyA9IG5vcm1hbGl6ZSh2RXllUG9zaXRpb24gLSB2UG9zaXRpb25XKTsNCg0KCS8vIEJhc2UgY29sb3INCgl2ZWM0IGJhc2VDb2xvciA9IHZlYzQoMS4wLCAxLjAsIDEuMCwgMS4wKTsNCgl2ZWMzIGRpZmZ1c2VDb2xvciA9IHZEaWZmdXNlQ29sb3IucmdiOw0KDQoJLy8gQWxwaGENCglmbG9hdCBhbHBoYSA9IHZEaWZmdXNlQ29sb3IuYTsNCg0KCS8vIEJ1bXANCgkjaWZkZWYgTk9STUFMDQoJCXZlYzMgbm9ybWFsVyA9IG5vcm1hbGl6ZSh2Tm9ybWFsVyk7DQoJI2Vsc2UNCgkJdmVjMyBub3JtYWxXID0gbm9ybWFsaXplKC1jcm9zcyhkRmR4KHZQb3NpdGlvblcpLCBkRmR5KHZQb3NpdGlvblcpKSk7DQoJI2VuZGlmDQoNCiNpZmRlZiBzcGxhdG1hcERlZg0KCXZlYzIgdXZPZmZzZXQgPSB2ZWMyKDAuMCwgMC4wKTsNCgkjaWYgZGVmaW5lZChCVU1QKSB8fCBkZWZpbmVkKFBBUkFMTEFYKQ0KCQkjaWZkZWYgTk9STUFMWFlTQ0FMRQ0KCQkJZmxvYXQgbm9ybWFsU2NhbGUgPSAxLjA7DQoJCSNlbHNlCQkNCgkJCWZsb2F0IG5vcm1hbFNjYWxlID0gdkJ1bXBJbmZvcy55Ow0KCQkjZW5kaWYNCg0KCQkjaWYgZGVmaW5lZChUQU5HRU5UKSAmJiBkZWZpbmVkKE5PUk1BTCkNCgkJCW1hdDMgVEJOID0gdlRCTjsNCgkJI2Vsc2UNCgkJCW1hdDMgVEJOID0gY290YW5nZW50X2ZyYW1lKG5vcm1hbFcgKiBub3JtYWxTY2FsZSwgdlBvc2l0aW9uVywgdkJ1bXBVVik7DQoJCSNlbmRpZg0KCSNlbmRpZg0KDQoJI2lmZGVmIFBBUkFMTEFYDQoJCW1hdDMgaW52VEJOID0gdHJhbnNwb3NlTWF0MyhUQk4pOw0KDQoJCSNpZmRlZiBQQVJBTExBWE9DQ0xVU0lPTg0KCQkJdXZPZmZzZXQgPSBwYXJhbGxheE9jY2x1c2lvbihpbnZUQk4gKiAtdmlld0RpcmVjdGlvblcsIGludlRCTiAqIG5vcm1hbFcsIHZCdW1wVVYsIHZCdW1wSW5mb3Mueik7DQoJCSNlbHNlDQoJCQl1dk9mZnNldCA9IHBhcmFsbGF4T2Zmc2V0KGludlRCTiAqIHZpZXdEaXJlY3Rpb25XLCB2QnVtcEluZm9zLnopOw0KCQkjZW5kaWYNCgkjZW5kaWYNCiNlbHNlDQoJI2luY2x1ZGU8YnVtcEZyYWdtZW50Pg0KCSNpZmRlZiBUV09TSURFRExJR0hUSU5HDQoJCW5vcm1hbFcgPSBnbF9Gcm9udEZhY2luZyA/IG5vcm1hbFcgOiAtbm9ybWFsVzsNCgkjZW5kaWYNCiNlbmRpZg0KDQojaWZkZWYgRElGRlVTRQ0KCS8vIFNwbGF0bWFwcw0KCSNpZiBkZWZpbmVkKFNQTEFUTUFQU19FTkFCTEVEKSAmJiBkZWZpbmVkKHNwbGF0bWFwRGVmKQ0KCQl2ZWM0IGJhc2VDb2xvcjEgPSB2ZWM0KDAuMCwgMC4wLCAwLjAsIDAuMCk7DQoJCXZlYzQgYmFzZUNvbG9yMiA9IHZlYzQoMC4wLCAwLjAsIDAuMCwgMC4wKTsNCgkJLy8gQmFzZSBzcGxhdCBjb2xvcnMNCgkJaWYgKHNwbGF0bWFwUmVjdHMgPiAwLjApIHsNCgkJCWJhc2VDb2xvcjEgPSB0ZXh0dXJlQXRsYXMyRChzcGxhdG1hcCwgc3BsYXRtYXBSZWN0MSwgc3BsYXRtYXBVViwgdXZPZmZzZXQpOw0KCQl9DQoJCWlmIChzcGxhdG1hcFJlY3RzID4gMS4wKSB7DQoJCQliYXNlQ29sb3IyID0gdGV4dHVyZUF0bGFzMkQoc3BsYXRtYXAsIHNwbGF0bWFwUmVjdDIsIHNwbGF0bWFwVVYsIHV2T2Zmc2V0KTsNCgkJfQ0KCQkvLyBQcmltYXJ5IHNwbGF0IGNvbG9ycw0KCQliYXNlQ29sb3IgPSB0ZXh0dXJlMkQoZGlmZnVzZVNhbXBsZXIsIHZEaWZmdXNlVVYgKyB1dk9mZnNldCkgKiBiYXNlQ29sb3IxLnI7DQoJCSNpZmRlZiBhdGxhc1RleHR1cmUxRGVmDQoJCQliYXNlQ29sb3IgKz0gdGV4dHVyZTJEKGF0bGFzVGV4dHVyZTEsIGF0bGFzVGV4dHVyZTFVViArIHV2T2Zmc2V0KSAqIGJhc2VDb2xvcjEuZzsNCgkJI2VuZGlmDQoJCSNpZmRlZiBhdGxhc1RleHR1cmUyRGVmDQoJCQliYXNlQ29sb3IgKz0gdGV4dHVyZTJEKGF0bGFzVGV4dHVyZTIsIGF0bGFzVGV4dHVyZTJVViArIHV2T2Zmc2V0KSAqIGJhc2VDb2xvcjEuYjsNCgkJI2VuZGlmDQoJCS8vIFNlY29uZCBzcGxhdCBjb2xvcnMNCgkJI2lmZGVmIGF0bGFzVGV4dHVyZTNEZWYNCgkJCWJhc2VDb2xvciArPSB0ZXh0dXJlMkQoYXRsYXNUZXh0dXJlMywgYXRsYXNUZXh0dXJlM1VWICsgdXZPZmZzZXQpICogYmFzZUNvbG9yMi5yOw0KCQkjZW5kaWYNCgkJI2lmZGVmIGF0bGFzVGV4dHVyZTREZWYNCgkJCWJhc2VDb2xvciArPSB0ZXh0dXJlMkQoYXRsYXNUZXh0dXJlNCwgYXRsYXNUZXh0dXJlNFVWICsgdXZPZmZzZXQpICogYmFzZUNvbG9yMi5nOw0KCQkjZW5kaWYNCgkJI2lmZGVmIGF0bGFzVGV4dHVyZTVEZWYNCgkJCWJhc2VDb2xvciArPSB0ZXh0dXJlMkQoYXRsYXNUZXh0dXJlNSwgYXRsYXNUZXh0dXJlNVVWICsgdXZPZmZzZXQpICogYmFzZUNvbG9yMi5iOw0KCQkjZW5kaWYNCgkjZWxzZQ0KCQliYXNlQ29sb3IgPSB0ZXh0dXJlMkQoZGlmZnVzZVNhbXBsZXIsIHZEaWZmdXNlVVYgKyB1dk9mZnNldCk7DQoJI2VuZGlmDQoNCgkjaWZkZWYgQUxQSEFURVNUDQoJCWlmIChiYXNlQ29sb3IuYSA8IDAuNCkNCgkJCWRpc2NhcmQ7DQoJI2VuZGlmDQoNCgkjaWZkZWYgQUxQSEFGUk9NRElGRlVTRQ0KCQlhbHBoYSAqPSBiYXNlQ29sb3IuYTsNCgkjZW5kaWYNCg0KCWJhc2VDb2xvci5yZ2IgKj0gdkRpZmZ1c2VJbmZvcy55Ow0KDQojaWZkZWYgc3BsYXRtYXBEZWYNCgkjaWZkZWYgQlVNUA0KCQkvL25vcm1hbFcgPSBwZXJ0dXJiTm9ybWFsKFRCTiwgdkJ1bXBVViArIHV2T2Zmc2V0KTsNCgkjZW5kaWYNCg0KCSNpZmRlZiBUV09TSURFRExJR0hUSU5HDQoJCW5vcm1hbFcgPSBnbF9Gcm9udEZhY2luZyA/IG5vcm1hbFcgOiAtbm9ybWFsVzsNCgkjZW5kaWYNCiNlbmRpZg0KCQ0KI2VuZGlmDQoNCiNpbmNsdWRlPGRlcHRoUHJlUGFzcz4NCg0KI2lmZGVmIFZFUlRFWENPTE9SDQoJYmFzZUNvbG9yLnJnYiAqPSB2Q29sb3IucmdiOw0KI2VuZGlmDQoNCgkvLyBBbWJpZW50IGNvbG9yDQoJdmVjMyBiYXNlQW1iaWVudENvbG9yID0gdmVjMygxLiwgMS4sIDEuKTsNCg0KI2lmZGVmIEFNQklFTlQNCgliYXNlQW1iaWVudENvbG9yID0gdGV4dHVyZTJEKGFtYmllbnRTYW1wbGVyLCB2QW1iaWVudFVWICsgdXZPZmZzZXQpLnJnYiAqIHZBbWJpZW50SW5mb3MueTsNCiNlbmRpZg0KDQoJLy8gU3BlY3VsYXIgbWFwDQojaWZkZWYgU1BFQ1VMQVJURVJNDQoJZmxvYXQgZ2xvc3NpbmVzcyA9IHZTcGVjdWxhckNvbG9yLmE7DQoJdmVjMyBzcGVjdWxhckNvbG9yID0gdlNwZWN1bGFyQ29sb3IucmdiOw0KDQojaWZkZWYgU1BFQ1VMQVINCgl2ZWM0IHNwZWN1bGFyTWFwQ29sb3IgPSB0ZXh0dXJlMkQoc3BlY3VsYXJTYW1wbGVyLCB2U3BlY3VsYXJVViArIHV2T2Zmc2V0KTsNCglzcGVjdWxhckNvbG9yID0gc3BlY3VsYXJNYXBDb2xvci5yZ2I7DQojaWZkZWYgR0xPU1NJTkVTUw0KCWdsb3NzaW5lc3MgPSBnbG9zc2luZXNzICogc3BlY3VsYXJNYXBDb2xvci5hOw0KI2VuZGlmDQojZW5kaWYNCiNlbHNlDQoJZmxvYXQgZ2xvc3NpbmVzcyA9IDAuOw0KI2VuZGlmDQoNCgkvLyBMaWdodGluZw0KCXZlYzMgZGlmZnVzZUJhc2UgPSB2ZWMzKDAuLCAwLiwgMC4pOw0KCWxpZ2h0aW5nSW5mbyBpbmZvOw0KI2lmZGVmIFNQRUNVTEFSVEVSTQ0KCXZlYzMgc3BlY3VsYXJCYXNlID0gdmVjMygwLiwgMC4sIDAuKTsNCiNlbmRpZg0KCWZsb2F0IHNoYWRvdyA9IDEuOw0KDQojaWZkZWYgTElHSFRNQVANCgl2ZWMzIGxpZ2h0bWFwQ29sb3IgPSB0ZXh0dXJlMkQobGlnaHRtYXBTYW1wbGVyLCB2TGlnaHRtYXBVViArIHV2T2Zmc2V0KS5yZ2IgKiB2TGlnaHRtYXBJbmZvcy55Ow0KI2VuZGlmDQoNCiNpbmNsdWRlPGxpZ2h0RnJhZ21lbnQ+WzAuLm1heFNpbXVsdGFuZW91c0xpZ2h0c10NCg0KCS8vIFJlZnJhY3Rpb24NCgl2ZWMzIHJlZnJhY3Rpb25Db2xvciA9IHZlYzMoMC4sIDAuLCAwLik7DQoNCiNpZmRlZiBSRUZSQUNUSU9ODQoJdmVjMyByZWZyYWN0aW9uVmVjdG9yID0gbm9ybWFsaXplKHJlZnJhY3QoLXZpZXdEaXJlY3Rpb25XLCBub3JtYWxXLCB2UmVmcmFjdGlvbkluZm9zLnkpKTsNCiNpZmRlZiBSRUZSQUNUSU9OTUFQXzNEDQoNCglyZWZyYWN0aW9uVmVjdG9yLnkgPSByZWZyYWN0aW9uVmVjdG9yLnkgKiB2UmVmcmFjdGlvbkluZm9zLnc7DQoNCglpZiAoZG90KHJlZnJhY3Rpb25WZWN0b3IsIHZpZXdEaXJlY3Rpb25XKSA8IDEuMCkNCgl7DQoJCXJlZnJhY3Rpb25Db2xvciA9IHRleHR1cmVDdWJlKHJlZnJhY3Rpb25DdWJlU2FtcGxlciwgcmVmcmFjdGlvblZlY3RvcikucmdiICogdlJlZnJhY3Rpb25JbmZvcy54Ow0KCX0NCiNlbHNlDQoJdmVjMyB2UmVmcmFjdGlvblVWVyA9IHZlYzMocmVmcmFjdGlvbk1hdHJpeCAqICh2aWV3ICogdmVjNCh2UG9zaXRpb25XICsgcmVmcmFjdGlvblZlY3RvciAqIHZSZWZyYWN0aW9uSW5mb3MueiwgMS4wKSkpOw0KDQoJdmVjMiByZWZyYWN0aW9uQ29vcmRzID0gdlJlZnJhY3Rpb25VVlcueHkgLyB2UmVmcmFjdGlvblVWVy56Ow0KDQoJcmVmcmFjdGlvbkNvb3Jkcy55ID0gMS4wIC0gcmVmcmFjdGlvbkNvb3Jkcy55Ow0KDQoJcmVmcmFjdGlvbkNvbG9yID0gdGV4dHVyZTJEKHJlZnJhY3Rpb24yRFNhbXBsZXIsIHJlZnJhY3Rpb25Db29yZHMpLnJnYiAqIHZSZWZyYWN0aW9uSW5mb3MueDsNCiNlbmRpZg0KI2VuZGlmDQoNCgkvLyBSZWZsZWN0aW9uDQoJdmVjMyByZWZsZWN0aW9uQ29sb3IgPSB2ZWMzKDAuLCAwLiwgMC4pOw0KDQojaWZkZWYgUkVGTEVDVElPTg0KCXZlYzMgdlJlZmxlY3Rpb25VVlcgPSBjb21wdXRlUmVmbGVjdGlvbkNvb3Jkcyh2ZWM0KHZQb3NpdGlvblcsIDEuMCksIG5vcm1hbFcpOw0KDQojaWZkZWYgUkVGTEVDVElPTk1BUF8zRA0KI2lmZGVmIFJPVUdITkVTUw0KCWZsb2F0IGJpYXMgPSB2UmVmbGVjdGlvbkluZm9zLnk7DQoNCiNpZmRlZiBTUEVDVUxBUlRFUk0NCgkjaWZkZWYgU1BFQ1VMQVINCgkJI2lmZGVmIEdMT1NTSU5FU1MNCgkJCWJpYXMgKj0gKDEuMCAtIHNwZWN1bGFyTWFwQ29sb3IuYSk7DQoJCSNlbmRpZg0KCSNlbmRpZg0KI2VuZGlmDQoNCglyZWZsZWN0aW9uQ29sb3IgPSB0ZXh0dXJlQ3ViZShyZWZsZWN0aW9uQ3ViZVNhbXBsZXIsIHZSZWZsZWN0aW9uVVZXLCBiaWFzKS5yZ2IgKiB2UmVmbGVjdGlvbkluZm9zLng7DQojZWxzZQ0KCXJlZmxlY3Rpb25Db2xvciA9IHRleHR1cmVDdWJlKHJlZmxlY3Rpb25DdWJlU2FtcGxlciwgdlJlZmxlY3Rpb25VVlcpLnJnYiAqIHZSZWZsZWN0aW9uSW5mb3MueDsNCiNlbmRpZg0KDQojZWxzZQ0KCXZlYzIgY29vcmRzID0gdlJlZmxlY3Rpb25VVlcueHk7DQoNCiNpZmRlZiBSRUZMRUNUSU9OTUFQX1BST0pFQ1RJT04NCgljb29yZHMgLz0gdlJlZmxlY3Rpb25VVlcuejsNCiNlbmRpZg0KDQoJY29vcmRzLnkgPSAxLjAgLSBjb29yZHMueTsNCg0KCXJlZmxlY3Rpb25Db2xvciA9IHRleHR1cmUyRChyZWZsZWN0aW9uMkRTYW1wbGVyLCBjb29yZHMpLnJnYiAqIHZSZWZsZWN0aW9uSW5mb3MueDsNCiNlbmRpZg0KDQojaWZkZWYgUkVGTEVDVElPTkZSRVNORUwNCglmbG9hdCByZWZsZWN0aW9uRnJlc25lbFRlcm0gPSBjb21wdXRlRnJlc25lbFRlcm0odmlld0RpcmVjdGlvblcsIG5vcm1hbFcsIHJlZmxlY3Rpb25SaWdodENvbG9yLmEsIHJlZmxlY3Rpb25MZWZ0Q29sb3IuYSk7DQoNCiNpZmRlZiBSRUZMRUNUSU9ORlJFU05FTEZST01TUEVDVUxBUg0KI2lmZGVmIFNQRUNVTEFSVEVSTQ0KCXJlZmxlY3Rpb25Db2xvciAqPSBzcGVjdWxhckNvbG9yLnJnYiAqICgxLjAgLSByZWZsZWN0aW9uRnJlc25lbFRlcm0pICsgcmVmbGVjdGlvbkZyZXNuZWxUZXJtICogcmVmbGVjdGlvblJpZ2h0Q29sb3IucmdiOw0KI2Vsc2UNCglyZWZsZWN0aW9uQ29sb3IgKj0gcmVmbGVjdGlvbkxlZnRDb2xvci5yZ2IgKiAoMS4wIC0gcmVmbGVjdGlvbkZyZXNuZWxUZXJtKSArIHJlZmxlY3Rpb25GcmVzbmVsVGVybSAqIHJlZmxlY3Rpb25SaWdodENvbG9yLnJnYjsNCiNlbmRpZg0KI2Vsc2UNCglyZWZsZWN0aW9uQ29sb3IgKj0gcmVmbGVjdGlvbkxlZnRDb2xvci5yZ2IgKiAoMS4wIC0gcmVmbGVjdGlvbkZyZXNuZWxUZXJtKSArIHJlZmxlY3Rpb25GcmVzbmVsVGVybSAqIHJlZmxlY3Rpb25SaWdodENvbG9yLnJnYjsNCiNlbmRpZg0KI2VuZGlmDQojZW5kaWYNCg0KI2lmZGVmIFJFRlJBQ1RJT05GUkVTTkVMDQoJZmxvYXQgcmVmcmFjdGlvbkZyZXNuZWxUZXJtID0gY29tcHV0ZUZyZXNuZWxUZXJtKHZpZXdEaXJlY3Rpb25XLCBub3JtYWxXLCByZWZyYWN0aW9uUmlnaHRDb2xvci5hLCByZWZyYWN0aW9uTGVmdENvbG9yLmEpOw0KDQoJcmVmcmFjdGlvbkNvbG9yICo9IHJlZnJhY3Rpb25MZWZ0Q29sb3IucmdiICogKDEuMCAtIHJlZnJhY3Rpb25GcmVzbmVsVGVybSkgKyByZWZyYWN0aW9uRnJlc25lbFRlcm0gKiByZWZyYWN0aW9uUmlnaHRDb2xvci5yZ2I7DQojZW5kaWYNCg0KI2lmZGVmIE9QQUNJVFkNCgl2ZWM0IG9wYWNpdHlNYXAgPSB0ZXh0dXJlMkQob3BhY2l0eVNhbXBsZXIsIHZPcGFjaXR5VVYgKyB1dk9mZnNldCk7DQoNCiNpZmRlZiBPUEFDSVRZUkdCDQoJb3BhY2l0eU1hcC5yZ2IgPSBvcGFjaXR5TWFwLnJnYiAqIHZlYzMoMC4zLCAwLjU5LCAwLjExKTsNCglhbHBoYSAqPSAob3BhY2l0eU1hcC54ICsgb3BhY2l0eU1hcC55ICsgb3BhY2l0eU1hcC56KSogdk9wYWNpdHlJbmZvcy55Ow0KI2Vsc2UNCglhbHBoYSAqPSBvcGFjaXR5TWFwLmEgKiB2T3BhY2l0eUluZm9zLnk7DQojZW5kaWYNCg0KI2VuZGlmDQoNCiNpZmRlZiBWRVJURVhBTFBIQQ0KCWFscGhhICo9IHZDb2xvci5hOw0KI2VuZGlmDQoNCiNpZmRlZiBPUEFDSVRZRlJFU05FTA0KCWZsb2F0IG9wYWNpdHlGcmVzbmVsVGVybSA9IGNvbXB1dGVGcmVzbmVsVGVybSh2aWV3RGlyZWN0aW9uVywgbm9ybWFsVywgb3BhY2l0eVBhcnRzLnosIG9wYWNpdHlQYXJ0cy53KTsNCg0KCWFscGhhICs9IG9wYWNpdHlQYXJ0cy54ICogKDEuMCAtIG9wYWNpdHlGcmVzbmVsVGVybSkgKyBvcGFjaXR5RnJlc25lbFRlcm0gKiBvcGFjaXR5UGFydHMueTsNCiNlbmRpZg0KDQoJLy8gRW1pc3NpdmUNCgl2ZWMzIGVtaXNzaXZlQ29sb3IgPSB2RW1pc3NpdmVDb2xvcjsNCiNpZmRlZiBFTUlTU0lWRQ0KCWVtaXNzaXZlQ29sb3IgKz0gdGV4dHVyZTJEKGVtaXNzaXZlU2FtcGxlciwgdkVtaXNzaXZlVVYgKyB1dk9mZnNldCkucmdiICogdkVtaXNzaXZlSW5mb3MueTsNCiNlbmRpZg0KDQojaWZkZWYgRU1JU1NJVkVGUkVTTkVMDQoJZmxvYXQgZW1pc3NpdmVGcmVzbmVsVGVybSA9IGNvbXB1dGVGcmVzbmVsVGVybSh2aWV3RGlyZWN0aW9uVywgbm9ybWFsVywgZW1pc3NpdmVSaWdodENvbG9yLmEsIGVtaXNzaXZlTGVmdENvbG9yLmEpOw0KDQoJZW1pc3NpdmVDb2xvciAqPSBlbWlzc2l2ZUxlZnRDb2xvci5yZ2IgKiAoMS4wIC0gZW1pc3NpdmVGcmVzbmVsVGVybSkgKyBlbWlzc2l2ZUZyZXNuZWxUZXJtICogZW1pc3NpdmVSaWdodENvbG9yLnJnYjsNCiNlbmRpZg0KDQoJLy8gRnJlc25lbA0KI2lmZGVmIERJRkZVU0VGUkVTTkVMDQoJZmxvYXQgZGlmZnVzZUZyZXNuZWxUZXJtID0gY29tcHV0ZUZyZXNuZWxUZXJtKHZpZXdEaXJlY3Rpb25XLCBub3JtYWxXLCBkaWZmdXNlUmlnaHRDb2xvci5hLCBkaWZmdXNlTGVmdENvbG9yLmEpOw0KDQoJZGlmZnVzZUJhc2UgKj0gZGlmZnVzZUxlZnRDb2xvci5yZ2IgKiAoMS4wIC0gZGlmZnVzZUZyZXNuZWxUZXJtKSArIGRpZmZ1c2VGcmVzbmVsVGVybSAqIGRpZmZ1c2VSaWdodENvbG9yLnJnYjsNCiNlbmRpZg0KDQoJLy8gQ29tcG9zaXRpb24NCiNpZmRlZiBFTUlTU0lWRUFTSUxMVU1JTkFUSU9ODQoJdmVjMyBmaW5hbERpZmZ1c2UgPSBjbGFtcChkaWZmdXNlQmFzZSAqIGRpZmZ1c2VDb2xvciArIHZBbWJpZW50Q29sb3IsIDAuMCwgMS4wKSAqIGJhc2VDb2xvci5yZ2I7DQojZWxzZQ0KI2lmZGVmIExJTktFTUlTU0lWRVdJVEhESUZGVVNFDQoJdmVjMyBmaW5hbERpZmZ1c2UgPSBjbGFtcCgoZGlmZnVzZUJhc2UgKyBlbWlzc2l2ZUNvbG9yKSAqIGRpZmZ1c2VDb2xvciArIHZBbWJpZW50Q29sb3IsIDAuMCwgMS4wKSAqIGJhc2VDb2xvci5yZ2I7DQojZWxzZQ0KCXZlYzMgZmluYWxEaWZmdXNlID0gY2xhbXAoZGlmZnVzZUJhc2UgKiBkaWZmdXNlQ29sb3IgKyBlbWlzc2l2ZUNvbG9yICsgdkFtYmllbnRDb2xvciwgMC4wLCAxLjApICogYmFzZUNvbG9yLnJnYjsNCiNlbmRpZg0KI2VuZGlmDQoNCiNpZmRlZiBTUEVDVUxBUlRFUk0NCgl2ZWMzIGZpbmFsU3BlY3VsYXIgPSBzcGVjdWxhckJhc2UgKiBzcGVjdWxhckNvbG9yOw0KCSNpZmRlZiBTUEVDVUxBUk9WRVJBTFBIQQ0KCQlhbHBoYSA9IGNsYW1wKGFscGhhICsgZG90KGZpbmFsU3BlY3VsYXIsIHZlYzMoMC4zLCAwLjU5LCAwLjExKSksIDAuLCAxLik7DQoJI2VuZGlmDQojZWxzZQ0KCXZlYzMgZmluYWxTcGVjdWxhciA9IHZlYzMoMC4wKTsNCiNlbmRpZg0KDQojaWZkZWYgUkVGTEVDVElPTk9WRVJBTFBIQQ0KCWFscGhhID0gY2xhbXAoYWxwaGEgKyBkb3QocmVmbGVjdGlvbkNvbG9yLCB2ZWMzKDAuMywgMC41OSwgMC4xMSkpLCAwLiwgMS4pOw0KI2VuZGlmDQoNCgkvLyBDb21wb3NpdGlvbg0KI2lmZGVmIEVNSVNTSVZFQVNJTExVTUlOQVRJT04NCgl2ZWM0IGNvbG9yID0gdmVjNChjbGFtcChmaW5hbERpZmZ1c2UgKiBiYXNlQW1iaWVudENvbG9yICsgZmluYWxTcGVjdWxhciArIHJlZmxlY3Rpb25Db2xvciArIGVtaXNzaXZlQ29sb3IgKyByZWZyYWN0aW9uQ29sb3IsIDAuMCwgMS4wKSwgYWxwaGEpOw0KI2Vsc2UNCgl2ZWM0IGNvbG9yID0gdmVjNChmaW5hbERpZmZ1c2UgKiBiYXNlQW1iaWVudENvbG9yICsgZmluYWxTcGVjdWxhciArIHJlZmxlY3Rpb25Db2xvciArIHJlZnJhY3Rpb25Db2xvciwgYWxwaGEpOw0KI2VuZGlmDQoNCi8vT2xkIGxpZ2h0bWFwIGNhbGN1bGF0aW9uIG1ldGhvZA0KI2lmZGVmIExJR0hUTUFQDQogICAgI2lmbmRlZiBMSUdIVE1BUEVYQ0xVREVEDQogICAgICAgICNpZmRlZiBVU0VMSUdIVE1BUEFTU0hBRE9XTUFQDQogICAgICAgICAgICBjb2xvci5yZ2IgKj0gbGlnaHRtYXBDb2xvcjsNCiAgICAgICAgI2Vsc2UNCiAgICAgICAgICAgIGNvbG9yLnJnYiArPSBsaWdodG1hcENvbG9yOw0KICAgICAgICAjZW5kaWYNCiAgICAjZW5kaWYNCiNlbmRpZg0KDQojaW5jbHVkZTxsb2dEZXB0aEZyYWdtZW50Pg0KI2luY2x1ZGU8Zm9nRnJhZ21lbnQ+DQoNCi8vIEFwcGx5IGltYWdlIHByb2Nlc3NpbmcgaWYgcmVsZXZhbnQuIEFzIHRoaXMgYXBwbGllcyBpbiBsaW5lYXIgc3BhY2UsIA0KLy8gV2UgZmlyc3QgbW92ZSBmcm9tIGdhbW1hIHRvIGxpbmVhci4NCiNpZmRlZiBJTUFHRVBST0NFU1NJTkdQT1NUUFJPQ0VTUw0KCWNvbG9yLnJnYiA9IHRvTGluZWFyU3BhY2UoY29sb3IucmdiKTsNCiNlbHNlDQoJI2lmZGVmIElNQUdFUFJPQ0VTU0lORw0KCQljb2xvci5yZ2IgPSB0b0xpbmVhclNwYWNlKGNvbG9yLnJnYik7DQoJCWNvbG9yID0gYXBwbHlJbWFnZVByb2Nlc3NpbmcoY29sb3IpOw0KCSNlbmRpZg0KI2VuZGlmDQoNCglnbF9GcmFnQ29sb3IgPSBjb2xvcjsNCn0=");